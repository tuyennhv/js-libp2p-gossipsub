"use strict";(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PGossipsub = factory()}(typeof self !== 'undefined' ? self : this, function () {
var ChainsafeLibp2PGossipsub=(()=>{var Ml=Object.create;var Di=Object.defineProperty;var kl=Object.getOwnPropertyDescriptor;var Nl=Object.getOwnPropertyNames;var Ol=Object.getPrototypeOf,Fl=Object.prototype.hasOwnProperty;var $a=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var L=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),qe=(t,e)=>{for(var r in e)Di(t,r,{get:e[r],enumerable:!0})},ja=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Nl(e))!Fl.call(t,i)&&i!==r&&Di(t,i,{get:()=>e[i],enumerable:!(n=kl(e,i))||n.enumerable});return t};var U=(t,e,r)=>(r=t!=null?Ml(Ol(t)):{},ja(e||!t||!t.__esModule?Di(r,"default",{value:t,enumerable:!0}):r,t)),Ul=t=>ja(Di({},"__esModule",{value:!0}),t);var Za=L((Mv,Ya)=>{Ya.exports=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}});var Ja=L((Nv,Xa)=>{var Qa=Za();Xa.exports=class{constructor(e){this.hwm=e||16,this.head=new Qa(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let r=this.head;this.head=r.next=new Qa(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next){let r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}});var tc=L((Ov,ec)=>{var Hs=Ja();ec.exports=t=>{t=t||{};let e;typeof t=="function"?(e=t,t={}):e=t.onEnd;let r=new Hs,n,i,s,o=()=>{if(!r.isEmpty()){if(t.writev){let g,m=[];for(;!r.isEmpty();){if(g=r.shift(),g.error)throw g.error;m.push(g.value)}return{done:g.done,value:m}}let p=r.shift();if(p.error)throw p.error;return p}return s?{done:!0}:new Promise((p,g)=>{i=m=>(i=null,m.error?g(m.error):t.writev&&!m.done?p({done:m.done,value:[m.value]}):p(m),n)})},a=p=>i?i(p):(r.push(p),n),f=p=>(r=new Hs,i?i({error:p}):(r.push({error:p}),n)),u=p=>s?n:a({done:!1,value:p}),c=p=>s?n:(s=!0,p?f(p):a({done:!0})),h=()=>(r=new Hs,c(),{done:!0}),l=p=>(c(p),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:o,return:h,throw:l,push:u,end:c},!e)return n;let d=n;return n={[Symbol.asyncIterator](){return this},next(){return d.next()},throw(p){return d.throw(p),e&&(e(p),e=null),{done:!0}},return(){return d.return(),e&&(e(),e=null),{done:!0}},push:u,end(p){return d.end(p),e&&(e(p),e=null),n}},n}});var nc=L((Fv,rc)=>{"use strict";var Vl=tc(),zl=async function*(...t){let e=Vl();setTimeout(async()=>{try{await Promise.all(t.map(async r=>{for await(let n of r)e.push(n)})),e.end()}catch(r){e.end(r)}},0),yield*e};rc.exports=zl});var Ae=L((Vv,ac)=>{"use strict";function oc(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function Hl(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return oc(t,r)}catch{r.message=t.message,r.stack=t.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),oc(new i,r)}}ac.exports=Hl});var ae=L((CE,Uc)=>{Uc.exports={options:{usePureJavaScript:!1}}});var zc=L((IE,Vc)=>{var mo={};Vc.exports=mo;var Kc={};mo.encode=function(t,e,r){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(r!==void 0&&typeof r!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(t instanceof Uint8Array))n=sg(t,e);else{var i=0,s=e.length,o=e.charAt(0),a=[0];for(i=0;i<t.length;++i){for(var f=0,u=t[i];f<a.length;++f)u+=a[f]<<8,a[f]=u%s,u=u/s|0;for(;u>0;)a.push(u%s),u=u/s|0}for(i=0;t[i]===0&&i<t.length-1;++i)n+=o;for(i=a.length-1;i>=0;--i)n+=e[a[i]]}if(r){var c=new RegExp(".{1,"+r+"}","g");n=n.match(c).join(`\r
`)}return n};mo.decode=function(t,e){if(typeof t!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var r=Kc[e];if(!r){r=Kc[e]=[];for(var n=0;n<e.length;++n)r[e.charCodeAt(n)]=n}t=t.replace(/\s/g,"");for(var i=e.length,s=e.charAt(0),o=[0],n=0;n<t.length;n++){var a=r[t.charCodeAt(n)];if(a===void 0)return;for(var f=0,u=a;f<o.length;++f)u+=o[f]*i,o[f]=u&255,u>>=8;for(;u>0;)o.push(u&255),u>>=8}for(var c=0;t[c]===s&&c<t.length-1;++c)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function sg(t,e){var r=0,n=e.length,i=e.charAt(0),s=[0];for(r=0;r<t.length();++r){for(var o=0,a=t.at(r);o<s.length;++o)a+=s[o]<<8,s[o]=a%n,a=a/n|0;for(;a>0;)s.push(a%n),a=a/n|0}var f="";for(r=0;t.at(r)===0&&r<t.length()-1;++r)f+=i;for(r=s.length-1;r>=0;--r)f+=e[s[r]];return f}});var Be=L((AE,Wc)=>{var qc=ae(),Gc=zc(),y=Wc.exports=qc.util=qc.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){y.nextTick=process.nextTick,typeof setImmediate=="function"?y.setImmediate=setImmediate:y.setImmediate=y.nextTick;return}if(typeof setImmediate=="function"){y.setImmediate=function(){return setImmediate.apply(void 0,arguments)},y.nextTick=function(a){return setImmediate(a)};return}if(y.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(f){if(f.source===window&&f.data===t){f.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(c){c()})}};var o=a,t="forge.setImmediate",e=[];y.setImmediate=function(f){e.push(f),e.length===1&&window.postMessage(t,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var r=Date.now(),n=!0,i=document.createElement("div"),e=[];new MutationObserver(function(){var f=e.slice();e.length=0,f.forEach(function(u){u()})}).observe(i,{attributes:!0});var s=y.setImmediate;y.setImmediate=function(f){Date.now()-r>15?(r=Date.now(),s(f)):(e.push(f),e.length===1&&i.setAttribute("a",n=!n))}}y.nextTick=y.setImmediate})();y.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;y.globalScope=function(){return y.isNodejs?globalThis:typeof self>"u"?window:self}();y.isArray=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};y.isArrayBuffer=function(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer};y.isArrayBufferView=function(t){return t&&y.isArrayBuffer(t.buffer)&&t.byteLength!==void 0};function Gn(t){if(!(t===8||t===16||t===24||t===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}y.ByteBuffer=bo;function bo(t){if(this.data="",this.read=0,typeof t=="string")this.data=t;else if(y.isArrayBuffer(t)||y.isArrayBufferView(t))if(typeof Buffer<"u"&&t instanceof Buffer)this.data=t.toString("binary");else{var e=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var r=0;r<e.length;++r)this.putByte(e[r])}}else(t instanceof bo||typeof t=="object"&&typeof t.data=="string"&&typeof t.read=="number")&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}y.ByteStringBuffer=bo;var og=4096;y.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>og&&(this.data.substr(0,1),this._constructedStringLength=0)};y.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};y.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};y.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))};y.ByteStringBuffer.prototype.fillWithByte=function(t,e){t=String.fromCharCode(t);for(var r=this.data;e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return this.data=r,this._optimizeConstructedString(e),this};y.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this};y.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(y.encodeUtf8(t))};y.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255))};y.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))};y.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))};y.ByteStringBuffer.prototype.putInt=function(t,e){Gn(e);var r="";do e-=8,r+=String.fromCharCode(t>>e&255);while(e>0);return this.putBytes(r)};y.ByteStringBuffer.prototype.putSignedInt=function(t,e){return t<0&&(t+=2<<e-1),this.putInt(t,e)};y.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())};y.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};y.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t};y.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t};y.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t};y.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t};y.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t};y.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t};y.ByteStringBuffer.prototype.getInt=function(t){Gn(t);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),t-=8;while(t>0);return e};y.ByteStringBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};y.ByteStringBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};y.ByteStringBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};y.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)};y.ByteStringBuffer.prototype.setAt=function(t,e){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(e)+this.data.substr(this.read+t+1),this};y.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};y.ByteStringBuffer.prototype.copy=function(){var t=y.createBuffer(this.data);return t.read=this.read,t};y.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};y.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};y.ByteStringBuffer.prototype.truncate=function(t){var e=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,e),this.read=0,this};y.ByteStringBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.length;++e){var r=this.data.charCodeAt(e);r<16&&(t+="0"),t+=r.toString(16)}return t};y.ByteStringBuffer.prototype.toString=function(){return y.decodeUtf8(this.bytes())};function ag(t,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var r=y.isArrayBuffer(t),n=y.isArrayBufferView(t);if(r||n){r?this.data=new DataView(t):this.data=new DataView(t.buffer,t.byteOffset,t.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,t!=null&&this.putBytes(t),"writeOffset"in e&&(this.write=e.writeOffset)}y.DataBuffer=ag;y.DataBuffer.prototype.length=function(){return this.write-this.read};y.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};y.DataBuffer.prototype.accommodate=function(t,e){if(this.length()>=t)return this;e=Math.max(e||this.growSize,t);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(r),this.data=new DataView(n.buffer),this};y.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this};y.DataBuffer.prototype.fillWithByte=function(t,e){this.accommodate(e);for(var r=0;r<e;++r)this.data.setUint8(t);return this};y.DataBuffer.prototype.putBytes=function(t,e){if(y.isArrayBufferView(t)){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=r.byteLength-r.byteOffset;this.accommodate(n);var i=new Uint8Array(this.data.buffer,this.write);return i.set(r),this.write+=n,this}if(y.isArrayBuffer(t)){var r=new Uint8Array(t);this.accommodate(r.byteLength);var i=new Uint8Array(this.data.buffer);return i.set(r,this.write),this.write+=r.byteLength,this}if(t instanceof y.DataBuffer||typeof t=="object"&&typeof t.read=="number"&&typeof t.write=="number"&&y.isArrayBufferView(t.data)){var r=new Uint8Array(t.data.byteLength,t.read,t.length());this.accommodate(r.byteLength);var i=new Uint8Array(t.data.byteLength,this.write);return i.set(r),this.write+=r.byteLength,this}if(t instanceof y.ByteStringBuffer&&(t=t.data,e="binary"),e=e||"binary",typeof t=="string"){var s;if(e==="hex")return this.accommodate(Math.ceil(t.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.hex.decode(t,s,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(t.length/4)*3),s=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.base64.decode(t,s,this.write),this;if(e==="utf8"&&(t=y.encodeUtf8(t),e="binary"),e==="binary"||e==="raw")return this.accommodate(t.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.raw.decode(s),this;if(e==="utf16")return this.accommodate(t.length*2),s=new Uint16Array(this.data.buffer,this.write),this.write+=y.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+t)};y.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this};y.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")};y.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this};y.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this};y.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this};y.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this};y.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this};y.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this};y.DataBuffer.prototype.putInt=function(t,e){Gn(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,t>>e&255);while(e>0);return this};y.DataBuffer.prototype.putSignedInt=function(t,e){return Gn(e),this.accommodate(e/8),t<0&&(t+=2<<e-1),this.putInt(t,e)};y.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};y.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t};y.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t};y.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t};y.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t};y.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t};y.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t};y.DataBuffer.prototype.getInt=function(t){Gn(t);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),t-=8;while(t>0);return e};y.DataBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};y.DataBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};y.DataBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};y.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)};y.DataBuffer.prototype.setAt=function(t,e){return this.data.setUint8(t,e),this};y.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};y.DataBuffer.prototype.copy=function(){return new y.DataBuffer(this)};y.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(t.byteLength);e.set(t),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};y.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};y.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this};y.DataBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.byteLength;++e){var r=this.data.getUint8(e);r<16&&(t+="0"),t+=r.toString(16)}return t};y.DataBuffer.prototype.toString=function(t){var e=new Uint8Array(this.data,this.read,this.length());if(t=t||"utf8",t==="binary"||t==="raw")return y.binary.raw.encode(e);if(t==="hex")return y.binary.hex.encode(e);if(t==="base64")return y.binary.base64.encode(e);if(t==="utf8")return y.text.utf8.decode(e);if(t==="utf16")return y.text.utf16.decode(e);throw new Error("Invalid encoding: "+t)};y.createBuffer=function(t,e){return e=e||"raw",t!==void 0&&e==="utf8"&&(t=y.encodeUtf8(t)),new y.ByteBuffer(t)};y.fillString=function(t,e){for(var r="";e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return r};y.xorBytes=function(t,e,r){for(var n="",i="",s="",o=0,a=0;r>0;--r,++o)i=t.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=s,s="",a=0),s+=String.fromCharCode(i),++a;return n+=s,n};y.hexToBytes=function(t){var e="",r=0;for(t.length&!0&&(r=1,e+=String.fromCharCode(parseInt(t[0],16)));r<t.length;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e};y.bytesToHex=function(t){return y.createBuffer(t).toHex()};y.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255)};var ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cr=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Hc="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";y.encode64=function(t,e){for(var r="",n="",i,s,o,a=0;a<t.length;)i=t.charCodeAt(a++),s=t.charCodeAt(a++),o=t.charCodeAt(a++),r+=ar.charAt(i>>2),r+=ar.charAt((i&3)<<4|s>>4),isNaN(s)?r+="==":(r+=ar.charAt((s&15)<<2|o>>6),r+=isNaN(o)?"=":ar.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};y.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",r,n,i,s,o=0;o<t.length;)r=cr[t.charCodeAt(o++)-43],n=cr[t.charCodeAt(o++)-43],i=cr[t.charCodeAt(o++)-43],s=cr[t.charCodeAt(o++)-43],e+=String.fromCharCode(r<<2|n>>4),i!==64&&(e+=String.fromCharCode((n&15)<<4|i>>2),s!==64&&(e+=String.fromCharCode((i&3)<<6|s)));return e};y.encodeUtf8=function(t){return unescape(encodeURIComponent(t))};y.decodeUtf8=function(t){return decodeURIComponent(escape(t))};y.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:Gc.encode,decode:Gc.decode}};y.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)};y.binary.raw.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var i=r,s=0;s<t.length;++s)n[i++]=t.charCodeAt(s);return e?i-r:n};y.binary.hex.encode=y.bytesToHex;y.binary.hex.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/2))),r=r||0;var i=0,s=r;for(t.length&1&&(i=1,n[s++]=parseInt(t[0],16));i<t.length;i+=2)n[s++]=parseInt(t.substr(i,2),16);return e?s-r:n};y.binary.base64.encode=function(t,e){for(var r="",n="",i,s,o,a=0;a<t.byteLength;)i=t[a++],s=t[a++],o=t[a++],r+=ar.charAt(i>>2),r+=ar.charAt((i&3)<<4|s>>4),isNaN(s)?r+="==":(r+=ar.charAt((s&15)<<2|o>>6),r+=isNaN(o)?"=":ar.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};y.binary.base64.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/4)*3)),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),r=r||0;for(var i,s,o,a,f=0,u=r;f<t.length;)i=cr[t.charCodeAt(f++)-43],s=cr[t.charCodeAt(f++)-43],o=cr[t.charCodeAt(f++)-43],a=cr[t.charCodeAt(f++)-43],n[u++]=i<<2|s>>4,o!==64&&(n[u++]=(s&15)<<4|o>>2,a!==64&&(n[u++]=(o&3)<<6|a));return e?u-r:n.subarray(0,u)};y.binary.base58.encode=function(t,e){return y.binary.baseN.encode(t,Hc,e)};y.binary.base58.decode=function(t,e){return y.binary.baseN.decode(t,Hc,e)};y.text={utf8:{},utf16:{}};y.text.utf8.encode=function(t,e,r){t=y.encodeUtf8(t);var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var i=r,s=0;s<t.length;++s)n[i++]=t.charCodeAt(s);return e?i-r:n};y.text.utf8.decode=function(t){return y.decodeUtf8(String.fromCharCode.apply(null,t))};y.text.utf16.encode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length*2));var i=new Uint16Array(n.buffer);r=r||0;for(var s=r,o=r,a=0;a<t.length;++a)i[o++]=t.charCodeAt(a),s+=2;return e?s-r:n};y.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))};y.deflate=function(t,e,r){if(e=y.decode64(t.deflate(y.encode64(e)).rval),r){var n=2,i=e.charCodeAt(1);i&32&&(n=6),e=e.substring(n,e.length-4)}return e};y.inflate=function(t,e,r){var n=t.inflate(y.encode64(e)).rval;return n===null?null:y.decode64(n)};var vo=function(t,e,r){if(!t)throw new Error("WebStorage not available.");var n;if(r===null?n=t.removeItem(e):(r=y.encode64(JSON.stringify(r)),n=t.setItem(e,r)),typeof n<"u"&&n.rval!==!0){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},xo=function(t,e){if(!t)throw new Error("WebStorage not available.");var r=t.getItem(e);if(t.init)if(r.rval===null){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return r!==null&&(r=JSON.parse(y.decode64(r))),r},cg=function(t,e,r,n){var i=xo(t,e);i===null&&(i={}),i[r]=n,vo(t,e,i)},ug=function(t,e,r){var n=xo(t,e);return n!==null&&(n=r in n?n[r]:null),n},fg=function(t,e,r){var n=xo(t,e);if(n!==null&&r in n){delete n[r];var i=!0;for(var s in n){i=!1;break}i&&(n=null),vo(t,e,n)}},hg=function(t,e){vo(t,e,null)},Ni=function(t,e,r){var n=null;typeof r>"u"&&(r=["web","flash"]);var i,s=!1,o=null;for(var a in r){i=r[a];try{if(i==="flash"||i==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=t.apply(this,e),s=i==="flash"}(i==="web"||i==="both")&&(e[0]=localStorage,n=t.apply(this,e),s=!0)}catch(f){o=f}if(s)break}if(!s)throw o;return n};y.setItem=function(t,e,r,n,i){Ni(cg,arguments,i)};y.getItem=function(t,e,r,n){return Ni(ug,arguments,n)};y.removeItem=function(t,e,r,n){Ni(fg,arguments,n)};y.clearItems=function(t,e,r){Ni(hg,arguments,r)};y.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};y.format=function(t){for(var e=/%./g,r,n,i=0,s=[],o=0;r=e.exec(t);){n=t.substring(o,e.lastIndex-2),n.length>0&&s.push(n),o=e.lastIndex;var a=r[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[i+++1]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(t.substring(o)),s.join("")};y.formatNumber=function(t,e,r,n){var i=t,s=isNaN(e=Math.abs(e))?2:e,o=r===void 0?",":r,a=n===void 0?".":n,f=i<0?"-":"",u=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",c=u.length>3?u.length%3:0;return f+(c?u.substr(0,c)+a:"")+u.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-u).toFixed(s).slice(2):"")};y.formatSize=function(t){return t>=1073741824?t=y.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?t=y.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?t=y.formatNumber(t/1024,0)+" KiB":t=y.formatNumber(t,0)+" bytes",t};y.bytesFromIP=function(t){return t.indexOf(".")!==-1?y.bytesFromIPv4(t):t.indexOf(":")!==-1?y.bytesFromIPv6(t):null};y.bytesFromIPv4=function(t){if(t=t.split("."),t.length!==4)return null;for(var e=y.createBuffer(),r=0;r<t.length;++r){var n=parseInt(t[r],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};y.bytesFromIPv6=function(t){var e=0;t=t.split(":").filter(function(o){return o.length===0&&++e,!0});for(var r=(8-t.length+e)*2,n=y.createBuffer(),i=0;i<8;++i){if(!t[i]||t[i].length===0){n.fillWithByte(0,r),r=0;continue}var s=y.hexToBytes(t[i]);s.length<2&&n.putByte(0),n.putBytes(s)}return n.getBytes()};y.bytesToIP=function(t){return t.length===4?y.bytesToIPv4(t):t.length===16?y.bytesToIPv6(t):null};y.bytesToIPv4=function(t){if(t.length!==4)return null;for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e.join(".")};y.bytesToIPv6=function(t){if(t.length!==16)return null;for(var e=[],r=[],n=0,i=0;i<t.length;i+=2){for(var s=y.bytesToHex(t[i]+t[i+1]);s[0]==="0"&&s!=="0";)s=s.substr(1);if(s==="0"){var o=r[r.length-1],a=e.length;!o||a!==o.end+1?r.push({start:a,end:a}):(o.end=a,o.end-o.start>r[n].end-r[n].start&&(n=r.length-1))}e.push(s)}if(r.length>0){var f=r[n];f.end-f.start>0&&(e.splice(f.start,f.end-f.start+1,""),f.start===0&&e.unshift(""),f.end===7&&e.push(""))}return e.join(":")};y.estimateCores=function(t,e){if(typeof t=="function"&&(e=t,t={}),t=t||{},"cores"in y&&!t.update)return e(null,y.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return y.cores=navigator.hardwareConcurrency,e(null,y.cores);if(typeof Worker>"u")return y.cores=1,e(null,y.cores);if(typeof Blob>"u")return y.cores=2,e(null,y.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),f=a+4;Date.now()<f;);self.postMessage({st:a,et:f})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,f){if(a===0){var u=Math.floor(o.reduce(function(c,h){return c+h},0)/o.length);return y.cores=Math.max(1,u),URL.revokeObjectURL(r),e(null,y.cores)}i(f,function(c,h){o.push(s(f,h)),n(o,a-1,f)})}function i(o,a){for(var f=[],u=[],c=0;c<o;++c){var h=new Worker(r);h.addEventListener("message",function(l){if(u.push(l.data),u.length===o){for(var d=0;d<o;++d)f[d].terminate();a(null,u)}}),f.push(h)}for(var c=0;c<o;++c)f[c].postMessage(c)}function s(o,a){for(var f=[],u=0;u<o;++u)for(var c=a[u],h=f[u]=[],l=0;l<o;++l)if(u!==l){var d=a[l];(c.st>d.st&&c.st<d.et||d.st>c.st&&d.st<c.et)&&h.push(l)}return f.reduce(function(p,g){return Math.max(p,g.length)},0)}}});var Oi=L((_E,$c)=>{var Hn=ae();Hn.pki=Hn.pki||{};var wo=$c.exports=Hn.pki.oids=Hn.oids=Hn.oids||{};function A(t,e){wo[t]=e,wo[e]=t}function se(t,e){wo[t]=e}A("1.2.840.113549.1.1.1","rsaEncryption");A("1.2.840.113549.1.1.4","md5WithRSAEncryption");A("1.2.840.113549.1.1.5","sha1WithRSAEncryption");A("1.2.840.113549.1.1.7","RSAES-OAEP");A("1.2.840.113549.1.1.8","mgf1");A("1.2.840.113549.1.1.9","pSpecified");A("1.2.840.113549.1.1.10","RSASSA-PSS");A("1.2.840.113549.1.1.11","sha256WithRSAEncryption");A("1.2.840.113549.1.1.12","sha384WithRSAEncryption");A("1.2.840.113549.1.1.13","sha512WithRSAEncryption");A("1.3.101.112","EdDSA25519");A("1.2.840.10040.4.3","dsa-with-sha1");A("1.3.14.3.2.7","desCBC");A("1.3.14.3.2.26","sha1");A("1.3.14.3.2.29","sha1WithRSASignature");A("2.16.840.1.101.3.4.2.1","sha256");A("2.16.840.1.101.3.4.2.2","sha384");A("2.16.840.1.101.3.4.2.3","sha512");A("2.16.840.1.101.3.4.2.4","sha224");A("2.16.840.1.101.3.4.2.5","sha512-224");A("2.16.840.1.101.3.4.2.6","sha512-256");A("1.2.840.113549.2.2","md2");A("1.2.840.113549.2.5","md5");A("1.2.840.113549.1.7.1","data");A("1.2.840.113549.1.7.2","signedData");A("1.2.840.113549.1.7.3","envelopedData");A("1.2.840.113549.1.7.4","signedAndEnvelopedData");A("1.2.840.113549.1.7.5","digestedData");A("1.2.840.113549.1.7.6","encryptedData");A("1.2.840.113549.1.9.1","emailAddress");A("1.2.840.113549.1.9.2","unstructuredName");A("1.2.840.113549.1.9.3","contentType");A("1.2.840.113549.1.9.4","messageDigest");A("1.2.840.113549.1.9.5","signingTime");A("1.2.840.113549.1.9.6","counterSignature");A("1.2.840.113549.1.9.7","challengePassword");A("1.2.840.113549.1.9.8","unstructuredAddress");A("1.2.840.113549.1.9.14","extensionRequest");A("1.2.840.113549.1.9.20","friendlyName");A("1.2.840.113549.1.9.21","localKeyId");A("1.2.840.113549.1.9.22.1","x509Certificate");A("1.2.840.113549.1.12.10.1.1","keyBag");A("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");A("1.2.840.113549.1.12.10.1.3","certBag");A("1.2.840.113549.1.12.10.1.4","crlBag");A("1.2.840.113549.1.12.10.1.5","secretBag");A("1.2.840.113549.1.12.10.1.6","safeContentsBag");A("1.2.840.113549.1.5.13","pkcs5PBES2");A("1.2.840.113549.1.5.12","pkcs5PBKDF2");A("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");A("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");A("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");A("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");A("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");A("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");A("1.2.840.113549.2.7","hmacWithSHA1");A("1.2.840.113549.2.8","hmacWithSHA224");A("1.2.840.113549.2.9","hmacWithSHA256");A("1.2.840.113549.2.10","hmacWithSHA384");A("1.2.840.113549.2.11","hmacWithSHA512");A("1.2.840.113549.3.7","des-EDE3-CBC");A("2.16.840.1.101.3.4.1.2","aes128-CBC");A("2.16.840.1.101.3.4.1.22","aes192-CBC");A("2.16.840.1.101.3.4.1.42","aes256-CBC");A("2.5.4.3","commonName");A("2.5.4.4","surname");A("2.5.4.5","serialNumber");A("2.5.4.6","countryName");A("2.5.4.7","localityName");A("2.5.4.8","stateOrProvinceName");A("2.5.4.9","streetAddress");A("2.5.4.10","organizationName");A("2.5.4.11","organizationalUnitName");A("2.5.4.12","title");A("2.5.4.13","description");A("2.5.4.15","businessCategory");A("2.5.4.17","postalCode");A("2.5.4.42","givenName");A("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");A("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");A("2.16.840.1.113730.1.1","nsCertType");A("2.16.840.1.113730.1.13","nsComment");se("2.5.29.1","authorityKeyIdentifier");se("2.5.29.2","keyAttributes");se("2.5.29.3","certificatePolicies");se("2.5.29.4","keyUsageRestriction");se("2.5.29.5","policyMapping");se("2.5.29.6","subtreesConstraint");se("2.5.29.7","subjectAltName");se("2.5.29.8","issuerAltName");se("2.5.29.9","subjectDirectoryAttributes");se("2.5.29.10","basicConstraints");se("2.5.29.11","nameConstraints");se("2.5.29.12","policyConstraints");se("2.5.29.13","basicConstraints");A("2.5.29.14","subjectKeyIdentifier");A("2.5.29.15","keyUsage");se("2.5.29.16","privateKeyUsagePeriod");A("2.5.29.17","subjectAltName");A("2.5.29.18","issuerAltName");A("2.5.29.19","basicConstraints");se("2.5.29.20","cRLNumber");se("2.5.29.21","cRLReason");se("2.5.29.22","expirationDate");se("2.5.29.23","instructionCode");se("2.5.29.24","invalidityDate");se("2.5.29.25","cRLDistributionPoints");se("2.5.29.26","issuingDistributionPoint");se("2.5.29.27","deltaCRLIndicator");se("2.5.29.28","issuingDistributionPoint");se("2.5.29.29","certificateIssuer");se("2.5.29.30","nameConstraints");A("2.5.29.31","cRLDistributionPoints");A("2.5.29.32","certificatePolicies");se("2.5.29.33","policyMappings");se("2.5.29.34","policyConstraints");A("2.5.29.35","authorityKeyIdentifier");se("2.5.29.36","policyConstraints");A("2.5.29.37","extKeyUsage");se("2.5.29.46","freshestCRL");se("2.5.29.54","inhibitAnyPolicy");A("1.3.6.1.4.1.11129.2.4.2","timestampList");A("1.3.6.1.5.5.7.1.1","authorityInfoAccess");A("1.3.6.1.5.5.7.3.1","serverAuth");A("1.3.6.1.5.5.7.3.2","clientAuth");A("1.3.6.1.5.5.7.3.3","codeSigning");A("1.3.6.1.5.5.7.3.4","emailProtection");A("1.3.6.1.5.5.7.3.8","timeStamping")});var $n=L((TE,Yc)=>{var ye=ae();Be();Oi();var _=Yc.exports=ye.asn1=ye.asn1||{};_.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};_.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};_.create=function(t,e,r,n,i){if(ye.util.isArray(n)){for(var s=[],o=0;o<n.length;++o)n[o]!==void 0&&s.push(n[o]);n=s}var a={tagClass:t,type:e,constructed:r,composed:r||ye.util.isArray(n),value:n};return i&&"bitStringContents"in i&&(a.bitStringContents=i.bitStringContents,a.original=_.copy(a)),a};_.copy=function(t,e){var r;if(ye.util.isArray(t)){r=[];for(var n=0;n<t.length;++n)r.push(_.copy(t[n],e));return r}return typeof t=="string"?t:(r={tagClass:t.tagClass,type:t.type,constructed:t.constructed,composed:t.composed,value:_.copy(t.value,e)},e&&!e.excludeBitStringContents&&(r.bitStringContents=t.bitStringContents),r)};_.equals=function(t,e,r){if(ye.util.isArray(t)){if(!ye.util.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!_.equals(t[n],e[n]))return!1;return!0}if(typeof t!=typeof e)return!1;if(typeof t=="string")return t===e;var i=t.tagClass===e.tagClass&&t.type===e.type&&t.constructed===e.constructed&&t.composed===e.composed&&_.equals(t.value,e.value);return r&&r.includeBitStringContents&&(i=i&&t.bitStringContents===e.bitStringContents),i};_.getBerValueLength=function(t){var e=t.getByte();if(e!==128){var r,n=e&128;return n?r=t.getInt((e&127)<<3):r=e,r}};function Wn(t,e,r){if(r>e){var n=new Error("Too few bytes to parse DER.");throw n.available=t.length(),n.remaining=e,n.requested=r,n}}var lg=function(t,e){var r=t.getByte();if(e--,r!==128){var n,i=r&128;if(!i)n=r;else{var s=r&127;Wn(t,e,s),n=t.getInt(s<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};_.fromDer=function(t,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof t=="string"&&(t=ye.util.createBuffer(t));var r=t.length(),n=Fi(t,t.length(),0,e);if(e.parseAllBytes&&t.length()!==0){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=r,i.remaining=t.length(),i}return n};function Fi(t,e,r,n){var i;Wn(t,e,2);var s=t.getByte();e--;var o=s&192,a=s&31;i=t.length();var f=lg(t,e);if(e-=i-t.length(),f!==void 0&&f>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=t.length(),u.remaining=e,u.requested=f,u}f=e}var c,h,l=(s&32)===32;if(l)if(c=[],f===void 0)for(;;){if(Wn(t,e,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),e-=2;break}i=t.length(),c.push(Fi(t,e,r+1,n)),e-=i-t.length()}else for(;f>0;)i=t.length(),c.push(Fi(t,f,r+1,n)),e-=i-t.length(),f-=i-t.length();if(c===void 0&&o===_.Class.UNIVERSAL&&a===_.Type.BITSTRING&&(h=t.bytes(f)),c===void 0&&n.decodeBitStrings&&o===_.Class.UNIVERSAL&&a===_.Type.BITSTRING&&f>1){var d=t.read,p=e,g=0;if(a===_.Type.BITSTRING&&(Wn(t,e,1),g=t.getByte(),e--),g===0)try{i=t.length();var m={strict:!0,decodeBitStrings:!0},v=Fi(t,e,r+1,m),E=i-t.length();e-=E,a==_.Type.BITSTRING&&E++;var I=v.tagClass;E===f&&(I===_.Class.UNIVERSAL||I===_.Class.CONTEXT_SPECIFIC)&&(c=[v])}catch{}c===void 0&&(t.read=d,e=p)}if(c===void 0){if(f===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=e}if(a===_.Type.BMPSTRING)for(c="";f>0;f-=2)Wn(t,e,2),c+=String.fromCharCode(t.getInt16()),e-=2;else c=t.getBytes(f),e-=f}var T=h===void 0?null:{bitStringContents:h};return _.create(o,a,l,c,T)}_.toDer=function(t){var e=ye.util.createBuffer(),r=t.tagClass|t.type,n=ye.util.createBuffer(),i=!1;if("bitStringContents"in t&&(i=!0,t.original&&(i=_.equals(t,t.original))),i)n.putBytes(t.bitStringContents);else if(t.composed){t.constructed?r|=32:n.putByte(0);for(var s=0;s<t.value.length;++s)t.value[s]!==void 0&&n.putBuffer(_.toDer(t.value[s]))}else if(t.type===_.Type.BMPSTRING)for(var s=0;s<t.value.length;++s)n.putInt16(t.value.charCodeAt(s));else t.type===_.Type.INTEGER&&t.value.length>1&&(t.value.charCodeAt(0)===0&&(t.value.charCodeAt(1)&128)===0||t.value.charCodeAt(0)===255&&(t.value.charCodeAt(1)&128)===128)?n.putBytes(t.value.substr(1)):n.putBytes(t.value);if(e.putByte(r),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var s=a.length-1;s>=0;--s)e.putByte(a.charCodeAt(s))}return e.putBuffer(n),e};_.oidToDer=function(t){var e=t.split("."),r=ye.util.createBuffer();r.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,i,s,o,a=2;a<e.length;++a){n=!0,i=[],s=parseInt(e[a],10);do o=s&127,s=s>>>7,n||(o|=128),i.push(o),n=!1;while(s>0);for(var f=i.length-1;f>=0;--f)r.putByte(i[f])}return r};_.derToOid=function(t){var e;typeof t=="string"&&(t=ye.util.createBuffer(t));var r=t.getByte();e=Math.floor(r/40)+"."+r%40;for(var n=0;t.length()>0;)r=t.getByte(),n=n<<7,r&128?n+=r&127:(e+="."+(n+r),n=0);return e};_.utcTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(t.substr(2,2),10)-1,i=parseInt(t.substr(4,2),10),s=parseInt(t.substr(6,2),10),o=parseInt(t.substr(8,2),10),a=0;if(t.length>11){var f=t.charAt(10),u=10;f!=="+"&&f!=="-"&&(a=parseInt(t.substr(10,2),10),u+=2)}if(e.setUTCFullYear(r,n,i),e.setUTCHours(s,o,a,0),u&&(f=t.charAt(u),f==="+"||f==="-")){var c=parseInt(t.substr(u+1,2),10),h=parseInt(t.substr(u+4,2),10),l=c*60+h;l*=6e4,f==="+"?e.setTime(+e-l):e.setTime(+e+l)}return e};_.generalizedTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,4),10),n=parseInt(t.substr(4,2),10)-1,i=parseInt(t.substr(6,2),10),s=parseInt(t.substr(8,2),10),o=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),f=0,u=0,c=!1;t.charAt(t.length-1)==="Z"&&(c=!0);var h=t.length-5,l=t.charAt(h);if(l==="+"||l==="-"){var d=parseInt(t.substr(h+1,2),10),p=parseInt(t.substr(h+4,2),10);u=d*60+p,u*=6e4,l==="+"&&(u*=-1),c=!0}return t.charAt(14)==="."&&(f=parseFloat(t.substr(14),10)*1e3),c?(e.setUTCFullYear(r,n,i),e.setUTCHours(s,o,a,f),e.setTime(+e+u)):(e.setFullYear(r,n,i),e.setHours(s,o,a,f)),e};_.dateToUtcTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push((""+t.getUTCFullYear()).substr(2)),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};_.dateToGeneralizedTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push(""+t.getUTCFullYear()),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};_.integerToDer=function(t){var e=ye.util.createBuffer();if(t>=-128&&t<128)return e.putSignedInt(t,8);if(t>=-32768&&t<32768)return e.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return e.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return e.putSignedInt(t,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=t,r};_.derToInteger=function(t){typeof t=="string"&&(t=ye.util.createBuffer(t));var e=t.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(e)};_.validate=function(t,e,r,n){var i=!1;if((t.tagClass===e.tagClass||typeof e.tagClass>"u")&&(t.type===e.type||typeof e.type>"u"))if(t.constructed===e.constructed||typeof e.constructed>"u"){if(i=!0,e.value&&ye.util.isArray(e.value))for(var s=0,o=0;i&&o<e.value.length;++o)i=e.value[o].optional||!1,t.value[s]&&(i=_.validate(t.value[s],e.value[o],r,n),i?++s:e.value[o].optional&&(i=!0)),!i&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+t.value.length+'"');if(i&&r&&(e.capture&&(r[e.capture]=t.value),e.captureAsn1&&(r[e.captureAsn1]=t),e.captureBitStringContents&&"bitStringContents"in t&&(r[e.captureBitStringContents]=t.bitStringContents),e.captureBitStringValue&&"bitStringContents"in t)){var a;if(t.bitStringContents.length<2)r[e.captureBitStringValue]="";else{var f=t.bitStringContents.charCodeAt(0);if(f!==0)throw new Error("captureBitStringValue only supported for zero unused bits");r[e.captureBitStringValue]=t.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+t.constructed+'"');else n&&(t.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+t.tagClass+'"'),t.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+t.type+'"'));return i};var jc=/[^\\u0000-\\u00ff]/;_.prettyPrint=function(t,e,r){var n="";e=e||0,r=r||2,e>0&&(n+=`
`);for(var i="",s=0;s<e*r;++s)i+=" ";switch(n+=i+"Tag: ",t.tagClass){case _.Class.UNIVERSAL:n+="Universal:";break;case _.Class.APPLICATION:n+="Application:";break;case _.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case _.Class.PRIVATE:n+="Private:";break}if(t.tagClass===_.Class.UNIVERSAL)switch(n+=t.type,t.type){case _.Type.NONE:n+=" (None)";break;case _.Type.BOOLEAN:n+=" (Boolean)";break;case _.Type.INTEGER:n+=" (Integer)";break;case _.Type.BITSTRING:n+=" (Bit string)";break;case _.Type.OCTETSTRING:n+=" (Octet string)";break;case _.Type.NULL:n+=" (Null)";break;case _.Type.OID:n+=" (Object Identifier)";break;case _.Type.ODESC:n+=" (Object Descriptor)";break;case _.Type.EXTERNAL:n+=" (External or Instance of)";break;case _.Type.REAL:n+=" (Real)";break;case _.Type.ENUMERATED:n+=" (Enumerated)";break;case _.Type.EMBEDDED:n+=" (Embedded PDV)";break;case _.Type.UTF8:n+=" (UTF8)";break;case _.Type.ROID:n+=" (Relative Object Identifier)";break;case _.Type.SEQUENCE:n+=" (Sequence)";break;case _.Type.SET:n+=" (Set)";break;case _.Type.PRINTABLESTRING:n+=" (Printable String)";break;case _.Type.IA5String:n+=" (IA5String (ASCII))";break;case _.Type.UTCTIME:n+=" (UTC time)";break;case _.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case _.Type.BMPSTRING:n+=" (BMP String)";break}else n+=t.type;if(n+=`
`,n+=i+"Constructed: "+t.constructed+`
`,t.composed){for(var o=0,a="",s=0;s<t.value.length;++s)t.value[s]!==void 0&&(o+=1,a+=_.prettyPrint(t.value[s],e+1,r),s+1<t.value.length&&(a+=","));n+=i+"Sub values: "+o+a}else{if(n+=i+"Value: ",t.type===_.Type.OID){var f=_.derToOid(t.value);n+=f,ye.pki&&ye.pki.oids&&f in ye.pki.oids&&(n+=" ("+ye.pki.oids[f]+") ")}if(t.type===_.Type.INTEGER)try{n+=_.derToInteger(t.value)}catch{n+="0x"+ye.util.bytesToHex(t.value)}else if(t.type===_.Type.BITSTRING){if(t.value.length>1?n+="0x"+ye.util.bytesToHex(t.value.slice(1)):n+="(none)",t.value.length>0){var u=t.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(t.type===_.Type.OCTETSTRING)jc.test(t.value)||(n+="("+t.value+") "),n+="0x"+ye.util.bytesToHex(t.value);else if(t.type===_.Type.UTF8)try{n+=ye.util.decodeUtf8(t.value)}catch(c){if(c.message==="URI malformed")n+="0x"+ye.util.bytesToHex(t.value)+" (malformed UTF8)";else throw c}else t.type===_.Type.PRINTABLESTRING||t.type===_.Type.IA5String?n+=t.value:jc.test(t.value)?n+="0x"+ye.util.bytesToHex(t.value):t.value.length===0?n+="[null]":n+=t.value}return n}});var So=L((BE,Zc)=>{var Fe=ae();Be();Zc.exports=Fe.cipher=Fe.cipher||{};Fe.cipher.algorithms=Fe.cipher.algorithms||{};Fe.cipher.createCipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Fe.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Fe.cipher.BlockCipher({algorithm:r,key:e,decrypt:!1})};Fe.cipher.createDecipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Fe.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Fe.cipher.BlockCipher({algorithm:r,key:e,decrypt:!0})};Fe.cipher.registerAlgorithm=function(t,e){t=t.toUpperCase(),Fe.cipher.algorithms[t]=e};Fe.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in Fe.cipher.algorithms?Fe.cipher.algorithms[t]:null};var Eo=Fe.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};Eo.prototype.start=function(t){t=t||{};var e={};for(var r in t)e[r]=t[r];e.decrypt=this._decrypt,this._finish=!1,this._input=Fe.util.createBuffer(),this.output=t.output||Fe.util.createBuffer(),this.mode.start(e)};Eo.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};Eo.prototype.finish=function(t){t&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(r){return t(this.blockSize,r,!1)},this.mode.unpad=function(r){return t(this.blockSize,r,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var Co=L((PE,Qc)=>{var Ue=ae();Be();Ue.cipher=Ue.cipher||{};var $=Qc.exports=Ue.cipher.modes=Ue.cipher.modes||{};$.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};$.ecb.prototype.start=function(t){};$.ecb.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};$.ecb.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};$.ecb.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};$.ecb.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};$.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};$.cbc.prototype.start=function(t){if(t.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in t)this._iv=Ui(t.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};$.cbc.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};$.cbc.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};$.cbc.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};$.cbc.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};$.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Ue.util.createBuffer(),this._partialBytes=0};$.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ui(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};$.cfb.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=t.getInt32()^this._outBlock[i],e.putInt32(this._inBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=t.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)t.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};$.cfb.prototype.decrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=t.getInt32(),e.putInt32(this._inBlock[i]^this._outBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)t.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};$.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Ue.util.createBuffer(),this._partialBytes=0};$.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ui(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};$.ofb.prototype.encrypt=function(t,e,r){var n=t.length();if(t.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(t.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s>0)t.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};$.ofb.prototype.decrypt=$.ofb.prototype.encrypt;$.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Ue.util.createBuffer(),this._partialBytes=0};$.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ui(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};$.ctr.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(t.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}Ki(this._inBlock)};$.ctr.prototype.decrypt=$.ctr.prototype.encrypt;$.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Ue.util.createBuffer(),this._partialBytes=0,this._R=3774873600};$.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var e=Ue.util.createBuffer(t.iv);this._cipherLength=0;var r;if("additionalData"in t?r=Ue.util.createBuffer(t.additionalData):r=Ue.util.createBuffer(),"tagLength"in t?this._tagLength=t.tagLength:this._tagLength=128,this._tag=null,t.decrypt&&(this._tag=Ue.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(Do(n*8)))}this._inBlock=this._j0.slice(0),Ki(this._inBlock),this._partialBytes=0,r=Ue.util.createBuffer(r),this._aDataLength=Do(r.length()*8);var i=r.length()%this.blockSize;for(i&&r.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];r.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()])};$.gcm.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^=t.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),Ki(this._inBlock)};$.gcm.prototype.decrypt=function(t,e,r){var n=t.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),Ki(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};$.gcm.prototype.afterFinish=function(t,e){var r=!0;e.decrypt&&e.overflow&&t.truncate(this.blockSize-e.overflow),this.tag=Ue.util.createBuffer();var n=this._aDataLength.concat(Do(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var i=[];this.cipher.encrypt(this._j0,i);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^i[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r};$.gcm.prototype.multiply=function(t,e){for(var r=[0,0,0,0],n=e.slice(0),i=0;i<128;++i){var s=t[i/32|0]&1<<31-i%32;s&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r};$.gcm.prototype.pow=function(t,e){for(var r=t[3]&1,n=3;n>0;--n)e[n]=t[n]>>>1|(t[n-1]&1)<<31;e[0]=t[0]>>>1,r&&(e[0]^=this._R)};$.gcm.prototype.tableMultiply=function(t){for(var e=[0,0,0,0],r=0;r<32;++r){var n=r/8|0,i=t[n]>>>(7-r%8)*4&15,s=this._m[r][i];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e};$.gcm.prototype.ghash=function(t,e,r){return e[0]^=r[0],e[1]^=r[1],e[2]^=r[2],e[3]^=r[3],this.tableMultiply(e)};$.gcm.prototype.generateHashTable=function(t,e){for(var r=8/e,n=4*r,i=16*r,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],f=o/n|0,u=(n-1-o%n)*e;a[f]=1<<e-1<<u,s[o]=this.generateSubHashTable(this.multiply(a,t),e)}return s};$.gcm.prototype.generateSubHashTable=function(t,e){var r=1<<e,n=r>>>1,i=new Array(r);i[n]=t.slice(0);for(var s=n>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;s<n;){for(var o=1;o<s;++o){var a=i[s],f=i[o];i[s+o]=[a[0]^f[0],a[1]^f[1],a[2]^f[2],a[3]^f[3]]}s*=2}for(i[0]=[0,0,0,0],s=n+1;s<r;++s){var u=i[s^n];i[s]=[t[0]^u[0],t[1]^u[1],t[2]^u[2],t[3]^u[3]]}return i};function Ui(t,e){if(typeof t=="string"&&(t=Ue.util.createBuffer(t)),Ue.util.isArray(t)&&t.length>4){var r=t;t=Ue.util.createBuffer();for(var n=0;n<r.length;++n)t.putByte(r[n])}if(t.length()<e)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+e+" bytes.");if(!Ue.util.isArray(t)){for(var i=[],s=e/4,n=0;n<s;++n)i.push(t.getInt32());t=i}return t}function Ki(t){t[t.length-1]=t[t.length-1]+1&4294967295}function Do(t){return[t/4294967296|0,t&4294967295]}});var zi=L((RE,tu)=>{var pe=ae();So();Co();Be();tu.exports=pe.aes=pe.aes||{};pe.aes.startEncrypting=function(t,e,r,n){var i=Vi({key:t,output:r,decrypt:!1,mode:n});return i.start(e),i};pe.aes.createEncryptionCipher=function(t,e){return Vi({key:t,output:null,decrypt:!1,mode:e})};pe.aes.startDecrypting=function(t,e,r,n){var i=Vi({key:t,output:r,decrypt:!0,mode:n});return i.start(e),i};pe.aes.createDecryptionCipher=function(t,e){return Vi({key:t,output:null,decrypt:!0,mode:e})};pe.aes.Algorithm=function(t,e){_o||Jc();var r=this;r.name=t,r.mode=new e({blockSize:16,cipher:{encrypt:function(n,i){return Ao(r._w,n,i,!1)},decrypt:function(n,i){return Ao(r._w,n,i,!0)}}}),r._init=!1};pe.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var e=t.key,r;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=pe.util.createBuffer(e);else if(pe.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){r=e,e=pe.util.createBuffer();for(var n=0;n<r.length;++n)e.putByte(r[n])}if(!pe.util.isArray(e)){r=e,e=[];var i=r.length();if(i===16||i===24||i===32){i=i>>>2;for(var n=0;n<i;++n)e.push(r.getInt32())}}if(!pe.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var s=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(s)!==-1;this._w=eu(e,t.decrypt&&!o),this._init=!0}};pe.aes._expandKey=function(t,e){return _o||Jc(),eu(t,e)};pe.aes._updateBlock=Ao;sn("AES-ECB",pe.cipher.modes.ecb);sn("AES-CBC",pe.cipher.modes.cbc);sn("AES-CFB",pe.cipher.modes.cfb);sn("AES-OFB",pe.cipher.modes.ofb);sn("AES-CTR",pe.cipher.modes.ctr);sn("AES-GCM",pe.cipher.modes.gcm);function sn(t,e){var r=function(){return new pe.aes.Algorithm(t,e)};pe.cipher.registerAlgorithm(t,r)}var _o=!1,nn=4,$e,Io,Xc,Sr,bt;function Jc(){_o=!0,Xc=[0,1,2,4,8,16,32,64,128,27,54];for(var t=new Array(256),e=0;e<128;++e)t[e]=e<<1,t[e+128]=e+128<<1^283;$e=new Array(256),Io=new Array(256),Sr=new Array(4),bt=new Array(4);for(var e=0;e<4;++e)Sr[e]=new Array(256),bt[e]=new Array(256);for(var r=0,n=0,i,s,o,a,f,u,c,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,$e[r]=a,Io[a]=r,f=t[a],i=t[r],s=t[i],o=t[s],u=f<<24^a<<16^a<<8^(a^f),c=(i^s^o)<<24^(r^o)<<16^(r^s^o)<<8^(r^i^o);for(var h=0;h<4;++h)Sr[h][r]=u,bt[h][a]=c,u=u<<24|u>>>8,c=c<<24|c>>>8;r===0?r=n=1:(r=i^t[t[t[i^o]]],n^=t[t[n]])}}function eu(t,e){for(var r=t.slice(0),n,i=1,s=r.length,o=s+6+1,a=nn*o,f=s;f<a;++f)n=r[f-1],f%s===0?(n=$e[n>>>16&255]<<24^$e[n>>>8&255]<<16^$e[n&255]<<8^$e[n>>>24]^Xc[i]<<24,i++):s>6&&f%s===4&&(n=$e[n>>>24]<<24^$e[n>>>16&255]<<16^$e[n>>>8&255]<<8^$e[n&255]),r[f]=r[f-s]^n;if(e){var u,c=bt[0],h=bt[1],l=bt[2],d=bt[3],p=r.slice(0);a=r.length;for(var f=0,g=a-nn;f<a;f+=nn,g-=nn)if(f===0||f===a-nn)p[f]=r[g],p[f+1]=r[g+3],p[f+2]=r[g+2],p[f+3]=r[g+1];else for(var m=0;m<nn;++m)u=r[g+m],p[f+(3&-m)]=c[$e[u>>>24]]^h[$e[u>>>16&255]]^l[$e[u>>>8&255]]^d[$e[u&255]];r=p}return r}function Ao(t,e,r,n){var i=t.length/4-1,s,o,a,f,u;n?(s=bt[0],o=bt[1],a=bt[2],f=bt[3],u=Io):(s=Sr[0],o=Sr[1],a=Sr[2],f=Sr[3],u=$e);var c,h,l,d,p,g,m;c=e[0]^t[0],h=e[n?3:1]^t[1],l=e[2]^t[2],d=e[n?1:3]^t[3];for(var v=3,E=1;E<i;++E)p=s[c>>>24]^o[h>>>16&255]^a[l>>>8&255]^f[d&255]^t[++v],g=s[h>>>24]^o[l>>>16&255]^a[d>>>8&255]^f[c&255]^t[++v],m=s[l>>>24]^o[d>>>16&255]^a[c>>>8&255]^f[h&255]^t[++v],d=s[d>>>24]^o[c>>>16&255]^a[h>>>8&255]^f[l&255]^t[++v],c=p,h=g,l=m;r[0]=u[c>>>24]<<24^u[h>>>16&255]<<16^u[l>>>8&255]<<8^u[d&255]^t[++v],r[n?3:1]=u[h>>>24]<<24^u[l>>>16&255]<<16^u[d>>>8&255]<<8^u[c&255]^t[++v],r[2]=u[l>>>24]<<24^u[d>>>16&255]<<16^u[c>>>8&255]<<8^u[h&255]^t[++v],r[n?1:3]=u[d>>>24]<<24^u[c>>>16&255]<<16^u[h>>>8&255]<<8^u[l&255]^t[++v]}function Vi(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="AES-"+e,n;t.decrypt?n=pe.cipher.createDecipher(r,t.key):n=pe.cipher.createCipher(r,t.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof pe.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var iu=L((LE,nu)=>{var we=ae();So();Co();Be();nu.exports=we.des=we.des||{};we.des.startEncrypting=function(t,e,r,n){var i=qi({key:t,output:r,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};we.des.createEncryptionCipher=function(t,e){return qi({key:t,output:null,decrypt:!1,mode:e})};we.des.startDecrypting=function(t,e,r,n){var i=qi({key:t,output:r,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};we.des.createDecryptionCipher=function(t,e){return qi({key:t,output:null,decrypt:!0,mode:e})};we.des.Algorithm=function(t,e){var r=this;r.name=t,r.mode=new e({blockSize:8,cipher:{encrypt:function(n,i){return ru(r._keys,n,i,!1)},decrypt:function(n,i){return ru(r._keys,n,i,!0)}}}),r._init=!1};we.des.Algorithm.prototype.initialize=function(t){if(!this._init){var e=we.util.createBuffer(t.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=wg(e),this._init=!0}};_t("DES-ECB",we.cipher.modes.ecb);_t("DES-CBC",we.cipher.modes.cbc);_t("DES-CFB",we.cipher.modes.cfb);_t("DES-OFB",we.cipher.modes.ofb);_t("DES-CTR",we.cipher.modes.ctr);_t("3DES-ECB",we.cipher.modes.ecb);_t("3DES-CBC",we.cipher.modes.cbc);_t("3DES-CFB",we.cipher.modes.cfb);_t("3DES-OFB",we.cipher.modes.ofb);_t("3DES-CTR",we.cipher.modes.ctr);function _t(t,e){var r=function(){return new we.des.Algorithm(t,e)};we.cipher.registerAlgorithm(t,r)}var pg=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],dg=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],gg=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],yg=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],mg=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],bg=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],vg=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],xg=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function wg(t){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],f=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],c=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],h=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],l=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=t.length()>8?3:1,m=[],v=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,I,T=0;T<g;T++){var x=t.getInt32(),C=t.getInt32();I=(x>>>4^C)&252645135,C^=I,x^=I<<4,I=(C>>>-16^x)&65535,x^=I,C^=I<<-16,I=(x>>>2^C)&858993459,C^=I,x^=I<<2,I=(C>>>-16^x)&65535,x^=I,C^=I<<-16,I=(x>>>1^C)&1431655765,C^=I,x^=I<<1,I=(C>>>8^x)&16711935,x^=I,C^=I<<8,I=(x>>>1^C)&1431655765,C^=I,x^=I<<1,I=x<<8|C>>>20&240,x=C<<24|C<<8&16711680|C>>>8&65280|C>>>24&240,C=I;for(var P=0;P<v.length;++P){v[P]?(x=x<<2|x>>>26,C=C<<2|C>>>26):(x=x<<1|x>>>27,C=C<<1|C>>>27),x&=-15,C&=-15;var N=e[x>>>28]|r[x>>>24&15]|n[x>>>20&15]|i[x>>>16&15]|s[x>>>12&15]|o[x>>>8&15]|a[x>>>4&15],q=f[C>>>28]|u[C>>>24&15]|c[C>>>20&15]|h[C>>>16&15]|l[C>>>12&15]|d[C>>>8&15]|p[C>>>4&15];I=(q>>>16^N)&65535,m[E++]=N^I,m[E++]=q^I<<16}}return m}function ru(t,e,r,n){var i=t.length===32?3:9,s;i===3?s=n?[30,-2,-2]:[0,32,2]:s=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],f=e[1];o=(a>>>4^f)&252645135,f^=o,a^=o<<4,o=(a>>>16^f)&65535,f^=o,a^=o<<16,o=(f>>>2^a)&858993459,a^=o,f^=o<<2,o=(f>>>8^a)&16711935,a^=o,f^=o<<8,o=(a>>>1^f)&1431655765,f^=o,a^=o<<1,a=a<<1|a>>>31,f=f<<1|f>>>31;for(var u=0;u<i;u+=3){for(var c=s[u+1],h=s[u+2],l=s[u];l!=c;l+=h){var d=f^t[l],p=(f>>>4|f<<28)^t[l+1];o=a,a=f,f=o^(dg[d>>>24&63]|yg[d>>>16&63]|bg[d>>>8&63]|xg[d&63]|pg[p>>>24&63]|gg[p>>>16&63]|mg[p>>>8&63]|vg[p&63])}o=a,a=f,f=o}a=a>>>1|a<<31,f=f>>>1|f<<31,o=(a>>>1^f)&1431655765,f^=o,a^=o<<1,o=(f>>>8^a)&16711935,a^=o,f^=o<<8,o=(f>>>2^a)&858993459,a^=o,f^=o<<2,o=(a>>>16^f)&65535,f^=o,a^=o<<16,o=(a>>>4^f)&252645135,f^=o,a^=o<<4,r[0]=a,r[1]=f}function qi(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="DES-"+e,n;t.decrypt?n=we.cipher.createDecipher(r,t.key):n=we.cipher.createCipher(r,t.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof we.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var Dr=L((ME,su)=>{var Gi=ae();su.exports=Gi.md=Gi.md||{};Gi.md.algorithms=Gi.md.algorithms||{}});var au=L((kE,ou)=>{var $t=ae();Dr();Be();var Eg=ou.exports=$t.hmac=$t.hmac||{};Eg.create=function(){var t=null,e=null,r=null,n=null,i={};return i.start=function(s,o){if(s!==null)if(typeof s=="string")if(s=s.toLowerCase(),s in $t.md.algorithms)e=$t.md.algorithms[s].create();else throw new Error('Unknown hash algorithm "'+s+'"');else e=s;if(o===null)o=t;else{if(typeof o=="string")o=$t.util.createBuffer(o);else if($t.util.isArray(o)){var a=o;o=$t.util.createBuffer();for(var f=0;f<a.length;++f)o.putByte(a[f])}var u=o.length();u>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),r=$t.util.createBuffer(),n=$t.util.createBuffer(),u=o.length();for(var f=0;f<u;++f){var a=o.at(f);r.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,f=0;f<a;++f)r.putByte(54),n.putByte(92);t=o,r=r.bytes(),n=n.bytes()}e.start(),e.update(r)},i.update=function(s){e.update(s)},i.getMac=function(){var s=e.digest().bytes();return e.start(),e.update(n),e.update(s),e.digest()},i.digest=i.getMac,i}});var on=L(()=>{});var To=L((FE,cu)=>{var je=ae();au();Dr();Be();var Sg=je.pkcs5=je.pkcs5||{},jt;je.util.isNodejs&&!je.options.usePureJavaScript&&(jt=on());cu.exports=je.pbkdf2=Sg.pbkdf2=function(t,e,r,n,i,s){if(typeof i=="function"&&(s=i,i=null),je.util.isNodejs&&!je.options.usePureJavaScript&&jt.pbkdf2&&(i===null||typeof i!="object")&&(jt.pbkdf2Sync.length>4||!i||i==="sha1"))return typeof i!="string"&&(i="sha1"),t=Buffer.from(t,"binary"),e=Buffer.from(e,"binary"),s?jt.pbkdf2Sync.length===4?jt.pbkdf2(t,e,r,n,function(I,T){if(I)return s(I);s(null,T.toString("binary"))}):jt.pbkdf2(t,e,r,n,i,function(I,T){if(I)return s(I);s(null,T.toString("binary"))}):jt.pbkdf2Sync.length===4?jt.pbkdf2Sync(t,e,r,n).toString("binary"):jt.pbkdf2Sync(t,e,r,n,i).toString("binary");if((typeof i>"u"||i===null)&&(i="sha1"),typeof i=="string"){if(!(i in je.md.algorithms))throw new Error("Unknown hash algorithm: "+i);i=je.md[i].create()}var o=i.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(s)return s(a);throw a}var f=Math.ceil(n/o),u=n-(f-1)*o,c=je.hmac.create();c.start(i,t);var h="",l,d,p;if(!s){for(var g=1;g<=f;++g){c.start(null,null),c.update(e),c.update(je.util.int32ToBytes(g)),l=p=c.digest().getBytes();for(var m=2;m<=r;++m)c.start(null,null),c.update(p),d=c.digest().getBytes(),l=je.util.xorBytes(l,d,o),p=d;h+=g<f?l:l.substr(0,u)}return h}var g=1,m;function v(){if(g>f)return s(null,h);c.start(null,null),c.update(e),c.update(je.util.int32ToBytes(g)),l=p=c.digest().getBytes(),m=2,E()}function E(){if(m<=r)return c.start(null,null),c.update(p),d=c.digest().getBytes(),l=je.util.xorBytes(l,d,o),p=d,++m,je.util.setImmediate(E);h+=g<f?l:l.substr(0,u),++g,v()}v()}});var hu=L((UE,fu)=>{var Wi=ae();Be();var uu=fu.exports=Wi.pem=Wi.pem||{};uu.encode=function(t,e){e=e||{};var r="-----BEGIN "+t.type+`-----\r
`,n;if(t.procType&&(n={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},r+=Hi(n)),t.contentDomain&&(n={name:"Content-Domain",values:[t.contentDomain]},r+=Hi(n)),t.dekInfo&&(n={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&n.values.push(t.dekInfo.parameters),r+=Hi(n)),t.headers)for(var i=0;i<t.headers.length;++i)r+=Hi(t.headers[i]);return t.procType&&(r+=`\r
`),r+=Wi.util.encode64(t.body,e.maxline||64)+`\r
`,r+="-----END "+t.type+`-----\r
`,r};uu.decode=function(t){for(var e=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/,s;s=r.exec(t),!!s;){var o=s[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:Wi.util.decode64(s[3])};if(e.push(a),!!s[2]){for(var f=s[2].split(i),u=0;s&&u<f.length;){for(var c=f[u].replace(/\s+$/,""),h=u+1;h<f.length;++h){var l=f[h];if(!/\s/.test(l[0]))break;c+=l,u=h}if(s=c.match(n),s){for(var d={name:s[1],values:[]},p=s[2].split(","),g=0;g<p.length;++g)d.values.push(Dg(p[g]));if(a.procType)if(!a.contentDomain&&d.name==="Content-Domain")a.contentDomain=p[0]||"";else if(!a.dekInfo&&d.name==="DEK-Info"){if(d.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:p[0],parameters:p[1]||null}}else a.headers.push(d);else{if(d.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(d.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:p[0],type:p[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function Hi(t){for(var e=t.name+": ",r=[],n=function(f,u){return" "+u},i=0;i<t.values.length;++i)r.push(t.values[i].replace(/^(\S+\r\n)/,n));e+=r.join(",")+`\r
`;for(var s=0,o=-1,i=0;i<e.length;++i,++s)if(s>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),s=i-o-1,o=-1,++i}else(e[i]===" "||e[i]==="	"||e[i]===",")&&(o=i);return e}function Dg(t){return t.replace(/^\s+/,"")}});var mu=L((KE,yu)=>{var Tt=ae();Dr();Be();var pu=yu.exports=Tt.sha256=Tt.sha256||{};Tt.md.sha256=Tt.md.algorithms.sha256=pu;pu.create=function(){du||Cg();var t=null,e=Tt.util.createBuffer(),r=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=Tt.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=Tt.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),lu(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Tt.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(Bo.substr(0,n.blockLength-o));for(var a,f,u=n.fullMessageLength[0]*8,c=0;c<n.fullMessageLength.length-1;++c)a=n.fullMessageLength[c+1]*8,f=a/4294967296>>>0,u+=f,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var h={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};lu(h,r,i);var l=Tt.util.createBuffer();return l.putInt32(h.h0),l.putInt32(h.h1),l.putInt32(h.h2),l.putInt32(h.h3),l.putInt32(h.h4),l.putInt32(h.h5),l.putInt32(h.h6),l.putInt32(h.h7),l},n};var Bo=null,du=!1,gu=null;function Cg(){Bo=String.fromCharCode(128),Bo+=Tt.util.fillString(String.fromCharCode(0),64),gu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],du=!0}function lu(t,e,r){for(var n,i,s,o,a,f,u,c,h,l,d,p,g,m,v,E=r.length();E>=64;){for(u=0;u<16;++u)e[u]=r.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=e[u-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,e[u]=n+e[u-7]+i+e[u-16]|0;for(c=t.h0,h=t.h1,l=t.h2,d=t.h3,p=t.h4,g=t.h5,m=t.h6,v=t.h7,u=0;u<64;++u)o=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),a=m^p&(g^m),s=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),f=c&h|l&(c^h),n=v+o+a+gu[u]+e[u],i=s+f,v=m,m=g,g=p,p=d+n>>>0,d=l,l=h,h=c,c=n+i>>>0;t.h0=t.h0+c|0,t.h1=t.h1+h|0,t.h2=t.h2+l|0,t.h3=t.h3+d|0,t.h4=t.h4+p|0,t.h5=t.h5+g|0,t.h6=t.h6+m|0,t.h7=t.h7+v|0,E-=64}}});var vu=L((VE,bu)=>{var Bt=ae();Be();var $i=null;Bt.util.isNodejs&&!Bt.options.usePureJavaScript&&!process.versions["node-webkit"]&&($i=on());var Ig=bu.exports=Bt.prng=Bt.prng||{};Ig.create=function(t){for(var e={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=t.md,n=new Array(32),i=0;i<32;++i)n[i]=r.create();e.pools=n,e.pool=0,e.generate=function(u,c){if(!c)return e.generateSync(u);var h=e.plugin.cipher,l=e.plugin.increment,d=e.plugin.formatKey,p=e.plugin.formatSeed,g=Bt.util.createBuffer();e.key=null,m();function m(v){if(v)return c(v);if(g.length()>=u)return c(null,g.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return Bt.util.nextTick(function(){s(m)});var E=h(e.key,e.seed);e.generated+=E.length,g.putBytes(E),e.key=d(h(e.key,l(e.seed))),e.seed=p(h(e.key,e.seed)),Bt.util.setImmediate(m)}},e.generateSync=function(u){var c=e.plugin.cipher,h=e.plugin.increment,l=e.plugin.formatKey,d=e.plugin.formatSeed;e.key=null;for(var p=Bt.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&o();var g=c(e.key,e.seed);e.generated+=g.length,p.putBytes(g),e.key=l(c(e.key,h(e.seed))),e.seed=d(c(e.key,e.seed))}return p.getBytes(u)};function s(u){if(e.pools[0].messageLength>=32)return a(),u();var c=32-e.pools[0].messageLength<<5;e.seedFile(c,function(h,l){if(h)return u(h);e.collect(l),a(),u()})}function o(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var c=1,h=0;h<32;++h)e.reseeds%c===0&&(u.update(e.pools[h].digest().getBytes()),e.pools[h].start()),c=c<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var l=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(l),e.generated=0}function f(u){var c=null,h=Bt.util.globalScope,l=h.crypto||h.msCrypto;l&&l.getRandomValues&&(c=function(x){return l.getRandomValues(x)});var d=Bt.util.createBuffer();if(c)for(;d.length()<u;){var p=Math.max(1,Math.min(u-d.length(),65536)/4),g=new Uint32Array(Math.floor(p));try{c(g);for(var m=0;m<g.length;++m)d.putInt32(g[m])}catch(x){if(!(typeof QuotaExceededError<"u"&&x instanceof QuotaExceededError))throw x}}if(d.length()<u)for(var v,E,I,T=Math.floor(Math.random()*65536);d.length()<u;){E=16807*(T&65535),v=16807*(T>>16),E+=(v&32767)<<16,E+=v>>15,E=(E&2147483647)+(E>>31),T=E&4294967295;for(var m=0;m<3;++m)I=T>>>(m<<3),I^=Math.floor(Math.random()*256),d.putByte(I&255)}return d.getBytes(u)}return $i?(e.seedFile=function(u,c){$i.randomBytes(u,function(h,l){if(h)return c(h);c(null,l.toString())})},e.seedFileSync=function(u){return $i.randomBytes(u).toString()}):(e.seedFile=function(u,c){try{c(null,f(u))}catch(h){c(h)}},e.seedFileSync=f),e.collect=function(u){for(var c=u.length,h=0;h<c;++h)e.pools[e.pool].update(u.substr(h,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,c){for(var h="",l=0;l<c;l+=8)h+=String.fromCharCode(u>>l&255);e.collect(h)},e.registerWorker=function(u){if(u===self)e.seedFile=function(h,l){function d(p){var g=p.data;g.forge&&g.forge.prng&&(self.removeEventListener("message",d),l(g.forge.prng.err,g.forge.prng.bytes))}self.addEventListener("message",d),self.postMessage({forge:{prng:{needed:h}}})};else{var c=function(h){var l=h.data;l.forge&&l.forge.prng&&e.seedFile(l.forge.prng.needed,function(d,p){u.postMessage({forge:{prng:{err:d,bytes:p}}})})};u.addEventListener("message",c)}},e}});var jn=L((zE,Po)=>{var Ke=ae();zi();mu();vu();Be();(function(){if(Ke.random&&Ke.random.getBytes){Po.exports=Ke.random;return}(function(t){var e={},r=new Array(4),n=Ke.util.createBuffer();e.formatKey=function(h){var l=Ke.util.createBuffer(h);return h=new Array(4),h[0]=l.getInt32(),h[1]=l.getInt32(),h[2]=l.getInt32(),h[3]=l.getInt32(),Ke.aes._expandKey(h,!1)},e.formatSeed=function(h){var l=Ke.util.createBuffer(h);return h=new Array(4),h[0]=l.getInt32(),h[1]=l.getInt32(),h[2]=l.getInt32(),h[3]=l.getInt32(),h},e.cipher=function(h,l){return Ke.aes._updateBlock(h,l,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},e.increment=function(h){return++h[3],h},e.md=Ke.md.sha256;function i(){var h=Ke.prng.create(e);return h.getBytes=function(l,d){return h.generate(l,d)},h.getBytesSync=function(l){return h.generate(l)},h}var s=i(),o=null,a=Ke.util.globalScope,f=a.crypto||a.msCrypto;if(f&&f.getRandomValues&&(o=function(h){return f.getRandomValues(h)}),Ke.options.usePureJavaScript||!Ke.util.isNodejs&&!o){if(typeof window>"u"||window.document,s.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var c in navigator)try{typeof navigator[c]=="string"&&(u+=navigator[c])}catch{}s.collect(u),u=null}t&&(t().mousemove(function(h){s.collectInt(h.clientX,16),s.collectInt(h.clientY,16)}),t().keypress(function(h){s.collectInt(h.charCode,8)}))}if(!Ke.random)Ke.random=s;else for(var c in s)Ke.random[c]=s[c];Ke.random.createInstance=i,Po.exports=Ke.random})(typeof jQuery<"u"?jQuery:null)})()});var Su=L((qE,Eu)=>{var et=ae();Be();var Ro=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],xu=[1,2,3,5],Ag=function(t,e){return t<<e&65535|(t&65535)>>16-e},_g=function(t,e){return(t&65535)>>e|t<<16-e&65535};Eu.exports=et.rc2=et.rc2||{};et.rc2.expandKey=function(t,e){typeof t=="string"&&(t=et.util.createBuffer(t)),e=e||128;var r=t,n=t.length(),i=e,s=Math.ceil(i/8),o=255>>(i&7),a;for(a=n;a<128;a++)r.putByte(Ro[r.at(a-1)+r.at(a-n)&255]);for(r.setAt(128-s,Ro[r.at(128-s)&o]),a=127-s;a>=0;a--)r.setAt(a,Ro[r.at(a+1)^r.at(a+s)]);return r};var wu=function(t,e,r){var n=!1,i=null,s=null,o=null,a,f,u,c,h=[];for(t=et.rc2.expandKey(t,e),u=0;u<64;u++)h.push(t.getInt16Le());r?(a=function(p){for(u=0;u<4;u++)p[u]+=h[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=Ag(p[u],xu[u]),c++},f=function(p){for(u=0;u<4;u++)p[u]+=h[p[(u+3)%4]&63]}):(a=function(p){for(u=3;u>=0;u--)p[u]=_g(p[u],xu[u]),p[u]-=h[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),c--},f=function(p){for(u=3;u>=0;u--)p[u]-=h[p[(u+3)%4]&63]});var l=function(p){var g=[];for(u=0;u<4;u++){var m=i.getInt16Le();o!==null&&(r?m^=o.getInt16Le():o.putInt16Le(m)),g.push(m&65535)}c=r?0:63;for(var v=0;v<p.length;v++)for(var E=0;E<p[v][0];E++)p[v][1](g);for(u=0;u<4;u++)o!==null&&(r?o.putInt16Le(g[u]):g[u]^=o.getInt16Le()),s.putInt16Le(g[u])},d=null;return d={start:function(p,g){p&&typeof p=="string"&&(p=et.util.createBuffer(p)),n=!1,i=et.util.createBuffer(),s=g||new et.util.createBuffer,o=p,d.output=s},update:function(p){for(n||i.putBuffer(p);i.length()>=8;)l([[5,a],[1,f],[6,a],[1,f],[5,a]])},finish:function(p){var g=!0;if(r)if(p)g=p(8,i,!r);else{var m=i.length()===8?8:8-i.length();i.fillWithByte(m,m)}if(g&&(n=!0,d.update()),!r&&(g=i.length()===0,g))if(p)g=p(8,s,!r);else{var v=s.length(),E=s.at(v-1);E>v?g=!1:s.truncate(E)}return g}},d};et.rc2.startEncrypting=function(t,e,r){var n=et.rc2.createEncryptionCipher(t,128);return n.start(e,r),n};et.rc2.createEncryptionCipher=function(t,e){return wu(t,e,!0)};et.rc2.startDecrypting=function(t,e,r){var n=et.rc2.createDecryptionCipher(t,128);return n.start(e,r),n};et.rc2.createDecryptionCipher=function(t,e){return wu(t,e,!1)}});var Zi=L((GE,Pu)=>{var Lo=ae();Pu.exports=Lo.jsbn=Lo.jsbn||{};var Yt,Tg=0xdeadbeefcafe,Du=(Tg&16777215)==15715070;function S(t,e,r){this.data=[],t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}Lo.jsbn.BigInteger=S;function J(){return new S(null)}function Bg(t,e,r,n,i,s){for(;--s>=0;){var o=e*this.data[t++]+r.data[n]+i;i=Math.floor(o/67108864),r.data[n++]=o&67108863}return i}function Pg(t,e,r,n,i,s){for(var o=e&32767,a=e>>15;--s>=0;){var f=this.data[t]&32767,u=this.data[t++]>>15,c=a*f+u*o;f=o*f+((c&32767)<<15)+r.data[n]+(i&1073741823),i=(f>>>30)+(c>>>15)+a*u+(i>>>30),r.data[n++]=f&1073741823}return i}function Cu(t,e,r,n,i,s){for(var o=e&16383,a=e>>14;--s>=0;){var f=this.data[t]&16383,u=this.data[t++]>>14,c=a*f+u*o;f=o*f+((c&16383)<<14)+r.data[n]+i,i=(f>>28)+(c>>14)+a*u,r.data[n++]=f&268435455}return i}typeof navigator>"u"?(S.prototype.am=Cu,Yt=28):Du&&navigator.appName=="Microsoft Internet Explorer"?(S.prototype.am=Pg,Yt=30):Du&&navigator.appName!="Netscape"?(S.prototype.am=Bg,Yt=26):(S.prototype.am=Cu,Yt=28);S.prototype.DB=Yt;S.prototype.DM=(1<<Yt)-1;S.prototype.DV=1<<Yt;var Mo=52;S.prototype.FV=Math.pow(2,Mo);S.prototype.F1=Mo-Yt;S.prototype.F2=2*Yt-Mo;var Rg="0123456789abcdefghijklmnopqrstuvwxyz",ji=new Array,an,ht;an="0".charCodeAt(0);for(ht=0;ht<=9;++ht)ji[an++]=ht;an="a".charCodeAt(0);for(ht=10;ht<36;++ht)ji[an++]=ht;an="A".charCodeAt(0);for(ht=10;ht<36;++ht)ji[an++]=ht;function Iu(t){return Rg.charAt(t)}function Au(t,e){var r=ji[t.charCodeAt(e)];return r??-1}function Lg(t){for(var e=this.t-1;e>=0;--e)t.data[e]=this.data[e];t.t=this.t,t.s=this.s}function Mg(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function ur(t){var e=J();return e.fromInt(t),e}function kg(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var n=t.length,i=!1,s=0;--n>=0;){var o=r==8?t[n]&255:Au(t,n);if(o<0){t.charAt(n)=="-"&&(i=!0);continue}i=!1,s==0?this.data[this.t++]=o:s+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,s+=r,s>=this.DB&&(s-=this.DB)}r==8&&(t[0]&128)!=0&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&S.ZERO.subTo(this,this)}function Ng(){for(var t=this.s&this.DM;this.t>0&&this.data[this.t-1]==t;)--this.t}function Og(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,n,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(i=!0,s=Iu(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=Iu(n));return i?s:"0"}function Fg(){var t=J();return S.ZERO.subTo(this,t),t}function Ug(){return this.s<0?this.negate():this}function Kg(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this.data[r]-t.data[r])!=0)return e;return 0}function Yi(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function Vg(){return this.t<=0?0:this.DB*(this.t-1)+Yi(this.data[this.t-1]^this.s&this.DM)}function zg(t,e){var r;for(r=this.t-1;r>=0;--r)e.data[r+t]=this.data[r];for(r=t-1;r>=0;--r)e.data[r]=0;e.t=this.t+t,e.s=this.s}function qg(t,e){for(var r=t;r<this.t;++r)e.data[r-t]=this.data[r];e.t=Math.max(this.t-t,0),e.s=this.s}function Gg(t,e){var r=t%this.DB,n=this.DB-r,i=(1<<n)-1,s=Math.floor(t/this.DB),o=this.s<<r&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+s+1]=this.data[a]>>n|o,o=(this.data[a]&i)<<r;for(a=s-1;a>=0;--a)e.data[a]=0;e.data[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function Hg(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var n=t%this.DB,i=this.DB-n,s=(1<<n)-1;e.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)e.data[o-r-1]|=(this.data[o]&s)<<i,e.data[o-r]=this.data[o]>>n;n>0&&(e.data[this.t-r-1]|=(this.s&s)<<i),e.t=this.t-r,e.clamp()}function Wg(t,e){for(var r=0,n=0,i=Math.min(t.t,this.t);r<i;)n+=this.data[r]-t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n-=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e.data[r++]=this.DV+n:n>0&&(e.data[r++]=n),e.t=r,e.clamp()}function $g(t,e){var r=this.abs(),n=t.abs(),i=r.t;for(e.t=i+n.t;--i>=0;)e.data[i]=0;for(i=0;i<n.t;++i)e.data[i+r.t]=r.am(0,n.data[i],e,i,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&S.ZERO.subTo(e,e)}function jg(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t.data[r]=0;for(r=0;r<e.t-1;++r){var n=e.am(r,e.data[r],t,2*r,0,1);(t.data[r+e.t]+=e.am(r+1,2*e.data[r],t,2*r+1,n,e.t-r-1))>=e.DV&&(t.data[r+e.t]-=e.DV,t.data[r+e.t+1]=1)}t.t>0&&(t.data[t.t-1]+=e.am(r,e.data[r],t,2*r,0,1)),t.s=0,t.clamp()}function Yg(t,e,r){var n=t.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t){e?.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=J());var s=J(),o=this.s,a=t.s,f=this.DB-Yi(n.data[n.t-1]);f>0?(n.lShiftTo(f,s),i.lShiftTo(f,r)):(n.copyTo(s),i.copyTo(r));var u=s.t,c=s.data[u-1];if(c!=0){var h=c*(1<<this.F1)+(u>1?s.data[u-2]>>this.F2:0),l=this.FV/h,d=(1<<this.F1)/h,p=1<<this.F2,g=r.t,m=g-u,v=e??J();for(s.dlShiftTo(m,v),r.compareTo(v)>=0&&(r.data[r.t++]=1,r.subTo(v,r)),S.ONE.dlShiftTo(u,v),v.subTo(s,s);s.t<u;)s.data[s.t++]=0;for(;--m>=0;){var E=r.data[--g]==c?this.DM:Math.floor(r.data[g]*l+(r.data[g-1]+p)*d);if((r.data[g]+=s.am(0,E,r,m,0,u))<E)for(s.dlShiftTo(m,v),r.subTo(v,r);r.data[g]<--E;)r.subTo(v,r)}e!=null&&(r.drShiftTo(u,e),o!=a&&S.ZERO.subTo(e,e)),r.t=u,r.clamp(),f>0&&r.rShiftTo(f,r),o<0&&S.ZERO.subTo(r,r)}}}function Zg(t){var e=J();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(S.ZERO)>0&&t.subTo(e,e),e}function Cr(t){this.m=t}function Qg(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function Xg(t){return t}function Jg(t){t.divRemTo(this.m,null,t)}function ey(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function ty(t,e){t.squareTo(e),this.reduce(e)}Cr.prototype.convert=Qg;Cr.prototype.revert=Xg;Cr.prototype.reduce=Jg;Cr.prototype.mulTo=ey;Cr.prototype.sqrTo=ty;function ry(){if(this.t<1)return 0;var t=this.data[0];if((t&1)==0)return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Ir(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function ny(t){var e=J();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(S.ZERO)>0&&this.m.subTo(e,e),e}function iy(t){var e=J();return t.copyTo(e),this.reduce(e),e}function sy(t){for(;t.t<=this.mt2;)t.data[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t.data[e]&32767,n=r*this.mpl+((r*this.mph+(t.data[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t.data[r]+=this.m.am(0,n,t,e,0,this.m.t);t.data[r]>=t.DV;)t.data[r]-=t.DV,t.data[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function oy(t,e){t.squareTo(e),this.reduce(e)}function ay(t,e,r){t.multiplyTo(e,r),this.reduce(r)}Ir.prototype.convert=ny;Ir.prototype.revert=iy;Ir.prototype.reduce=sy;Ir.prototype.mulTo=ay;Ir.prototype.sqrTo=oy;function cy(){return(this.t>0?this.data[0]&1:this.s)==0}function uy(t,e){if(t>4294967295||t<1)return S.ONE;var r=J(),n=J(),i=e.convert(this),s=Yi(t)-1;for(i.copyTo(r);--s>=0;)if(e.sqrTo(r,n),(t&1<<s)>0)e.mulTo(n,i,r);else{var o=r;r=n,n=o}return e.revert(r)}function fy(t,e){var r;return t<256||e.isEven()?r=new Cr(e):r=new Ir(e),this.exp(t,r)}S.prototype.copyTo=Lg;S.prototype.fromInt=Mg;S.prototype.fromString=kg;S.prototype.clamp=Ng;S.prototype.dlShiftTo=zg;S.prototype.drShiftTo=qg;S.prototype.lShiftTo=Gg;S.prototype.rShiftTo=Hg;S.prototype.subTo=Wg;S.prototype.multiplyTo=$g;S.prototype.squareTo=jg;S.prototype.divRemTo=Yg;S.prototype.invDigit=ry;S.prototype.isEven=cy;S.prototype.exp=uy;S.prototype.toString=Og;S.prototype.negate=Fg;S.prototype.abs=Ug;S.prototype.compareTo=Kg;S.prototype.bitLength=Vg;S.prototype.mod=Zg;S.prototype.modPowInt=fy;S.ZERO=ur(0);S.ONE=ur(1);function hy(){var t=J();return this.copyTo(t),t}function ly(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function py(){return this.t==0?this.s:this.data[0]<<24>>24}function dy(){return this.t==0?this.s:this.data[0]<<16>>16}function gy(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function yy(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function my(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),n=ur(r),i=J(),s=J(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(r+s.intValue()).toString(t).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(t)+o}function by(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),n=Math.pow(e,r),i=!1,s=0,o=0,a=0;a<t.length;++a){var f=Au(t,a);if(f<0){t.charAt(a)=="-"&&this.signum()==0&&(i=!0);continue}o=e*o+f,++s>=r&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&S.ZERO.subTo(this,this)}function vy(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(S.ONE.shiftLeft(t-1),ko,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(S.ONE.shiftLeft(t-1),this);else{var n=new Array,i=t&7;n.length=(t>>3)+1,e.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function xy(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,n,i=0;if(t-- >0)for(r<this.DB&&(n=this.data[t]>>r)!=(this.s&this.DM)>>r&&(e[i++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this.data[t]&(1<<r)-1)<<8-r,n|=this.data[--t]>>(r+=this.DB-8)):(n=this.data[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),(n&128)!=0&&(n|=-256),i==0&&(this.s&128)!=(n&128)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e}function wy(t){return this.compareTo(t)==0}function Ey(t){return this.compareTo(t)<0?this:t}function Sy(t){return this.compareTo(t)>0?this:t}function Dy(t,e,r){var n,i,s=Math.min(t.t,this.t);for(n=0;n<s;++n)r.data[n]=e(this.data[n],t.data[n]);if(t.t<this.t){for(i=t.s&this.DM,n=s;n<this.t;++n)r.data[n]=e(this.data[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=s;n<t.t;++n)r.data[n]=e(i,t.data[n]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function Cy(t,e){return t&e}function Iy(t){var e=J();return this.bitwiseTo(t,Cy,e),e}function ko(t,e){return t|e}function Ay(t){var e=J();return this.bitwiseTo(t,ko,e),e}function _u(t,e){return t^e}function _y(t){var e=J();return this.bitwiseTo(t,_u,e),e}function Tu(t,e){return t&~e}function Ty(t){var e=J();return this.bitwiseTo(t,Tu,e),e}function By(){for(var t=J(),e=0;e<this.t;++e)t.data[e]=this.DM&~this.data[e];return t.t=this.t,t.s=~this.s,t}function Py(t){var e=J();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Ry(t){var e=J();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function Ly(t){if(t==0)return-1;var e=0;return(t&65535)==0&&(t>>=16,e+=16),(t&255)==0&&(t>>=8,e+=8),(t&15)==0&&(t>>=4,e+=4),(t&3)==0&&(t>>=2,e+=2),(t&1)==0&&++e,e}function My(){for(var t=0;t<this.t;++t)if(this.data[t]!=0)return t*this.DB+Ly(this.data[t]);return this.s<0?this.t*this.DB:-1}function ky(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function Ny(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=ky(this.data[r]^e);return t}function Oy(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<t%this.DB)!=0}function Fy(t,e){var r=S.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function Uy(t){return this.changeBit(t,ko)}function Ky(t){return this.changeBit(t,Tu)}function Vy(t){return this.changeBit(t,_u)}function zy(t,e){for(var r=0,n=0,i=Math.min(t.t,this.t);r<i;)n+=this.data[r]+t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n+=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e.data[r++]=n:n<-1&&(e.data[r++]=this.DV+n),e.t=r,e.clamp()}function qy(t){var e=J();return this.addTo(t,e),e}function Gy(t){var e=J();return this.subTo(t,e),e}function Hy(t){var e=J();return this.multiplyTo(t,e),e}function Wy(t){var e=J();return this.divRemTo(t,e,null),e}function $y(t){var e=J();return this.divRemTo(t,null,e),e}function jy(t){var e=J(),r=J();return this.divRemTo(t,e,r),new Array(e,r)}function Yy(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Zy(t,e){if(t!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=t;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function Yn(){}function Bu(t){return t}function Qy(t,e,r){t.multiplyTo(e,r)}function Xy(t,e){t.squareTo(e)}Yn.prototype.convert=Bu;Yn.prototype.revert=Bu;Yn.prototype.mulTo=Qy;Yn.prototype.sqrTo=Xy;function Jy(t){return this.exp(t,new Yn)}function em(t,e,r){var n=Math.min(this.t+t.t,e);for(r.s=0,r.t=n;n>0;)r.data[--n]=0;var i;for(i=r.t-this.t;n<i;++n)r.data[n+this.t]=this.am(0,t.data[n],r,n,0,this.t);for(i=Math.min(t.t,e);n<i;++n)this.am(0,t.data[n],r,n,0,e-n);r.clamp()}function tm(t,e,r){--e;var n=r.t=this.t+t.t-e;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)r.data[this.t+n-e]=this.am(e-n,t.data[n],r,0,0,this.t+n-e);r.clamp(),r.drShiftTo(1,r)}function cn(t){this.r2=J(),this.q3=J(),S.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function rm(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=J();return t.copyTo(e),this.reduce(e),e}function nm(t){return t}function im(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function sm(t,e){t.squareTo(e),this.reduce(e)}function om(t,e,r){t.multiplyTo(e,r),this.reduce(r)}cn.prototype.convert=rm;cn.prototype.revert=nm;cn.prototype.reduce=im;cn.prototype.mulTo=om;cn.prototype.sqrTo=sm;function am(t,e){var r=t.bitLength(),n,i=ur(1),s;if(r<=0)return i;r<18?n=1:r<48?n=3:r<144?n=4:r<768?n=5:n=6,r<8?s=new Cr(e):e.isEven()?s=new cn(e):s=new Ir(e);var o=new Array,a=3,f=n-1,u=(1<<n)-1;if(o[1]=s.convert(this),n>1){var c=J();for(s.sqrTo(o[1],c);a<=u;)o[a]=J(),s.mulTo(c,o[a-2],o[a]),a+=2}var h=t.t-1,l,d=!0,p=J(),g;for(r=Yi(t.data[h])-1;h>=0;){for(r>=f?l=t.data[h]>>r-f&u:(l=(t.data[h]&(1<<r+1)-1)<<f-r,h>0&&(l|=t.data[h-1]>>this.DB+r-f)),a=n;(l&1)==0;)l>>=1,--a;if((r-=a)<0&&(r+=this.DB,--h),d)o[l].copyTo(i),d=!1;else{for(;a>1;)s.sqrTo(i,p),s.sqrTo(p,i),a-=2;a>0?s.sqrTo(i,p):(g=i,i=p,p=g),s.mulTo(p,o[l],i)}for(;h>=0&&(t.data[h]&1<<r)==0;)s.sqrTo(i,p),g=i,i=p,p=g,--r<0&&(r=this.DB-1,--h)}return s.revert(i)}function cm(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var n=e;e=r,r=n}var i=e.getLowestSetBit(),s=r.getLowestSetBit();if(s<0)return e;for(i<s&&(s=i),s>0&&(e.rShiftTo(s,e),r.rShiftTo(s,r));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return s>0&&r.lShiftTo(s,r),r}function um(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this.data[0]%t;else for(var n=this.t-1;n>=0;--n)r=(e*r+this.data[n])%t;return r}function fm(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return S.ZERO;for(var r=t.clone(),n=this.clone(),i=ur(1),s=ur(0),o=ur(0),a=ur(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!i.isEven()||!s.isEven())&&(i.addTo(this,i),s.subTo(t,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),e&&i.subTo(o,i),s.subTo(a,s)):(n.subTo(r,n),e&&o.subTo(i,o),a.subTo(s,a))}if(n.compareTo(S.ONE)!=0)return S.ZERO;if(a.compareTo(t)>=0)return a.subtract(t);if(a.signum()<0)a.addTo(t,a);else return a;return a.signum()<0?a.add(t):a}var vt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],hm=(1<<26)/vt[vt.length-1];function lm(t){var e,r=this.abs();if(r.t==1&&r.data[0]<=vt[vt.length-1]){for(e=0;e<vt.length;++e)if(r.data[0]==vt[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<vt.length;){for(var n=vt[e],i=e+1;i<vt.length&&n<hm;)n*=vt[i++];for(n=r.modInt(n);e<i;)if(n%vt[e++]==0)return!1}return r.millerRabin(t)}function pm(t){var e=this.subtract(S.ONE),r=e.getLowestSetBit();if(r<=0)return!1;for(var n=e.shiftRight(r),i=dm(),s,o=0;o<t;++o){do s=new S(this.bitLength(),i);while(s.compareTo(S.ONE)<=0||s.compareTo(e)>=0);var a=s.modPow(n,this);if(a.compareTo(S.ONE)!=0&&a.compareTo(e)!=0){for(var f=1;f++<r&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(S.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function dm(){return{nextBytes:function(t){for(var e=0;e<t.length;++e)t[e]=Math.floor(Math.random()*256)}}}S.prototype.chunkSize=gy;S.prototype.toRadix=my;S.prototype.fromRadix=by;S.prototype.fromNumber=vy;S.prototype.bitwiseTo=Dy;S.prototype.changeBit=Fy;S.prototype.addTo=zy;S.prototype.dMultiply=Yy;S.prototype.dAddOffset=Zy;S.prototype.multiplyLowerTo=em;S.prototype.multiplyUpperTo=tm;S.prototype.modInt=um;S.prototype.millerRabin=pm;S.prototype.clone=hy;S.prototype.intValue=ly;S.prototype.byteValue=py;S.prototype.shortValue=dy;S.prototype.signum=yy;S.prototype.toByteArray=xy;S.prototype.equals=wy;S.prototype.min=Ey;S.prototype.max=Sy;S.prototype.and=Iy;S.prototype.or=Ay;S.prototype.xor=_y;S.prototype.andNot=Ty;S.prototype.not=By;S.prototype.shiftLeft=Py;S.prototype.shiftRight=Ry;S.prototype.getLowestSetBit=My;S.prototype.bitCount=Ny;S.prototype.testBit=Oy;S.prototype.setBit=Uy;S.prototype.clearBit=Ky;S.prototype.flipBit=Vy;S.prototype.add=qy;S.prototype.subtract=Gy;S.prototype.multiply=Hy;S.prototype.divide=Wy;S.prototype.remainder=$y;S.prototype.divideAndRemainder=jy;S.prototype.modPow=am;S.prototype.modInverse=fm;S.prototype.pow=Jy;S.prototype.gcd=cm;S.prototype.isProbablePrime=lm});var Nu=L((HE,ku)=>{var Pt=ae();Dr();Be();var Lu=ku.exports=Pt.sha1=Pt.sha1||{};Pt.md.sha1=Pt.md.algorithms.sha1=Lu;Lu.create=function(){Mu||gm();var t=null,e=Pt.util.createBuffer(),r=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=Pt.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=Pt.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),Ru(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Pt.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(No.substr(0,n.blockLength-o));for(var a,f,u=n.fullMessageLength[0]*8,c=0;c<n.fullMessageLength.length-1;++c)a=n.fullMessageLength[c+1]*8,f=a/4294967296>>>0,u+=f,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var h={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};Ru(h,r,i);var l=Pt.util.createBuffer();return l.putInt32(h.h0),l.putInt32(h.h1),l.putInt32(h.h2),l.putInt32(h.h3),l.putInt32(h.h4),l},n};var No=null,Mu=!1;function gm(){No=String.fromCharCode(128),No+=Pt.util.fillString(String.fromCharCode(0),64),Mu=!0}function Ru(t,e,r){for(var n,i,s,o,a,f,u,c,h=r.length();h>=64;){for(i=t.h0,s=t.h1,o=t.h2,a=t.h3,f=t.h4,c=0;c<16;++c)n=r.getInt32(),e[c]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+f+1518500249+n,f=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<20;++c)n=e[c-3]^e[c-8]^e[c-14]^e[c-16],n=n<<1|n>>>31,e[c]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+f+1518500249+n,f=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<32;++c)n=e[c-3]^e[c-8]^e[c-14]^e[c-16],n=n<<1|n>>>31,e[c]=n,u=s^o^a,n=(i<<5|i>>>27)+u+f+1859775393+n,f=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<40;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=s^o^a,n=(i<<5|i>>>27)+u+f+1859775393+n,f=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<60;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=s&o|a&(s^o),n=(i<<5|i>>>27)+u+f+2400959708+n,f=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<80;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=s^o^a,n=(i<<5|i>>>27)+u+f+3395469782+n,f=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;t.h0=t.h0+i|0,t.h1=t.h1+s|0,t.h2=t.h2+o|0,t.h3=t.h3+a|0,t.h4=t.h4+f|0,h-=64}}});var Uu=L((WE,Fu)=>{var Rt=ae();Be();jn();Nu();var Ou=Fu.exports=Rt.pkcs1=Rt.pkcs1||{};Ou.encode_rsa_oaep=function(t,e,r){var n,i,s,o;typeof r=="string"?(n=r,i=arguments[3]||void 0,s=arguments[4]||void 0):r&&(n=r.label||void 0,i=r.seed||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md)),s?s.start():s=Rt.md.sha1.create(),o||(o=s);var a=Math.ceil(t.n.bitLength()/8),f=a-2*s.digestLength-2;if(e.length>f){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=f,u}n||(n=""),s.update(n,"raw");for(var c=s.digest(),h="",l=f-e.length,d=0;d<l;d++)h+="\0";var p=c.getBytes()+h+""+e;if(!i)i=Rt.random.getBytes(s.digestLength);else if(i.length!==s.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=i.length,u.digestLength=s.digestLength,u}var g=Qi(i,a-s.digestLength-1,o),m=Rt.util.xorBytes(p,g,p.length),v=Qi(m,s.digestLength,o),E=Rt.util.xorBytes(i,v,i.length);return"\0"+E+m};Ou.decode_rsa_oaep=function(t,e,r){var n,i,s;typeof r=="string"?(n=r,i=arguments[3]||void 0):r&&(n=r.label||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(s=r.mgf1.md));var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var m=new Error("RSAES-OAEP encoded message length is invalid.");throw m.length=e.length,m.expectedLength=o,m}if(i===void 0?i=Rt.md.sha1.create():i.start(),s||(s=i),o<2*i.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),i.update(n,"raw");for(var a=i.digest().getBytes(),f=e.charAt(0),u=e.substring(1,i.digestLength+1),c=e.substring(1+i.digestLength),h=Qi(c,i.digestLength,s),l=Rt.util.xorBytes(u,h,u.length),d=Qi(l,o-i.digestLength-1,s),p=Rt.util.xorBytes(c,d,c.length),g=p.substring(0,i.digestLength),m=f!=="\0",v=0;v<i.digestLength;++v)m|=a.charAt(v)!==g.charAt(v);for(var E=1,I=i.digestLength,T=i.digestLength;T<p.length;T++){var x=p.charCodeAt(T),C=x&1^1,P=E?65534:0;m|=x&P,E=E&C,I+=E}if(m||p.charCodeAt(I)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(I+1)};function Qi(t,e,r){r||(r=Rt.md.sha1.create());for(var n="",i=Math.ceil(e/r.digestLength),s=0;s<i;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255);r.start(),r.update(t+o),n+=r.digest().getBytes()}return n.substring(0,e)}});var Ku=L(($E,Oo)=>{var fr=ae();Be();Zi();jn();(function(){if(fr.prime){Oo.exports=fr.prime;return}var t=Oo.exports=fr.prime=fr.prime||{},e=fr.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var i=function(h,l){return h|l};t.generateProbablePrime=function(h,l,d){typeof l=="function"&&(d=l,l={}),l=l||{};var p=l.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var g=l.prng||fr.random,m={nextBytes:function(v){for(var E=g.getBytesSync(v.length),I=0;I<v.length;++I)v[I]=E.charCodeAt(I)}};if(p.name==="PRIMEINC")return s(h,m,p.options,d);throw new Error("Invalid prime generation algorithm: "+p.name)};function s(h,l,d,p){return"workers"in d?f(h,l,d,p):o(h,l,d,p)}function o(h,l,d,p){var g=u(h,l),m=0,v=c(g.bitLength());"millerRabinTests"in d&&(v=d.millerRabinTests);var E=10;"maxBlockTime"in d&&(E=d.maxBlockTime),a(g,h,l,m,v,E,p)}function a(h,l,d,p,g,m,v){var E=+new Date;do{if(h.bitLength()>l&&(h=u(l,d)),h.isProbablePrime(g))return v(null,h);h.dAddOffset(r[p++%8],0)}while(m<0||+new Date-E<m);fr.util.setImmediate(function(){a(h,l,d,p,g,m,v)})}function f(h,l,d,p){if(typeof Worker>"u")return o(h,l,d,p);var g=u(h,l),m=d.workers,v=d.workLoad||100,E=v*30/8,I=d.workerScript||"forge/prime.worker.js";if(m===-1)return fr.util.estimateCores(function(x,C){x&&(C=2),m=C-1,T()});T();function T(){m=Math.max(1,m);for(var x=[],C=0;C<m;++C)x[C]=new Worker(I);for(var P=m,C=0;C<m;++C)x[C].addEventListener("message",q);var N=!1;function q(xe){if(!N){--P;var Oe=xe.data;if(Oe.found){for(var He=0;He<x.length;++He)x[He].terminate();return N=!0,p(null,new e(Oe.prime,16))}g.bitLength()>h&&(g=u(h,l));var Wr=g.toString(16);xe.target.postMessage({hex:Wr,workLoad:v}),g.dAddOffset(E,0)}}}}function u(h,l){var d=new e(h,l),p=h-1;return d.testBit(p)||d.bitwiseTo(e.ONE.shiftLeft(p),i,d),d.dAddOffset(31-d.mod(n).byteValue(),0),d}function c(h){return h<=100?27:h<=150?18:h<=200?15:h<=250?12:h<=300?9:h<=350?8:h<=400?7:h<=500?6:h<=600?5:h<=800?4:h<=1250?3:2}})()});var Ji=L((jE,$u)=>{var k=ae();$n();Zi();Oi();Uu();Ku();jn();Be();typeof Y>"u"&&(Y=k.jsbn.BigInteger);var Y,Fo=k.util.isNodejs?on():null,b=k.asn1,lt=k.util;k.pki=k.pki||{};$u.exports=k.pki.rsa=k.rsa=k.rsa||{};var K=k.pki,ym=[6,4,2,4,2,4,6,2],mm={name:"PrivateKeyInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},bm={name:"RSAPrivateKey",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},vm={name:"RSAPublicKey",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},xm=k.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:b.Class.UNIVERSAL,type:b.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},wm={name:"DigestInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:b.Class.UNIVERSAL,type:b.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},Em=function(t){var e;if(t.algorithm in K.oids)e=K.oids[t.algorithm];else{var r=new Error("Unknown message digest algorithm.");throw r.algorithm=t.algorithm,r}var n=b.oidToDer(e).getBytes(),i=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[]),s=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[]);s.value.push(b.create(b.Class.UNIVERSAL,b.Type.OID,!1,n)),s.value.push(b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,""));var o=b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,t.digest().getBytes());return i.value.push(s),i.value.push(o),b.toDer(i).getBytes()},Hu=function(t,e,r){if(r)return t.modPow(e.e,e.n);if(!e.p||!e.q)return t.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Y.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Y.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new Y(k.util.bytesToHex(k.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(Y.ONE));t=t.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var i=t.mod(e.p).modPow(e.dP,e.p),s=t.mod(e.q).modPow(e.dQ,e.q);i.compareTo(s)<0;)i=i.add(e.p);var o=i.subtract(s).multiply(e.qInv).mod(e.p).multiply(e.q).add(s);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};K.rsa.encrypt=function(t,e,r){var n=r,i,s=Math.ceil(e.n.bitLength()/8);r!==!1&&r!==!0?(n=r===2,i=Wu(t,e,r)):(i=k.util.createBuffer(),i.putBytes(t));for(var o=new Y(i.toHex(),16),a=Hu(o,e,n),f=a.toString(16),u=k.util.createBuffer(),c=s-Math.ceil(f.length/2);c>0;)u.putByte(0),--c;return u.putBytes(k.util.hexToBytes(f)),u.getBytes()};K.rsa.decrypt=function(t,e,r,n){var i=Math.ceil(e.n.bitLength()/8);if(t.length!==i){var s=new Error("Encrypted message length is invalid.");throw s.length=t.length,s.expected=i,s}var o=new Y(k.util.createBuffer(t).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=Hu(o,e,r),f=a.toString(16),u=k.util.createBuffer(),c=i-Math.ceil(f.length/2);c>0;)u.putByte(0),--c;return u.putBytes(k.util.hexToBytes(f)),n!==!1?Xi(u.getBytes(),e,r):u.getBytes()};K.rsa.createKeyPairGenerationState=function(t,e,r){typeof t=="string"&&(t=parseInt(t,10)),t=t||2048,r=r||{};var n=r.prng||k.random,i={nextBytes:function(a){for(var f=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=f.charCodeAt(u)}},s=r.algorithm||"PRIMEINC",o;if(s==="PRIMEINC")o={algorithm:s,state:0,bits:t,rng:i,eInt:e||65537,e:new Y(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+s);return o};K.rsa.stepKeyPairGenerationState=function(t,e){"algorithm"in t||(t.algorithm="PRIMEINC");var r=new Y(null);r.fromInt(30);for(var n=0,i=function(h,l){return h|l},s=+new Date,o,a=0;t.keys===null&&(e<=0||a<e);){if(t.state===0){var f=t.p===null?t.pBits:t.qBits,u=f-1;t.pqState===0?(t.num=new Y(f,t.rng),t.num.testBit(u)||t.num.bitwiseTo(Y.ONE.shiftLeft(u),i,t.num),t.num.dAddOffset(31-t.num.mod(r).byteValue(),0),n=0,++t.pqState):t.pqState===1?t.num.bitLength()>f?t.pqState=0:t.num.isProbablePrime(Dm(t.num.bitLength()))?++t.pqState:t.num.dAddOffset(ym[n++%8],0):t.pqState===2?t.pqState=t.num.subtract(Y.ONE).gcd(t.e).compareTo(Y.ONE)===0?3:0:t.pqState===3&&(t.pqState=0,t.p===null?t.p=t.num:t.q=t.num,t.p!==null&&t.q!==null&&++t.state,t.num=null)}else if(t.state===1)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(t.state===2)t.p1=t.p.subtract(Y.ONE),t.q1=t.q.subtract(Y.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(t.state===3)t.phi.gcd(t.e).compareTo(Y.ONE)===0?++t.state:(t.p=null,t.q=null,t.state=0);else if(t.state===4)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(t.state===5){var c=t.e.modInverse(t.phi);t.keys={privateKey:K.rsa.setPrivateKey(t.n,t.e,c,t.p,t.q,c.mod(t.p1),c.mod(t.q1),t.q.modInverse(t.p)),publicKey:K.rsa.setPublicKey(t.n,t.e)}}o=+new Date,a+=o-s,s=o}return t.keys!==null};K.rsa.generateKeyPair=function(t,e,r,n){if(arguments.length===1?typeof t=="object"?(r=t,t=void 0):typeof t=="function"&&(n=t,t=void 0):arguments.length===2?typeof t=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(r=e,e=void 0):(r=t,n=e,t=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof r=="function"&&(n=r,r=void 0):(n=r,r=e,e=void 0)),r=r||{},t===void 0&&(t=r.bits||2048),e===void 0&&(e=r.e||65537),!k.options.usePureJavaScript&&!r.prng&&t>=256&&t<=16384&&(e===65537||e===3)){if(n){if(Vu("generateKeyPair"))return Fo.generateKeyPair("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,f,u){if(a)return n(a);n(null,{privateKey:K.privateKeyFromPem(u),publicKey:K.publicKeyFromPem(f)})});if(zu("generateKey")&&zu("exportKey"))return lt.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:Gu(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return lt.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var f=K.privateKeyFromAsn1(b.fromDer(k.util.createBuffer(a)));n(null,{privateKey:f,publicKey:K.setRsaPublicKey(f.n,f.e)})}});if(qu("generateKey")&&qu("exportKey")){var i=lt.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:Gu(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);i.oncomplete=function(a){var f=a.target.result,u=lt.globalScope.msCrypto.subtle.exportKey("pkcs8",f.privateKey);u.oncomplete=function(c){var h=c.target.result,l=K.privateKeyFromAsn1(b.fromDer(k.util.createBuffer(h)));n(null,{privateKey:l,publicKey:K.setRsaPublicKey(l.n,l.e)})},u.onerror=function(c){n(c)}},i.onerror=function(a){n(a)};return}}else if(Vu("generateKeyPairSync")){var s=Fo.generateKeyPairSync("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:K.privateKeyFromPem(s.privateKey),publicKey:K.publicKeyFromPem(s.publicKey)}}}var o=K.rsa.createKeyPairGenerationState(t,e,r);if(!n)return K.rsa.stepKeyPairGenerationState(o,0),o.keys;Sm(o,r,n)};K.setRsaPublicKey=K.rsa.setPublicKey=function(t,e){var r={n:t,e};return r.encrypt=function(n,i,s){if(typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSAES-PKCS1-V1_5"),i==="RSAES-PKCS1-V1_5")i={encode:function(a,f,u){return Wu(a,f,2).getBytes()}};else if(i==="RSA-OAEP"||i==="RSAES-OAEP")i={encode:function(a,f){return k.pkcs1.encode_rsa_oaep(f,a,s)}};else if(["RAW","NONE","NULL",null].indexOf(i)!==-1)i={encode:function(a){return a}};else if(typeof i=="string")throw new Error('Unsupported encryption scheme: "'+i+'".');var o=i.encode(n,r,!0);return K.rsa.encrypt(o,r,!0)},r.verify=function(n,i,s,o){typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),s==="RSASSA-PKCS1-V1_5"?s={verify:function(f,u){u=Xi(u,r,!0);var c=b.fromDer(u,{parseAllBytes:o._parseAllDigestBytes}),h={},l=[];if(!b.validate(c,wm,h,l)){var d=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw d.errors=l,d}var p=b.derToOid(h.algorithmIdentifier);if(!(p===k.oids.md2||p===k.oids.md5||p===k.oids.sha1||p===k.oids.sha224||p===k.oids.sha256||p===k.oids.sha384||p===k.oids.sha512||p===k.oids["sha512-224"]||p===k.oids["sha512-256"])){var d=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw d.oid=p,d}if((p===k.oids.md2||p===k.oids.md5)&&!("parameters"in h))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return f===h.digest}}:(s==="NONE"||s==="NULL"||s===null)&&(s={verify:function(f,u){return u=Xi(u,r,!0),f===u}});var a=K.rsa.decrypt(i,r,!0,!1);return s.verify(n,a,r.n.bitLength())},r};K.setRsaPrivateKey=K.rsa.setPrivateKey=function(t,e,r,n,i,s,o,a){var f={n:t,e,d:r,p:n,q:i,dP:s,dQ:o,qInv:a};return f.decrypt=function(u,c,h){typeof c=="string"?c=c.toUpperCase():c===void 0&&(c="RSAES-PKCS1-V1_5");var l=K.rsa.decrypt(u,f,!1,!1);if(c==="RSAES-PKCS1-V1_5")c={decode:Xi};else if(c==="RSA-OAEP"||c==="RSAES-OAEP")c={decode:function(d,p){return k.pkcs1.decode_rsa_oaep(p,d,h)}};else if(["RAW","NONE","NULL",null].indexOf(c)!==-1)c={decode:function(d){return d}};else throw new Error('Unsupported encryption scheme: "'+c+'".');return c.decode(l,f,!1)},f.sign=function(u,c){var h=!1;typeof c=="string"&&(c=c.toUpperCase()),c===void 0||c==="RSASSA-PKCS1-V1_5"?(c={encode:Em},h=1):(c==="NONE"||c==="NULL"||c===null)&&(c={encode:function(){return u}},h=1);var l=c.encode(u,f.n.bitLength());return K.rsa.encrypt(l,f,h)},f};K.wrapRsaPrivateKey=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,b.integerToDer(0).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(K.oids.rsaEncryption).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,"")]),b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,b.toDer(t).getBytes())])};K.privateKeyFromAsn1=function(t){var e={},r=[];if(b.validate(t,mm,e,r)&&(t=b.fromDer(k.util.createBuffer(e.privateKey))),e={},r=[],!b.validate(t,bm,e,r)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=r,n}var i,s,o,a,f,u,c,h;return i=k.util.createBuffer(e.privateKeyModulus).toHex(),s=k.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=k.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=k.util.createBuffer(e.privateKeyPrime1).toHex(),f=k.util.createBuffer(e.privateKeyPrime2).toHex(),u=k.util.createBuffer(e.privateKeyExponent1).toHex(),c=k.util.createBuffer(e.privateKeyExponent2).toHex(),h=k.util.createBuffer(e.privateKeyCoefficient).toHex(),K.setRsaPrivateKey(new Y(i,16),new Y(s,16),new Y(o,16),new Y(a,16),new Y(f,16),new Y(u,16),new Y(c,16),new Y(h,16))};K.privateKeyToAsn1=K.privateKeyToRSAPrivateKey=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,b.integerToDer(0).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.n)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.e)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.d)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.p)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.q)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.dP)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.dQ)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.qInv))])};K.publicKeyFromAsn1=function(t){var e={},r=[];if(b.validate(t,xm,e,r)){var n=b.derToOid(e.publicKeyOid);if(n!==K.oids.rsaEncryption){var i=new Error("Cannot read public key. Unknown OID.");throw i.oid=n,i}t=e.rsaPublicKey}if(r=[],!b.validate(t,vm,e,r)){var i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw i.errors=r,i}var s=k.util.createBuffer(e.publicKeyModulus).toHex(),o=k.util.createBuffer(e.publicKeyExponent).toHex();return K.setRsaPublicKey(new Y(s,16),new Y(o,16))};K.publicKeyToAsn1=K.publicKeyToSubjectPublicKeyInfo=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(K.oids.rsaEncryption).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,"")]),b.create(b.Class.UNIVERSAL,b.Type.BITSTRING,!1,[K.publicKeyToRSAPublicKey(t)])])};K.publicKeyToRSAPublicKey=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.n)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,Lt(t.e))])};function Wu(t,e,r){var n=k.util.createBuffer(),i=Math.ceil(e.n.bitLength()/8);if(t.length>i-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=t.length,s.max=i-11,s}n.putByte(0),n.putByte(r);var o=i-3-t.length,a;if(r===0||r===1){a=r===0?0:255;for(var f=0;f<o;++f)n.putByte(a)}else for(;o>0;){for(var u=0,c=k.random.getBytes(o),f=0;f<o;++f)a=c.charCodeAt(f),a===0?++u:n.putByte(a);o=u}return n.putByte(0),n.putBytes(t),n}function Xi(t,e,r,n){var i=Math.ceil(e.n.bitLength()/8),s=k.util.createBuffer(t),o=s.getByte(),a=s.getByte();if(o!==0||r&&a!==0&&a!==1||!r&&a!=2||r&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var f=0;if(a===0){f=i-3-n;for(var u=0;u<f;++u)if(s.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(f=0;s.length()>1;){if(s.getByte()!==255){--s.read;break}++f}else if(a===2)for(f=0;s.length()>1;){if(s.getByte()===0){--s.read;break}++f}var c=s.getByte();if(c!==0||f!==i-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function Sm(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),i();function i(){s(t.pBits,function(a,f){if(a)return r(a);if(t.p=f,t.q!==null)return o(a,t.q);s(t.qBits,o)})}function s(a,f){k.prime.generateProbablePrime(a,n,f)}function o(a,f){if(a)return r(a);if(t.q=f,t.p.compareTo(t.q)<0){var u=t.p;t.p=t.q,t.q=u}if(t.p.subtract(Y.ONE).gcd(t.e).compareTo(Y.ONE)!==0){t.p=null,i();return}if(t.q.subtract(Y.ONE).gcd(t.e).compareTo(Y.ONE)!==0){t.q=null,s(t.qBits,o);return}if(t.p1=t.p.subtract(Y.ONE),t.q1=t.q.subtract(Y.ONE),t.phi=t.p1.multiply(t.q1),t.phi.gcd(t.e).compareTo(Y.ONE)!==0){t.p=t.q=null,i();return}if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits){t.q=null,s(t.qBits,o);return}var c=t.e.modInverse(t.phi);t.keys={privateKey:K.rsa.setPrivateKey(t.n,t.e,c,t.p,t.q,c.mod(t.p1),c.mod(t.q1),t.q.modInverse(t.p)),publicKey:K.rsa.setPublicKey(t.n,t.e)},r(null,t.keys)}}function Lt(t){var e=t.toString(16);e[0]>="8"&&(e="00"+e);var r=k.util.hexToBytes(e);return r.length>1&&(r.charCodeAt(0)===0&&(r.charCodeAt(1)&128)===0||r.charCodeAt(0)===255&&(r.charCodeAt(1)&128)===128)?r.substr(1):r}function Dm(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}function Vu(t){return k.util.isNodejs&&typeof Fo[t]=="function"}function zu(t){return typeof lt.globalScope<"u"&&typeof lt.globalScope.crypto=="object"&&typeof lt.globalScope.crypto.subtle=="object"&&typeof lt.globalScope.crypto.subtle[t]=="function"}function qu(t){return typeof lt.globalScope<"u"&&typeof lt.globalScope.msCrypto=="object"&&typeof lt.globalScope.msCrypto.subtle=="object"&&typeof lt.globalScope.msCrypto.subtle[t]=="function"}function Gu(t){for(var e=k.util.hexToBytes(t.toString(16)),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}});var Ju=L((YE,Xu)=>{var B=ae();zi();$n();iu();Dr();Oi();To();hu();jn();Su();Ji();Be();typeof ju>"u"&&(ju=B.jsbn.BigInteger);var ju,w=B.asn1,G=B.pki=B.pki||{};Xu.exports=G.pbe=B.pbe=B.pbe||{};var Ar=G.oids,Cm={name:"EncryptedPrivateKeyInfo",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},Im={name:"PBES2Algorithms",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},Am={name:"pkcs-12PbeParams",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"iterations"}]};G.encryptPrivateKeyInfo=function(t,e,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n=B.random.getBytesSync(r.saltSize),i=r.count,s=w.integerToDer(i),o,a,f;if(r.algorithm.indexOf("aes")===0||r.algorithm==="des"){var u,c,h;switch(r.algorithm){case"aes128":o=16,u=16,c=Ar["aes128-CBC"],h=B.aes.createEncryptionCipher;break;case"aes192":o=24,u=16,c=Ar["aes192-CBC"],h=B.aes.createEncryptionCipher;break;case"aes256":o=32,u=16,c=Ar["aes256-CBC"],h=B.aes.createEncryptionCipher;break;case"des":o=8,u=8,c=Ar.desCBC,h=B.des.createEncryptionCipher;break;default:var l=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw l.algorithm=r.algorithm,l}var d="hmacWith"+r.prfAlgorithm.toUpperCase(),p=Qu(d),g=B.pkcs5.pbkdf2(e,n,i,o,p),m=B.random.getBytesSync(u),v=h(g);v.start(m),v.update(w.toDer(t)),v.finish(),f=v.output.getBytes();var E=_m(n,s,o,d);a=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Ar.pkcs5PBES2).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Ar.pkcs5PBKDF2).getBytes()),E]),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(c).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,m)])])])}else if(r.algorithm==="3des"){o=24;var I=new B.util.ByteBuffer(n),g=G.pbe.generatePkcs12Key(e,I,1,i,o),m=G.pbe.generatePkcs12Key(e,I,2,i,o),v=B.des.createEncryptionCipher(g);v.start(m),v.update(w.toDer(t)),v.finish(),f=v.output.getBytes(),a=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Ar["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,n),w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,s.getBytes())])])}else{var l=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw l.algorithm=r.algorithm,l}var T=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[a,w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,f)]);return T};G.decryptPrivateKeyInfo=function(t,e){var r=null,n={},i=[];if(!w.validate(t,Cm,n,i)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=w.derToOid(n.encryptionOid),a=G.pbe.getCipher(o,n.encryptionParams,e),f=B.util.createBuffer(n.encryptedData);return a.update(f),a.finish()&&(r=w.fromDer(a.output)),r};G.encryptedPrivateKeyToPem=function(t,e){var r={type:"ENCRYPTED PRIVATE KEY",body:w.toDer(t).getBytes()};return B.pem.encode(r,{maxline:e})};G.encryptedPrivateKeyFromPem=function(t){var e=B.pem.decode(t)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return w.fromDer(e.body)};G.encryptRsaPrivateKey=function(t,e,r){if(r=r||{},!r.legacy){var n=G.wrapRsaPrivateKey(G.privateKeyToAsn1(t));return n=G.encryptPrivateKeyInfo(n,e,r),G.encryptedPrivateKeyToPem(n)}var i,s,o,a;switch(r.algorithm){case"aes128":i="AES-128-CBC",o=16,s=B.random.getBytesSync(16),a=B.aes.createEncryptionCipher;break;case"aes192":i="AES-192-CBC",o=24,s=B.random.getBytesSync(16),a=B.aes.createEncryptionCipher;break;case"aes256":i="AES-256-CBC",o=32,s=B.random.getBytesSync(16),a=B.aes.createEncryptionCipher;break;case"3des":i="DES-EDE3-CBC",o=24,s=B.random.getBytesSync(8),a=B.des.createEncryptionCipher;break;case"des":i="DES-CBC",o=8,s=B.random.getBytesSync(8),a=B.des.createEncryptionCipher;break;default:var f=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw f.algorithm=r.algorithm,f}var u=B.pbe.opensslDeriveBytes(e,s.substr(0,8),o),c=a(u);c.start(s),c.update(w.toDer(G.privateKeyToAsn1(t))),c.finish();var h={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:i,parameters:B.util.bytesToHex(s).toUpperCase()},body:c.output.getBytes()};return B.pem.encode(h)};G.decryptRsaPrivateKey=function(t,e){var r=null,n=B.pem.decode(t)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw i.headerType=i,i}if(n.procType&&n.procType.type==="ENCRYPTED"){var s,o;switch(n.dekInfo.algorithm){case"DES-CBC":s=8,o=B.des.createDecryptionCipher;break;case"DES-EDE3-CBC":s=24,o=B.des.createDecryptionCipher;break;case"AES-128-CBC":s=16,o=B.aes.createDecryptionCipher;break;case"AES-192-CBC":s=24,o=B.aes.createDecryptionCipher;break;case"AES-256-CBC":s=32,o=B.aes.createDecryptionCipher;break;case"RC2-40-CBC":s=5,o=function(h){return B.rc2.createDecryptionCipher(h,40)};break;case"RC2-64-CBC":s=8,o=function(h){return B.rc2.createDecryptionCipher(h,64)};break;case"RC2-128-CBC":s=16,o=function(h){return B.rc2.createDecryptionCipher(h,128)};break;default:var i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw i.algorithm=n.dekInfo.algorithm,i}var a=B.util.hexToBytes(n.dekInfo.parameters),f=B.pbe.opensslDeriveBytes(e,a.substr(0,8),s),u=o(f);if(u.start(a),u.update(B.util.createBuffer(n.body)),u.finish())r=u.output.getBytes();else return r}else r=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?r=G.decryptPrivateKeyInfo(w.fromDer(r),e):r=w.fromDer(r),r!==null&&(r=G.privateKeyFromAsn1(r)),r};G.pbe.generatePkcs12Key=function(t,e,r,n,i,s){var o,a;if(typeof s>"u"||s===null){if(!("sha1"in B.md))throw new Error('"sha1" hash algorithm unavailable.');s=B.md.sha1.create()}var f=s.digestLength,u=s.blockLength,c=new B.util.ByteBuffer,h=new B.util.ByteBuffer;if(t!=null){for(a=0;a<t.length;a++)h.putInt16(t.charCodeAt(a));h.putInt16(0)}var l=h.length(),d=e.length(),p=new B.util.ByteBuffer;p.fillWithByte(r,u);var g=u*Math.ceil(d/u),m=new B.util.ByteBuffer;for(a=0;a<g;a++)m.putByte(e.at(a%d));var v=u*Math.ceil(l/u),E=new B.util.ByteBuffer;for(a=0;a<v;a++)E.putByte(h.at(a%l));var I=m;I.putBuffer(E);for(var T=Math.ceil(i/f),x=1;x<=T;x++){var C=new B.util.ByteBuffer;C.putBytes(p.bytes()),C.putBytes(I.bytes());for(var P=0;P<n;P++)s.start(),s.update(C.getBytes()),C=s.digest();var N=new B.util.ByteBuffer;for(a=0;a<u;a++)N.putByte(C.at(a%f));var q=Math.ceil(d/u)+Math.ceil(l/u),xe=new B.util.ByteBuffer;for(o=0;o<q;o++){var Oe=new B.util.ByteBuffer(I.getBytes(u)),He=511;for(a=N.length()-1;a>=0;a--)He=He>>8,He+=N.at(a)+Oe.at(a),Oe.setAt(a,He&255);xe.putBuffer(Oe)}I=xe,c.putBuffer(C)}return c.truncate(c.length()-i),c};G.pbe.getCipher=function(t,e,r){switch(t){case G.oids.pkcs5PBES2:return G.pbe.getCipherForPBES2(t,e,r);case G.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case G.oids["pbewithSHAAnd40BitRC2-CBC"]:return G.pbe.getCipherForPKCS12PBE(t,e,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=t,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};G.pbe.getCipherForPBES2=function(t,e,r){var n={},i=[];if(!w.validate(e,Im,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}if(t=w.derToOid(n.kdfOid),t!==G.oids.pkcs5PBKDF2){var s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw s.oid=t,s.supportedOids=["pkcs5PBKDF2"],s}if(t=w.derToOid(n.encOid),t!==G.oids["aes128-CBC"]&&t!==G.oids["aes192-CBC"]&&t!==G.oids["aes256-CBC"]&&t!==G.oids["des-EDE3-CBC"]&&t!==G.oids.desCBC){var s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw s.oid=t,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s}var o=n.kdfSalt,a=B.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var f,u;switch(G.oids[t]){case"aes128-CBC":f=16,u=B.aes.createDecryptionCipher;break;case"aes192-CBC":f=24,u=B.aes.createDecryptionCipher;break;case"aes256-CBC":f=32,u=B.aes.createDecryptionCipher;break;case"des-EDE3-CBC":f=24,u=B.des.createDecryptionCipher;break;case"desCBC":f=8,u=B.des.createDecryptionCipher;break}var c=Zu(n.prfOid),h=B.pkcs5.pbkdf2(r,o,a,f,c),l=n.encIv,d=u(h);return d.start(l),d};G.pbe.getCipherForPKCS12PBE=function(t,e,r){var n={},i=[];if(!w.validate(e,Am,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=B.util.createBuffer(n.salt),a=B.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var f,u,c;switch(t){case G.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:f=24,u=8,c=B.des.startDecrypting;break;case G.oids["pbewithSHAAnd40BitRC2-CBC"]:f=5,u=8,c=function(g,m){var v=B.rc2.createDecryptionCipher(g,40);return v.start(m,null),v};break;default:var s=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw s.oid=t,s}var h=Zu(n.prfOid),l=G.pbe.generatePkcs12Key(r,o,1,a,f,h);h.start();var d=G.pbe.generatePkcs12Key(r,o,2,a,u,h);return c(l,d)};G.pbe.opensslDeriveBytes=function(t,e,r,n){if(typeof n>"u"||n===null){if(!("md5"in B.md))throw new Error('"md5" hash algorithm unavailable.');n=B.md.md5.create()}e===null&&(e="");for(var i=[Yu(n,t+e)],s=16,o=1;s<r;++o,s+=16)i.push(Yu(n,i[o-1]+t+e));return i.join("").substr(0,r)};function Yu(t,e){return t.start().update(e).digest().getBytes()}function Zu(t){var e;if(!t)e="hmacWithSHA1";else if(e=G.oids[w.derToOid(t)],!e){var r=new Error("Unsupported PRF OID.");throw r.oid=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}return Qu(e)}function Qu(t){var e=B.md;switch(t){case"hmacWithSHA224":e=B.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":t=t.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!e||!(t in e))throw new Error("Unknown hash algorithm: "+t);return e[t].create()}function _m(t,e,r,n){var i=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,t),w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&i.value.push(w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,B.util.hexToBytes(r.toString(16))),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(G.oids[n]).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")])),i}});var uf=L((IS,cf)=>{var me=ae();Dr();Be();var Zn=cf.exports=me.sha512=me.sha512||{};me.md.sha512=me.md.algorithms.sha512=Zn;var of=me.sha384=me.sha512.sha384=me.sha512.sha384||{};of.create=function(){return Zn.create("SHA-384")};me.md.sha384=me.md.algorithms.sha384=of;me.sha512.sha256=me.sha512.sha256||{create:function(){return Zn.create("SHA-512/256")}};me.md["sha512/256"]=me.md.algorithms["sha512/256"]=me.sha512.sha256;me.sha512.sha224=me.sha512.sha224||{create:function(){return Zn.create("SHA-512/224")}};me.md["sha512/224"]=me.md.algorithms["sha512/224"]=me.sha512.sha224;Zn.create=function(t){if(af||Lm(),typeof t>"u"&&(t="SHA-512"),!(t in _r))throw new Error("Invalid SHA-512 algorithm: "+t);for(var e=_r[t],r=null,n=me.util.createBuffer(),i=new Array(80),s=0;s<80;++s)i[s]=new Array(2);var o=64;switch(t){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var f=a.messageLengthSize/4,u=0;u<f;++u)a.fullMessageLength.push(0);n=me.util.createBuffer(),r=new Array(e.length);for(var u=0;u<e.length;++u)r[u]=e[u].slice(0);return a},a.start(),a.update=function(f,u){u==="utf8"&&(f=me.util.encodeUtf8(f));var c=f.length;a.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var h=a.fullMessageLength.length-1;h>=0;--h)a.fullMessageLength[h]+=c[1],c[1]=c[0]+(a.fullMessageLength[h]/4294967296>>>0),a.fullMessageLength[h]=a.fullMessageLength[h]>>>0,c[0]=c[1]/4294967296>>>0;return n.putBytes(f),sf(r,i,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var f=me.util.createBuffer();f.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,c=u&a.blockLength-1;f.putBytes(Ko.substr(0,a.blockLength-c));for(var h,l,d=a.fullMessageLength[0]*8,p=0;p<a.fullMessageLength.length-1;++p)h=a.fullMessageLength[p+1]*8,l=h/4294967296>>>0,d+=l,f.putInt32(d>>>0),d=h>>>0;f.putInt32(d);for(var g=new Array(r.length),p=0;p<r.length;++p)g[p]=r[p].slice(0);sf(g,i,f);var m=me.util.createBuffer(),v;t==="SHA-512"?v=g.length:t==="SHA-384"?v=g.length-2:v=g.length-4;for(var p=0;p<v;++p)m.putInt32(g[p][0]),(p!==v-1||t!=="SHA-512/224")&&m.putInt32(g[p][1]);return m},a};var Ko=null,af=!1,Vo=null,_r=null;function Lm(){Ko=String.fromCharCode(128),Ko+=me.util.fillString(String.fromCharCode(0),128),Vo=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],_r={},_r["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],_r["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],_r["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],_r["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],af=!0}function sf(t,e,r){for(var n,i,s,o,a,f,u,c,h,l,d,p,g,m,v,E,I,T,x,C,P,N,q,xe,Oe,He,Wr,Si,Le,Je,O,Vs,zs,qs,Gs,Wa=r.length();Wa>=128;){for(Le=0;Le<16;++Le)e[Le][0]=r.getInt32()>>>0,e[Le][1]=r.getInt32()>>>0;for(;Le<80;++Le)Vs=e[Le-2],Je=Vs[0],O=Vs[1],n=((Je>>>19|O<<13)^(O>>>29|Je<<3)^Je>>>6)>>>0,i=((Je<<13|O>>>19)^(O<<3|Je>>>29)^(Je<<26|O>>>6))>>>0,qs=e[Le-15],Je=qs[0],O=qs[1],s=((Je>>>1|O<<31)^(Je>>>8|O<<24)^Je>>>7)>>>0,o=((Je<<31|O>>>1)^(Je<<24|O>>>8)^(Je<<25|O>>>7))>>>0,zs=e[Le-7],Gs=e[Le-16],O=i+zs[1]+o+Gs[1],e[Le][0]=n+zs[0]+s+Gs[0]+(O/4294967296>>>0)>>>0,e[Le][1]=O>>>0;for(g=t[0][0],m=t[0][1],v=t[1][0],E=t[1][1],I=t[2][0],T=t[2][1],x=t[3][0],C=t[3][1],P=t[4][0],N=t[4][1],q=t[5][0],xe=t[5][1],Oe=t[6][0],He=t[6][1],Wr=t[7][0],Si=t[7][1],Le=0;Le<80;++Le)u=((P>>>14|N<<18)^(P>>>18|N<<14)^(N>>>9|P<<23))>>>0,c=((P<<18|N>>>14)^(P<<14|N>>>18)^(N<<23|P>>>9))>>>0,h=(Oe^P&(q^Oe))>>>0,l=(He^N&(xe^He))>>>0,a=((g>>>28|m<<4)^(m>>>2|g<<30)^(m>>>7|g<<25))>>>0,f=((g<<4|m>>>28)^(m<<30|g>>>2)^(m<<25|g>>>7))>>>0,d=(g&v|I&(g^v))>>>0,p=(m&E|T&(m^E))>>>0,O=Si+c+l+Vo[Le][1]+e[Le][1],n=Wr+u+h+Vo[Le][0]+e[Le][0]+(O/4294967296>>>0)>>>0,i=O>>>0,O=f+p,s=a+d+(O/4294967296>>>0)>>>0,o=O>>>0,Wr=Oe,Si=He,Oe=q,He=xe,q=P,xe=N,O=C+i,P=x+n+(O/4294967296>>>0)>>>0,N=O>>>0,x=I,C=T,I=v,T=E,v=g,E=m,O=i+o,g=n+s+(O/4294967296>>>0)>>>0,m=O>>>0;O=t[0][1]+m,t[0][0]=t[0][0]+g+(O/4294967296>>>0)>>>0,t[0][1]=O>>>0,O=t[1][1]+E,t[1][0]=t[1][0]+v+(O/4294967296>>>0)>>>0,t[1][1]=O>>>0,O=t[2][1]+T,t[2][0]=t[2][0]+I+(O/4294967296>>>0)>>>0,t[2][1]=O>>>0,O=t[3][1]+C,t[3][0]=t[3][0]+x+(O/4294967296>>>0)>>>0,t[3][1]=O>>>0,O=t[4][1]+N,t[4][0]=t[4][0]+P+(O/4294967296>>>0)>>>0,t[4][1]=O>>>0,O=t[5][1]+xe,t[5][0]=t[5][0]+q+(O/4294967296>>>0)>>>0,t[5][1]=O>>>0,O=t[6][1]+He,t[6][0]=t[6][0]+Oe+(O/4294967296>>>0)>>>0,t[6][1]=O>>>0,O=t[7][1]+Si,t[7][0]=t[7][0]+Wr+(O/4294967296>>>0)>>>0,t[7][1]=O>>>0,Wa-=128}}});var ah=L((g3,oh)=>{oh.exports=fa;var sh=128,D1=127,C1=~D1,I1=Math.pow(2,31);function fa(t,e,r){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw fa.bytes=0,new RangeError("Could not encode varint");e=e||[],r=r||0;for(var n=r;t>=I1;)e[r++]=t&255|sh,t/=128;for(;t&C1;)e[r++]=t&255|sh,t>>>=7;return e[r]=t|0,fa.bytes=r-n+1,e}});var fh=L((y3,uh)=>{uh.exports=ha;var A1=128,ch=127;function ha(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a||i>49)throw ha.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&ch)<<i:(o&ch)*Math.pow(2,i),i+=7}while(o>=A1);return ha.bytes=s-n,r}});var lh=L((m3,hh)=>{var _1=Math.pow(2,7),T1=Math.pow(2,14),B1=Math.pow(2,21),P1=Math.pow(2,28),R1=Math.pow(2,35),L1=Math.pow(2,42),M1=Math.pow(2,49),k1=Math.pow(2,56),N1=Math.pow(2,63);hh.exports=function(t){return t<_1?1:t<T1?2:t<B1?3:t<P1?4:t<R1?5:t<L1?6:t<M1?7:t<k1?8:t<N1?9:10}});var fi=L((b3,ph)=>{ph.exports={encode:ah(),decode:fh(),encodingLength:lh()}});var i0=L((x4,n0)=>{var Cn=1e3,In=Cn*60,An=In*60,Or=An*24,db=Or*7,gb=Or*365.25;n0.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return yb(t);if(r==="number"&&isFinite(t))return e.long?bb(t):mb(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function yb(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*gb;case"weeks":case"week":case"w":return r*db;case"days":case"day":case"d":return r*Or;case"hours":case"hour":case"hrs":case"hr":case"h":return r*An;case"minutes":case"minute":case"mins":case"min":case"m":return r*In;case"seconds":case"second":case"secs":case"sec":case"s":return r*Cn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function mb(t){var e=Math.abs(t);return e>=Or?Math.round(t/Or)+"d":e>=An?Math.round(t/An)+"h":e>=In?Math.round(t/In)+"m":e>=Cn?Math.round(t/Cn)+"s":t+"ms"}function bb(t){var e=Math.abs(t);return e>=Or?Es(t,e,Or,"day"):e>=An?Es(t,e,An,"hour"):e>=In?Es(t,e,In,"minute"):e>=Cn?Es(t,e,Cn,"second"):t+" ms"}function Es(t,e,r,n){var i=e>=r*1.5;return Math.round(t/r)+" "+n+(i?"s":"")}});var o0=L((w4,s0)=>{function vb(t){r.debug=r,r.default=r,r.coerce=f,r.disable=s,r.enable=i,r.enabled=o,r.humanize=i0(),r.destroy=u,Object.keys(t).forEach(c=>{r[c]=t[c]}),r.names=[],r.skips=[],r.formatters={};function e(c){let h=0;for(let l=0;l<c.length;l++)h=(h<<5)-h+c.charCodeAt(l),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(c){let h,l=null,d,p;function g(...m){if(!g.enabled)return;let v=g,E=Number(new Date),I=E-(h||E);v.diff=I,v.prev=h,v.curr=E,h=E,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let T=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(C,P)=>{if(C==="%%")return"%";T++;let N=r.formatters[P];if(typeof N=="function"){let q=m[T];C=N.call(v,q),m.splice(T,1),T--}return C}),r.formatArgs.call(v,m),(v.log||r.log).apply(v,m)}return g.namespace=c,g.useColors=r.useColors(),g.color=r.selectColor(c),g.extend=n,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(d!==r.namespaces&&(d=r.namespaces,p=r.enabled(c)),p),set:m=>{l=m}}),typeof r.init=="function"&&r.init(g),g}function n(c,h){let l=r(this.namespace+(typeof h>"u"?":":h)+c);return l.log=this.log,l}function i(c){r.save(c),r.namespaces=c,r.names=[],r.skips=[];let h,l=(typeof c=="string"?c:"").split(/[\s,]+/),d=l.length;for(h=0;h<d;h++)!l[h]||(c=l[h].replace(/\*/g,".*?"),c[0]==="-"?r.skips.push(new RegExp("^"+c.slice(1)+"$")):r.names.push(new RegExp("^"+c+"$")))}function s(){let c=[...r.names.map(a),...r.skips.map(a).map(h=>"-"+h)].join(",");return r.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let h,l;for(h=0,l=r.skips.length;h<l;h++)if(r.skips[h].test(c))return!1;for(h=0,l=r.names.length;h<l;h++)if(r.names[h].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function f(c){return c instanceof Error?c.stack||c.message:c}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}s0.exports=vb});var a0=L((ut,Ss)=>{ut.formatArgs=wb;ut.save=Eb;ut.load=Sb;ut.useColors=xb;ut.storage=Db();ut.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ut.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function xb(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function wb(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Ss.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(r++,i==="%c"&&(n=r))}),t.splice(n,0,e)}ut.log=console.debug||console.log||(()=>{});function Eb(t){try{t?ut.storage.setItem("debug",t):ut.storage.removeItem("debug")}catch{}}function Sb(){let t;try{t=ut.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function Db(){try{return localStorage}catch{}}Ss.exports=o0()(ut);var{formatters:Cb}=Ss.exports;Cb.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var h0=L((P4,f0)=>{"use strict";f0.exports=Ib;function Ib(t,e){for(var r=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(a,f){r[n]=function(c){if(s)if(s=!1,c)f(c);else{for(var h=new Array(arguments.length-1),l=0;l<h.length;)h[l++]=arguments[l];a.apply(null,h)}};try{t.apply(e||null,r)}catch(u){s&&(s=!1,f(u))}})}});var g0=L(d0=>{"use strict";var As=d0;As.length=function(e){var r=e.length;if(!r)return 0;for(var n=0;--r%4>1&&e.charAt(r)==="=";)++n;return Math.ceil(e.length*3)/4-n};var _n=new Array(64),p0=new Array(123);for(St=0;St<64;)p0[_n[St]=St<26?St+65:St<52?St+71:St<62?St-4:St-59|43]=St++;var St;As.encode=function(e,r,n){for(var i=null,s=[],o=0,a=0,f;r<n;){var u=e[r++];switch(a){case 0:s[o++]=_n[u>>2],f=(u&3)<<4,a=1;break;case 1:s[o++]=_n[f|u>>4],f=(u&15)<<2,a=2;break;case 2:s[o++]=_n[f|u>>6],s[o++]=_n[u&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=_n[f],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var l0="invalid encoding";As.decode=function(e,r,n){for(var i=n,s=0,o,a=0;a<e.length;){var f=e.charCodeAt(a++);if(f===61&&s>1)break;if((f=p0[f])===void 0)throw Error(l0);switch(s){case 0:o=f,s=1;break;case 1:r[n++]=o<<2|(f&48)>>4,o=f,s=2;break;case 2:r[n++]=(o&15)<<4|(f&60)>>2,o=f,s=3;break;case 3:r[n++]=(o&3)<<6|f,s=0;break}}if(s===1)throw Error(l0);return n-i};As.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var m0=L((L4,y0)=>{"use strict";y0.exports=_s;function _s(){this._listeners={}}_s.prototype.on=function(e,r,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:n||this}),this};_s.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===r?n.splice(i,1):++i;return this};_s.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<r.length;)r[i].fn.apply(r[i++].ctx,n)}return this}});var D0=L((M4,S0)=>{"use strict";S0.exports=b0(b0);function b0(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),n=r[3]===128;function i(f,u,c){e[0]=f,u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3]}function s(f,u,c){e[0]=f,u[c]=r[3],u[c+1]=r[2],u[c+2]=r[1],u[c+3]=r[0]}t.writeFloatLE=n?i:s,t.writeFloatBE=n?s:i;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],e[0]}function a(f,u){return r[3]=f[u],r[2]=f[u+1],r[1]=f[u+2],r[0]=f[u+3],e[0]}t.readFloatLE=n?o:a,t.readFloatBE=n?a:o}():function(){function e(n,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,s,o);else if(isNaN(i))n(2143289344,s,o);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var f=Math.floor(Math.log(i)/Math.LN2),u=Math.round(i*Math.pow(2,-f)*8388608)&8388607;n((a<<31|f+127<<23|u)>>>0,s,o)}}t.writeFloatLE=e.bind(null,v0),t.writeFloatBE=e.bind(null,x0);function r(n,i,s){var o=n(i,s),a=(o>>31)*2+1,f=o>>>23&255,u=o&8388607;return f===255?u?NaN:a*(1/0):f===0?a*1401298464324817e-60*u:a*Math.pow(2,f-150)*(u+8388608)}t.readFloatLE=r.bind(null,w0),t.readFloatBE=r.bind(null,E0)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),n=r[7]===128;function i(f,u,c){e[0]=f,u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3],u[c+4]=r[4],u[c+5]=r[5],u[c+6]=r[6],u[c+7]=r[7]}function s(f,u,c){e[0]=f,u[c]=r[7],u[c+1]=r[6],u[c+2]=r[5],u[c+3]=r[4],u[c+4]=r[3],u[c+5]=r[2],u[c+6]=r[1],u[c+7]=r[0]}t.writeDoubleLE=n?i:s,t.writeDoubleBE=n?s:i;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],r[4]=f[u+4],r[5]=f[u+5],r[6]=f[u+6],r[7]=f[u+7],e[0]}function a(f,u){return r[7]=f[u],r[6]=f[u+1],r[5]=f[u+2],r[4]=f[u+3],r[3]=f[u+4],r[2]=f[u+5],r[1]=f[u+6],r[0]=f[u+7],e[0]}t.readDoubleLE=n?o:a,t.readDoubleBE=n?a:o}():function(){function e(n,i,s,o,a,f){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,a,f+i),n(1/o>0?0:2147483648,a,f+s);else if(isNaN(o))n(0,a,f+i),n(2146959360,a,f+s);else if(o>17976931348623157e292)n(0,a,f+i),n((u<<31|2146435072)>>>0,a,f+s);else{var c;if(o<22250738585072014e-324)c=o/5e-324,n(c>>>0,a,f+i),n((u<<31|c/4294967296)>>>0,a,f+s);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),c=o*Math.pow(2,-h),n(c*4503599627370496>>>0,a,f+i),n((u<<31|h+1023<<20|c*1048576&1048575)>>>0,a,f+s)}}}t.writeDoubleLE=e.bind(null,v0,0,4),t.writeDoubleBE=e.bind(null,x0,4,0);function r(n,i,s,o,a){var f=n(o,a+i),u=n(o,a+s),c=(u>>31)*2+1,h=u>>>20&2047,l=4294967296*(u&1048575)+f;return h===2047?l?NaN:c*(1/0):h===0?c*5e-324*l:c*Math.pow(2,h-1075)*(l+4503599627370496)}t.readDoubleLE=r.bind(null,w0,0,4),t.readDoubleBE=r.bind(null,E0,4,0)}(),t}function v0(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function x0(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=t&255}function w0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function E0(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}});var C0=L((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}});var A0=L(I0=>{"use strict";var Aa=I0;Aa.length=function(e){for(var r=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?r+=1:n<2048?r+=2:(n&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,r+=4):r+=3;return r};Aa.read=function(e,r,n){var i=n-r;if(i<1)return"";for(var s=null,o=[],a=0,f;r<n;)f=e[r++],f<128?o[a++]=f:f>191&&f<224?o[a++]=(f&31)<<6|e[r++]&63:f>239&&f<365?(f=((f&7)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,o[a++]=55296+(f>>10),o[a++]=56320+(f&1023)):o[a++]=(f&15)<<12|(e[r++]&63)<<6|e[r++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Aa.write=function(e,r,n){for(var i=n,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?r[n++]=s:s<2048?(r[n++]=s>>6|192,r[n++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,r[n++]=s>>18|240,r[n++]=s>>12&63|128,r[n++]=s>>6&63|128,r[n++]=s&63|128):(r[n++]=s>>12|224,r[n++]=s>>6&63|128,r[n++]=s&63|128);return n-i}});var T0=L((N4,_0)=>{"use strict";_0.exports=Ab;function Ab(t,e,r){var n=r||8192,i=n>>>1,s=null,o=n;return function(f){if(f<1||f>i)return t(f);o+f>n&&(s=t(n),o=0);var u=e.call(s,o,o+=f);return o&7&&(o=(o|7)+1),u}}});var P0=L((O4,B0)=>{"use strict";B0.exports=ze;var yi=br();function ze(t,e){this.lo=t>>>0,this.hi=e>>>0}var Kr=ze.zero=new ze(0,0);Kr.toNumber=function(){return 0};Kr.zzEncode=Kr.zzDecode=function(){return this};Kr.length=function(){return 1};var _b=ze.zeroHash="\0\0\0\0\0\0\0\0";ze.fromNumber=function(e){if(e===0)return Kr;var r=e<0;r&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return r&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new ze(n,i)};ze.from=function(e){if(typeof e=="number")return ze.fromNumber(e);if(yi.isString(e))if(yi.Long)e=yi.Long.fromString(e);else return ze.fromNumber(parseInt(e,10));return e.low||e.high?new ze(e.low>>>0,e.high>>>0):Kr};ze.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296};ze.prototype.toLong=function(e){return yi.Long?new yi.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var mr=String.prototype.charCodeAt;ze.fromHash=function(e){return e===_b?Kr:new ze((mr.call(e,0)|mr.call(e,1)<<8|mr.call(e,2)<<16|mr.call(e,3)<<24)>>>0,(mr.call(e,4)|mr.call(e,5)<<8|mr.call(e,6)<<16|mr.call(e,7)<<24)>>>0)};ze.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ze.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ze.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ze.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}});var br=L(_a=>{"use strict";var M=_a;M.asPromise=h0();M.base64=g0();M.EventEmitter=m0();M.float=D0();M.inquire=C0();M.utf8=A0();M.pool=T0();M.LongBits=P0();M.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);M.global=M.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||_a;M.emptyArray=Object.freeze?Object.freeze([]):[];M.emptyObject=Object.freeze?Object.freeze({}):{};M.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};M.isString=function(e){return typeof e=="string"||e instanceof String};M.isObject=function(e){return e&&typeof e=="object"};M.isset=M.isSet=function(e,r){var n=e[r];return n!=null&&e.hasOwnProperty(r)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};M.Buffer=function(){try{var t=M.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}();M._Buffer_from=null;M._Buffer_allocUnsafe=null;M.newBuffer=function(e){return typeof e=="number"?M.Buffer?M._Buffer_allocUnsafe(e):new M.Array(e):M.Buffer?M._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};M.Array=typeof Uint8Array<"u"?Uint8Array:Array;M.Long=M.global.dcodeIO&&M.global.dcodeIO.Long||M.global.Long||M.inquire("long");M.key2Re=/^true|false|0|1$/;M.key32Re=/^-?(?:0|[1-9][0-9]*)$/;M.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;M.longToHash=function(e){return e?M.LongBits.from(e).toHash():M.LongBits.zeroHash};M.longFromHash=function(e,r){var n=M.LongBits.fromHash(e);return M.Long?M.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))};function R0(t,e,r){for(var n=Object.keys(e),i=0;i<n.length;++i)(t[n[i]]===void 0||!r)&&(t[n[i]]=e[n[i]]);return t}M.merge=R0;M.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function L0(t){function e(r,n){if(!(this instanceof e))return new e(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&R0(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}M.newError=L0;M.ProtocolError=L0("ProtocolError");M.oneOfGetter=function(e){for(var r={},n=0;n<e.length;++n)r[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(r[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};M.oneOfSetter=function(e){return function(r){for(var n=0;n<e.length;++n)e[n]!==r&&delete this[e[n]]}};M.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};M._configure=function(){var t=M.Buffer;if(!t){M._Buffer_from=M._Buffer_allocUnsafe=null;return}M._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,n){return new t(r,n)},M._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var ka=L((U4,O0)=>{"use strict";O0.exports=te;var gt=br(),Ta,Ts=gt.LongBits,M0=gt.base64,k0=gt.utf8;function mi(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function Pa(){}function Tb(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function te(){this.len=0,this.head=new mi(Pa,0,0),this.tail=this.head,this.states=null}var N0=function(){return gt.Buffer?function(){return(te.create=function(){return new Ta})()}:function(){return new te}};te.create=N0();te.alloc=function(e){return new gt.Array(e)};gt.Array!==Array&&(te.alloc=gt.pool(te.alloc,gt.Array.prototype.subarray));te.prototype._push=function(e,r,n){return this.tail=this.tail.next=new mi(e,r,n),this.len+=r,this};function Ra(t,e,r){e[r]=t&255}function Bb(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function La(t,e){this.len=t,this.next=void 0,this.val=e}La.prototype=Object.create(mi.prototype);La.prototype.fn=Bb;te.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new La((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};te.prototype.int32=function(e){return e<0?this._push(Ma,10,Ts.fromNumber(e)):this.uint32(e)};te.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Ma(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}te.prototype.uint64=function(e){var r=Ts.from(e);return this._push(Ma,r.length(),r)};te.prototype.int64=te.prototype.uint64;te.prototype.sint64=function(e){var r=Ts.from(e).zzEncode();return this._push(Ma,r.length(),r)};te.prototype.bool=function(e){return this._push(Ra,1,e?1:0)};function Ba(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}te.prototype.fixed32=function(e){return this._push(Ba,4,e>>>0)};te.prototype.sfixed32=te.prototype.fixed32;te.prototype.fixed64=function(e){var r=Ts.from(e);return this._push(Ba,4,r.lo)._push(Ba,4,r.hi)};te.prototype.sfixed64=te.prototype.fixed64;te.prototype.float=function(e){return this._push(gt.float.writeFloatLE,4,e)};te.prototype.double=function(e){return this._push(gt.float.writeDoubleLE,8,e)};var Pb=gt.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var i=0;i<e.length;++i)r[n+i]=e[i]};te.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(Ra,1,0);if(gt.isString(e)){var n=te.alloc(r=M0.length(e));M0.decode(e,n,0),e=n}return this.uint32(r)._push(Pb,r,e)};te.prototype.string=function(e){var r=k0.length(e);return r?this.uint32(r)._push(k0.write,r,e):this._push(Ra,1,0)};te.prototype.fork=function(){return this.states=new Tb(this),this.head=this.tail=new mi(Pa,0,0),this.len=0,this};te.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new mi(Pa,0,0),this.len=0),this};te.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this};te.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r};te._configure=function(t){Ta=t,te.create=N0(),Ta._configure()}});var K0=L((K4,U0)=>{"use strict";U0.exports=Kt;var F0=ka();(Kt.prototype=Object.create(F0.prototype)).constructor=Kt;var vr=br();function Kt(){F0.call(this)}Kt._configure=function(){Kt.alloc=vr._Buffer_allocUnsafe,Kt.writeBytesBuffer=vr.Buffer&&vr.Buffer.prototype instanceof Uint8Array&&vr.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var i=0;i<e.length;)r[n++]=e[i++]}};Kt.prototype.bytes=function(e){vr.isString(e)&&(e=vr._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(Kt.writeBytesBuffer,r,e),this};function Rb(t,e,r){t.length<40?vr.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}Kt.prototype.string=function(e){var r=vr.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Rb,r,e),this};Kt._configure()});var Fa=L((V4,H0)=>{"use strict";H0.exports=Re;var Vt=br(),Oa,q0=Vt.LongBits,Lb=Vt.utf8;function Dt(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Re(t){this.buf=t,this.pos=0,this.len=t.length}var V0=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Re(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Re(e);throw Error("illegal buffer")},G0=function(){return Vt.Buffer?function(r){return(Re.create=function(i){return Vt.Buffer.isBuffer(i)?new Oa(i):V0(i)})(r)}:V0};Re.create=G0();Re.prototype._slice=Vt.Array.prototype.subarray||Vt.Array.prototype.slice;Re.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Dt(this,10);return e}}();Re.prototype.int32=function(){return this.uint32()|0};Re.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Na(){var t=new q0(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Dt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Dt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}Re.prototype.bool=function(){return this.uint32()!==0};function Bs(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}Re.prototype.fixed32=function(){if(this.pos+4>this.len)throw Dt(this,4);return Bs(this.buf,this.pos+=4)};Re.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Dt(this,4);return Bs(this.buf,this.pos+=4)|0};function z0(){if(this.pos+8>this.len)throw Dt(this,8);return new q0(Bs(this.buf,this.pos+=4),Bs(this.buf,this.pos+=4))}Re.prototype.float=function(){if(this.pos+4>this.len)throw Dt(this,4);var e=Vt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Re.prototype.double=function(){if(this.pos+8>this.len)throw Dt(this,4);var e=Vt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Re.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw Dt(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,n):r===n?new this.buf.constructor(0):this._slice.call(this.buf,r,n)};Re.prototype.string=function(){var e=this.bytes();return Lb.read(e,0,e.length)};Re.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Dt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Dt(this);while(this.buf[this.pos++]&128);return this};Re.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};Re._configure=function(t){Oa=t,Re.create=G0(),Oa._configure();var e=Vt.Long?"toLong":"toNumber";Vt.merge(Re.prototype,{int64:function(){return Na.call(this)[e](!1)},uint64:function(){return Na.call(this)[e](!0)},sint64:function(){return Na.call(this).zzDecode()[e](!1)},fixed64:function(){return z0.call(this)[e](!0)},sfixed64:function(){return z0.call(this)[e](!1)}})}});var Y0=L((z4,j0)=>{"use strict";j0.exports=Vr;var $0=Fa();(Vr.prototype=Object.create($0.prototype)).constructor=Vr;var W0=br();function Vr(t){$0.call(this,t)}Vr._configure=function(){W0.Buffer&&(Vr.prototype._slice=W0.Buffer.prototype.slice)};Vr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Vr._configure()});var Q0=L((q4,Z0)=>{"use strict";Z0.exports=bi;var Ua=br();(bi.prototype=Object.create(Ua.EventEmitter.prototype)).constructor=bi;function bi(t,e,r){if(typeof t!="function")throw TypeError("rpcImpl must be a function");Ua.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(r)}bi.prototype.rpcCall=function t(e,r,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Ua.asPromise(t,o,e,r,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,r[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(f,u){if(f)return o.emit("error",f,e),s(f);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(c){return o.emit("error",c,e),s(c)}return o.emit("data",u,e),s(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};bi.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var J0=L(X0=>{"use strict";var Mb=X0;Mb.Service=Q0()});var tl=L((H4,el)=>{"use strict";el.exports={}});var il=L(nl=>{"use strict";var it=nl;it.build="minimal";it.Writer=ka();it.BufferWriter=K0();it.Reader=Fa();it.BufferReader=Y0();it.util=br();it.rpc=J0();it.roots=tl();it.configure=rl;function rl(){it.util._configure(),it.Writer._configure(it.BufferWriter),it.Reader._configure(it.BufferReader)}rl()});var ol=L(($4,sl)=>{"use strict";sl.exports=il()});var cl=L((al,vi)=>{"use strict";(function(t,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof $a=="function"&&typeof vi=="object"&&vi&&vi.exports&&(vi.exports=e(ol()))})(al,function(t){"use strict";var e=t.Reader,r=t.Writer,n=t.util,i=t.roots.default||(t.roots.default={});return i.RPC=function(){function s(a){if(this.subscriptions=[],this.messages=[],a)for(var f=Object.keys(a),u=0;u<f.length;++u)a[f[u]]!=null&&(this[f[u]]=a[f[u]])}s.prototype.subscriptions=n.emptyArray,s.prototype.messages=n.emptyArray,s.prototype.control=null;var o;return Object.defineProperty(s.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),s.encode=function(f,u){if(u||(u=r.create()),f.subscriptions!=null&&f.subscriptions.length)for(var c=0;c<f.subscriptions.length;++c)i.RPC.SubOpts.encode(f.subscriptions[c],u.uint32(10).fork()).ldelim();if(f.messages!=null&&f.messages.length)for(var c=0;c<f.messages.length;++c)i.RPC.Message.encode(f.messages[c],u.uint32(18).fork()).ldelim();return f.control!=null&&Object.hasOwnProperty.call(f,"control")&&i.RPC.ControlMessage.encode(f.control,u.uint32(26).fork()).ldelim(),u},s.decode=function(f,u){f instanceof e||(f=e.create(f));for(var c=u===void 0?f.len:f.pos+u,h=new i.RPC;f.pos<c;){var l=f.uint32();switch(l>>>3){case 1:h.subscriptions&&h.subscriptions.length||(h.subscriptions=[]),h.subscriptions.push(i.RPC.SubOpts.decode(f,f.uint32()));break;case 2:h.messages&&h.messages.length||(h.messages=[]),h.messages.push(i.RPC.Message.decode(f,f.uint32()));break;case 3:h.control=i.RPC.ControlMessage.decode(f,f.uint32());break;default:f.skipType(l&7);break}}return h},s.fromObject=function(f){if(f instanceof i.RPC)return f;var u=new i.RPC;if(f.subscriptions){if(!Array.isArray(f.subscriptions))throw TypeError(".RPC.subscriptions: array expected");u.subscriptions=[];for(var c=0;c<f.subscriptions.length;++c){if(typeof f.subscriptions[c]!="object")throw TypeError(".RPC.subscriptions: object expected");u.subscriptions[c]=i.RPC.SubOpts.fromObject(f.subscriptions[c])}}if(f.messages){if(!Array.isArray(f.messages))throw TypeError(".RPC.messages: array expected");u.messages=[];for(var c=0;c<f.messages.length;++c){if(typeof f.messages[c]!="object")throw TypeError(".RPC.messages: object expected");u.messages[c]=i.RPC.Message.fromObject(f.messages[c])}}if(f.control!=null){if(typeof f.control!="object")throw TypeError(".RPC.control: object expected");u.control=i.RPC.ControlMessage.fromObject(f.control)}return u},s.toObject=function(f,u){u||(u={});var c={};if((u.arrays||u.defaults)&&(c.subscriptions=[],c.messages=[]),f.subscriptions&&f.subscriptions.length){c.subscriptions=[];for(var h=0;h<f.subscriptions.length;++h)c.subscriptions[h]=i.RPC.SubOpts.toObject(f.subscriptions[h],u)}if(f.messages&&f.messages.length){c.messages=[];for(var h=0;h<f.messages.length;++h)c.messages[h]=i.RPC.Message.toObject(f.messages[h],u)}return f.control!=null&&f.hasOwnProperty("control")&&(c.control=i.RPC.ControlMessage.toObject(f.control,u),u.oneofs&&(c._control="control")),c},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s.SubOpts=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.subscribe=null,a.prototype.topic=null;var f;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(f=["subscribe"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(f=["topic"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.subscribe!=null&&Object.hasOwnProperty.call(c,"subscribe")&&h.uint32(8).bool(c.subscribe),c.topic!=null&&Object.hasOwnProperty.call(c,"topic")&&h.uint32(18).string(c.topic),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new i.RPC.SubOpts;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.subscribe=c.bool();break;case 2:d.topic=c.string();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof i.RPC.SubOpts)return c;var h=new i.RPC.SubOpts;return c.subscribe!=null&&(h.subscribe=Boolean(c.subscribe)),c.topic!=null&&(h.topic=String(c.topic)),h},a.toObject=function(c,h){h||(h={});var l={};return c.subscribe!=null&&c.hasOwnProperty("subscribe")&&(l.subscribe=c.subscribe,h.oneofs&&(l._subscribe="subscribe")),c.topic!=null&&c.hasOwnProperty("topic")&&(l.topic=c.topic,h.oneofs&&(l._topic="topic")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.Message=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var f;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(f=["from"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(f=["data"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(f=["seqno"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(f=["signature"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(f=["key"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.from!=null&&Object.hasOwnProperty.call(c,"from")&&h.uint32(10).bytes(c.from),c.data!=null&&Object.hasOwnProperty.call(c,"data")&&h.uint32(18).bytes(c.data),c.seqno!=null&&Object.hasOwnProperty.call(c,"seqno")&&h.uint32(26).bytes(c.seqno),h.uint32(34).string(c.topic),c.signature!=null&&Object.hasOwnProperty.call(c,"signature")&&h.uint32(42).bytes(c.signature),c.key!=null&&Object.hasOwnProperty.call(c,"key")&&h.uint32(50).bytes(c.key),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new i.RPC.Message;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.from=c.bytes();break;case 2:d.data=c.bytes();break;case 3:d.seqno=c.bytes();break;case 4:d.topic=c.string();break;case 5:d.signature=c.bytes();break;case 6:d.key=c.bytes();break;default:c.skipType(p&7);break}}if(!d.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:d});return d},a.fromObject=function(c){if(c instanceof i.RPC.Message)return c;var h=new i.RPC.Message;return c.from!=null&&(typeof c.from=="string"?n.base64.decode(c.from,h.from=n.newBuffer(n.base64.length(c.from)),0):c.from.length&&(h.from=c.from)),c.data!=null&&(typeof c.data=="string"?n.base64.decode(c.data,h.data=n.newBuffer(n.base64.length(c.data)),0):c.data.length&&(h.data=c.data)),c.seqno!=null&&(typeof c.seqno=="string"?n.base64.decode(c.seqno,h.seqno=n.newBuffer(n.base64.length(c.seqno)),0):c.seqno.length&&(h.seqno=c.seqno)),c.topic!=null&&(h.topic=String(c.topic)),c.signature!=null&&(typeof c.signature=="string"?n.base64.decode(c.signature,h.signature=n.newBuffer(n.base64.length(c.signature)),0):c.signature.length&&(h.signature=c.signature)),c.key!=null&&(typeof c.key=="string"?n.base64.decode(c.key,h.key=n.newBuffer(n.base64.length(c.key)),0):c.key.length&&(h.key=c.key)),h},a.toObject=function(c,h){h||(h={});var l={};return h.defaults&&(l.topic=""),c.from!=null&&c.hasOwnProperty("from")&&(l.from=h.bytes===String?n.base64.encode(c.from,0,c.from.length):h.bytes===Array?Array.prototype.slice.call(c.from):c.from,h.oneofs&&(l._from="from")),c.data!=null&&c.hasOwnProperty("data")&&(l.data=h.bytes===String?n.base64.encode(c.data,0,c.data.length):h.bytes===Array?Array.prototype.slice.call(c.data):c.data,h.oneofs&&(l._data="data")),c.seqno!=null&&c.hasOwnProperty("seqno")&&(l.seqno=h.bytes===String?n.base64.encode(c.seqno,0,c.seqno.length):h.bytes===Array?Array.prototype.slice.call(c.seqno):c.seqno,h.oneofs&&(l._seqno="seqno")),c.topic!=null&&c.hasOwnProperty("topic")&&(l.topic=c.topic),c.signature!=null&&c.hasOwnProperty("signature")&&(l.signature=h.bytes===String?n.base64.encode(c.signature,0,c.signature.length):h.bytes===Array?Array.prototype.slice.call(c.signature):c.signature,h.oneofs&&(l._signature="signature")),c.key!=null&&c.hasOwnProperty("key")&&(l.key=h.bytes===String?n.base64.encode(c.key,0,c.key.length):h.bytes===Array?Array.prototype.slice.call(c.key):c.key,h.oneofs&&(l._key="key")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.ControlMessage=function(){function a(f){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],f)for(var u=Object.keys(f),c=0;c<u.length;++c)f[u[c]]!=null&&(this[u[c]]=f[u[c]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(u,c){if(c||(c=r.create()),u.ihave!=null&&u.ihave.length)for(var h=0;h<u.ihave.length;++h)i.RPC.ControlIHave.encode(u.ihave[h],c.uint32(10).fork()).ldelim();if(u.iwant!=null&&u.iwant.length)for(var h=0;h<u.iwant.length;++h)i.RPC.ControlIWant.encode(u.iwant[h],c.uint32(18).fork()).ldelim();if(u.graft!=null&&u.graft.length)for(var h=0;h<u.graft.length;++h)i.RPC.ControlGraft.encode(u.graft[h],c.uint32(26).fork()).ldelim();if(u.prune!=null&&u.prune.length)for(var h=0;h<u.prune.length;++h)i.RPC.ControlPrune.encode(u.prune[h],c.uint32(34).fork()).ldelim();return c},a.decode=function(u,c){u instanceof e||(u=e.create(u));for(var h=c===void 0?u.len:u.pos+c,l=new i.RPC.ControlMessage;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:l.ihave&&l.ihave.length||(l.ihave=[]),l.ihave.push(i.RPC.ControlIHave.decode(u,u.uint32()));break;case 2:l.iwant&&l.iwant.length||(l.iwant=[]),l.iwant.push(i.RPC.ControlIWant.decode(u,u.uint32()));break;case 3:l.graft&&l.graft.length||(l.graft=[]),l.graft.push(i.RPC.ControlGraft.decode(u,u.uint32()));break;case 4:l.prune&&l.prune.length||(l.prune=[]),l.prune.push(i.RPC.ControlPrune.decode(u,u.uint32()));break;default:u.skipType(d&7);break}}return l},a.fromObject=function(u){if(u instanceof i.RPC.ControlMessage)return u;var c=new i.RPC.ControlMessage;if(u.ihave){if(!Array.isArray(u.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");c.ihave=[];for(var h=0;h<u.ihave.length;++h){if(typeof u.ihave[h]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");c.ihave[h]=i.RPC.ControlIHave.fromObject(u.ihave[h])}}if(u.iwant){if(!Array.isArray(u.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");c.iwant=[];for(var h=0;h<u.iwant.length;++h){if(typeof u.iwant[h]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");c.iwant[h]=i.RPC.ControlIWant.fromObject(u.iwant[h])}}if(u.graft){if(!Array.isArray(u.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");c.graft=[];for(var h=0;h<u.graft.length;++h){if(typeof u.graft[h]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");c.graft[h]=i.RPC.ControlGraft.fromObject(u.graft[h])}}if(u.prune){if(!Array.isArray(u.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");c.prune=[];for(var h=0;h<u.prune.length;++h){if(typeof u.prune[h]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");c.prune[h]=i.RPC.ControlPrune.fromObject(u.prune[h])}}return c},a.toObject=function(u,c){c||(c={});var h={};if((c.arrays||c.defaults)&&(h.ihave=[],h.iwant=[],h.graft=[],h.prune=[]),u.ihave&&u.ihave.length){h.ihave=[];for(var l=0;l<u.ihave.length;++l)h.ihave[l]=i.RPC.ControlIHave.toObject(u.ihave[l],c)}if(u.iwant&&u.iwant.length){h.iwant=[];for(var l=0;l<u.iwant.length;++l)h.iwant[l]=i.RPC.ControlIWant.toObject(u.iwant[l],c)}if(u.graft&&u.graft.length){h.graft=[];for(var l=0;l<u.graft.length;++l)h.graft[l]=i.RPC.ControlGraft.toObject(u.graft[l],c)}if(u.prune&&u.prune.length){h.prune=[];for(var l=0;l<u.prune.length;++l)h.prune[l]=i.RPC.ControlPrune.toObject(u.prune[l],c)}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.ControlIHave=function(){function a(u){if(this.messageIDs=[],u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){if(h||(h=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&h.uint32(10).string(c.topicID),c.messageIDs!=null&&c.messageIDs.length)for(var l=0;l<c.messageIDs.length;++l)h.uint32(18).bytes(c.messageIDs[l]);return h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new i.RPC.ControlIHave;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.topicID=c.string();break;case 2:d.messageIDs&&d.messageIDs.length||(d.messageIDs=[]),d.messageIDs.push(c.bytes());break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof i.RPC.ControlIHave)return c;var h=new i.RPC.ControlIHave;if(c.topicID!=null&&(h.topicID=String(c.topicID)),c.messageIDs){if(!Array.isArray(c.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");h.messageIDs=[];for(var l=0;l<c.messageIDs.length;++l)typeof c.messageIDs[l]=="string"?n.base64.decode(c.messageIDs[l],h.messageIDs[l]=n.newBuffer(n.base64.length(c.messageIDs[l])),0):c.messageIDs[l].length&&(h.messageIDs[l]=c.messageIDs[l])}return h},a.toObject=function(c,h){h||(h={});var l={};if((h.arrays||h.defaults)&&(l.messageIDs=[]),c.topicID!=null&&c.hasOwnProperty("topicID")&&(l.topicID=c.topicID,h.oneofs&&(l._topicID="topicID")),c.messageIDs&&c.messageIDs.length){l.messageIDs=[];for(var d=0;d<c.messageIDs.length;++d)l.messageIDs[d]=h.bytes===String?n.base64.encode(c.messageIDs[d],0,c.messageIDs[d].length):h.bytes===Array?Array.prototype.slice.call(c.messageIDs[d]):c.messageIDs[d]}return l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.ControlIWant=function(){function a(f){if(this.messageIDs=[],f)for(var u=Object.keys(f),c=0;c<u.length;++c)f[u[c]]!=null&&(this[u[c]]=f[u[c]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(u,c){if(c||(c=r.create()),u.messageIDs!=null&&u.messageIDs.length)for(var h=0;h<u.messageIDs.length;++h)c.uint32(10).bytes(u.messageIDs[h]);return c},a.decode=function(u,c){u instanceof e||(u=e.create(u));for(var h=c===void 0?u.len:u.pos+c,l=new i.RPC.ControlIWant;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:l.messageIDs&&l.messageIDs.length||(l.messageIDs=[]),l.messageIDs.push(u.bytes());break;default:u.skipType(d&7);break}}return l},a.fromObject=function(u){if(u instanceof i.RPC.ControlIWant)return u;var c=new i.RPC.ControlIWant;if(u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");c.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)typeof u.messageIDs[h]=="string"?n.base64.decode(u.messageIDs[h],c.messageIDs[h]=n.newBuffer(n.base64.length(u.messageIDs[h])),0):u.messageIDs[h].length&&(c.messageIDs[h]=u.messageIDs[h])}return c},a.toObject=function(u,c){c||(c={});var h={};if((c.arrays||c.defaults)&&(h.messageIDs=[]),u.messageIDs&&u.messageIDs.length){h.messageIDs=[];for(var l=0;l<u.messageIDs.length;++l)h.messageIDs[l]=c.bytes===String?n.base64.encode(u.messageIDs[l],0,u.messageIDs[l].length):c.bytes===Array?Array.prototype.slice.call(u.messageIDs[l]):u.messageIDs[l]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.ControlGraft=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.topicID=null;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&h.uint32(10).string(c.topicID),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new i.RPC.ControlGraft;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.topicID=c.string();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof i.RPC.ControlGraft)return c;var h=new i.RPC.ControlGraft;return c.topicID!=null&&(h.topicID=String(c.topicID)),h},a.toObject=function(c,h){h||(h={});var l={};return c.topicID!=null&&c.hasOwnProperty("topicID")&&(l.topicID=c.topicID,h.oneofs&&(l._topicID="topicID")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.ControlPrune=function(){function a(u){if(this.peers=[],u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(f=["backoff"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){if(h||(h=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&h.uint32(10).string(c.topicID),c.peers!=null&&c.peers.length)for(var l=0;l<c.peers.length;++l)i.RPC.PeerInfo.encode(c.peers[l],h.uint32(18).fork()).ldelim();return c.backoff!=null&&Object.hasOwnProperty.call(c,"backoff")&&h.uint32(24).uint64(c.backoff),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new i.RPC.ControlPrune;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.topicID=c.string();break;case 2:d.peers&&d.peers.length||(d.peers=[]),d.peers.push(i.RPC.PeerInfo.decode(c,c.uint32()));break;case 3:d.backoff=c.uint64();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof i.RPC.ControlPrune)return c;var h=new i.RPC.ControlPrune;if(c.topicID!=null&&(h.topicID=String(c.topicID)),c.peers){if(!Array.isArray(c.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");h.peers=[];for(var l=0;l<c.peers.length;++l){if(typeof c.peers[l]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");h.peers[l]=i.RPC.PeerInfo.fromObject(c.peers[l])}}return c.backoff!=null&&(n.Long?(h.backoff=n.Long.fromValue(c.backoff)).unsigned=!0:typeof c.backoff=="string"?h.backoff=parseInt(c.backoff,10):typeof c.backoff=="number"?h.backoff=c.backoff:typeof c.backoff=="object"&&(h.backoff=new n.LongBits(c.backoff.low>>>0,c.backoff.high>>>0).toNumber(!0))),h},a.toObject=function(c,h){h||(h={});var l={};if((h.arrays||h.defaults)&&(l.peers=[]),c.topicID!=null&&c.hasOwnProperty("topicID")&&(l.topicID=c.topicID,h.oneofs&&(l._topicID="topicID")),c.peers&&c.peers.length){l.peers=[];for(var d=0;d<c.peers.length;++d)l.peers[d]=i.RPC.PeerInfo.toObject(c.peers[d],h)}return c.backoff!=null&&c.hasOwnProperty("backoff")&&(typeof c.backoff=="number"?l.backoff=h.longs===String?String(c.backoff):c.backoff:l.backoff=h.longs===String?n.Long.prototype.toString.call(c.backoff):h.longs===Number?new n.LongBits(c.backoff.low>>>0,c.backoff.high>>>0).toNumber(!0):c.backoff,h.oneofs&&(l._backoff="backoff")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s.PeerInfo=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var f;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(f=["peerID"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(f=["signedPeerRecord"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.peerID!=null&&Object.hasOwnProperty.call(c,"peerID")&&h.uint32(10).bytes(c.peerID),c.signedPeerRecord!=null&&Object.hasOwnProperty.call(c,"signedPeerRecord")&&h.uint32(18).bytes(c.signedPeerRecord),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new i.RPC.PeerInfo;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.peerID=c.bytes();break;case 2:d.signedPeerRecord=c.bytes();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof i.RPC.PeerInfo)return c;var h=new i.RPC.PeerInfo;return c.peerID!=null&&(typeof c.peerID=="string"?n.base64.decode(c.peerID,h.peerID=n.newBuffer(n.base64.length(c.peerID)),0):c.peerID.length&&(h.peerID=c.peerID)),c.signedPeerRecord!=null&&(typeof c.signedPeerRecord=="string"?n.base64.decode(c.signedPeerRecord,h.signedPeerRecord=n.newBuffer(n.base64.length(c.signedPeerRecord)),0):c.signedPeerRecord.length&&(h.signedPeerRecord=c.signedPeerRecord)),h},a.toObject=function(c,h){h||(h={});var l={};return c.peerID!=null&&c.hasOwnProperty("peerID")&&(l.peerID=h.bytes===String?n.base64.encode(c.peerID,0,c.peerID.length):h.bytes===Array?Array.prototype.slice.call(c.peerID):c.peerID,h.oneofs&&(l._peerID="peerID")),c.signedPeerRecord!=null&&c.hasOwnProperty("signedPeerRecord")&&(l.signedPeerRecord=h.bytes===String?n.base64.encode(c.signedPeerRecord,0,c.signedPeerRecord.length):h.bytes===Array?Array.prototype.slice.call(c.signedPeerRecord):c.signedPeerRecord,h.oneofs&&(l._signedPeerRecord="signedPeerRecord")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),s}(),i})});var vl=L((mC,bl)=>{"use strict";function Ie(t,r){var r=r||{};this._head=0,this._tail=0,this._capacity=r.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}Ie.prototype.peekAt=function(e){var r=e;if(r===(r|0)){var n=this.size();if(!(r>=n||r<-n))return r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r]}};Ie.prototype.get=function(e){return this.peekAt(e)};Ie.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Ie.prototype.peekFront=function(){return this.peek()};Ie.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Ie.prototype,"length",{get:function(){return this.size()}});Ie.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Ie.prototype.unshift=function(e){if(e===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Ie.prototype.shift=function(){var e=this._head;if(e!==this._tail){var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r}};Ie.prototype.push=function(e){if(e===void 0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Ie.prototype.pop=function(){var e=this._tail;if(e!==this._head){var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n}};Ie.prototype.removeOne=function(e){var r=e;if(r===(r|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(r>=n||r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r],o;if(e<n/2){for(o=e;o>0;o--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Ie.prototype.remove=function(e,r){var n=e,i,s=r;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||r<1)){if(n<0&&(n+=o),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=o)return i=this.toArray(),this.clear(),i;n+r>o&&(r=o-n);var f;for(i=new Array(r),f=0;f<r;f++)i[f]=this._list[this._head+n+f&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===o){for(this._tail=this._tail-r+a&this._capacityMask,f=r;f>0;f--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+r+a&this._capacityMask,f=r-1;f>0;f--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+r+a&this._capacityMask,f=e;f>0;f--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+a&this._capacityMask,f=o-(r+e);f>0;f--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Ie.prototype.splice=function(e,r){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,f=arguments.length,u=this._list.length,c=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(r===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._head=this._head+n+u&this._capacityMask);f>c;)this.unshift(arguments[--f]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+r));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+r+s&this._capacityMask];for(r===0?(a=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._tail=this._tail-h+u&this._capacityMask);c<f;)this.push(arguments[c++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,r)}};Ie.prototype.clear=function(){this._head=0,this._tail=0};Ie.prototype.isEmpty=function(){return this._head===this._tail};Ie.prototype.toArray=function(){return this._copyArray(!1)};Ie.prototype._fromArray=function(e){for(var r=0;r<e.length;r++)this.push(e[r])};Ie.prototype._copyArray=function(e){var r=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)r.push(n[s]);for(s=0;s<this._tail;s++)r.push(n[s])}else for(s=this._head;s<this._tail;s++)r.push(n[s]);return r};Ie.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};Ie.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};bl.exports=Ie});var _v={};qe(_v,{GossipSub:()=>Ks,multicodec:()=>Av});var Ci=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},$r=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Ci(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let r=this.head;this.head=r.next=new Ci(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let r=this.tail.next;this.tail.next=null,this.tail=r,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function xr(t={}){return Kl(r=>{let n=r.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},t)}function Kl(t,e){e=e??{};let r=e.onEnd,n=new $r,i,s,o,a=async()=>n.isEmpty()?o?{done:!0}:await new Promise((g,m)=>{s=v=>{s=null,n.push(v);try{g(t(n))}catch(E){m(E)}return i}}):t(n),f=g=>s!=null?s(g):(n.push(g),i),u=g=>(n=new $r,s!=null?s({error:g}):(n.push({error:g}),i)),c=g=>{if(o)return i;if(e?.objectMode!==!0&&g?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return f({done:!1,value:g})},h=g=>o?i:(o=!0,g!=null?u(g):f({done:!0})),l=()=>(n=new $r,h(),{done:!0}),d=g=>(h(g),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:a,return:l,throw:d,push:c,end:h,get readableLength(){return n.size}},r==null)return i;let p=i;return i={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(g){return p.throw(g),r!=null&&(r(g),r=void 0),{done:!0}},return(){return p.return(),r!=null&&(r(),r=void 0),{done:!0}},push:c,end(g){return p.end(g),r!=null&&(r(g),r=void 0),i},get readableLength(){return p.readableLength}},i}var ic=U(nc(),1),ql=(...t)=>{let e;for(;t.length>0;)e=t.shift()(e);return e},sc=t=>t!=null&&(typeof t[Symbol.asyncIterator]=="function"||typeof t[Symbol.iterator]=="function"||typeof t.next=="function"),Ws=t=>t!=null&&typeof t.sink=="function"&&sc(t.source),Gl=t=>e=>{let r=t.sink(e);if(r.then!=null){let n=xr({objectMode:!0});return r.then(()=>{n.end()},s=>{n.end(s)}),(0,ic.default)(n,async function*(){yield*t.source,n.end()}())}return t.source};function jr(t,...e){if(Ws(t)){let n=t;t=()=>n.source}else if(sc(t)){let n=t;t=()=>n}let r=[t,...e];if(r.length>1&&Ws(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)Ws(r[n])&&(r[n]=Gl(r[n]));return ql(...r)}var Nh=U(Ae(),1);function Ht(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.alloc!=null?globalThis.Buffer.alloc(t):new Uint8Array(t)}function We(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function he(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));let r=We(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}var Qs={};qe(Qs,{identity:()=>Ql});function Wl(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,f=t.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,v=0,E=p.length;v!==E&&p[v]===0;)v++,g++;for(var I=(E-v)*c+1>>>0,T=new Uint8Array(I);v!==E;){for(var x=p[v],C=0,P=I-1;(x!==0||C<m)&&P!==-1;P--,C++)x+=256*T[P]>>>0,T[P]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");m=C,v++}for(var N=I-m;N!==I&&T[N]===0;)N++;for(var q=f.repeat(g);N<I;++N)q+=t.charAt(T[N]);return q}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,v=0;p[g]===f;)m++,g++;for(var E=(p.length-g)*u+1>>>0,I=new Uint8Array(E);p[g];){var T=r[p.charCodeAt(g)];if(T===255)return;for(var x=0,C=E-1;(T!==0||x<v)&&C!==-1;C--,x++)T+=a*I[C]>>>0,I[C]=T%256>>>0,T=T/256>>>0;if(T!==0)throw new Error("Non-zero carry");v=x,g++}if(p[g]!==" "){for(var P=E-v;P!==E&&I[P]===0;)P++;for(var N=new Uint8Array(m+(E-P)),q=m;P!==E;)N[q++]=I[P++];return N}}}function d(p){var g=l(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:l,decode:d}}var $l=Wl,jl=$l,cc=jl;var Wv=new Uint8Array(0);var uc=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},Wt=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var fc=t=>new TextEncoder().encode(t),hc=t=>new TextDecoder().decode(t);var $s=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},js=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pc(this,e)}},Ys=class{constructor(e){this.decoders=e}or(e){return pc(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},pc=(t,e)=>new Ys({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),Zs=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new $s(e,r,n),this.decoder=new js(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Yr=({name:t,prefix:e,encode:r,decode:n})=>new Zs(t,e,r,n),ir=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:i}=cc(r,e);return Yr({prefix:t,name:e,encode:n,decode:s=>Wt(i(s))})},Yl=(t,e,r,n)=>{let i={};for(let c=0;c<e.length;++c)i[e[c]]=c;let s=t.length;for(;t[s-1]==="=";)--s;let o=new Uint8Array(s*r/8|0),a=0,f=0,u=0;for(let c=0;c<s;++c){let h=i[t[c]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&f>>a)}if(a>=r||255&f<<8-a)throw new SyntaxError("Unexpected end of data");return o},Zl=(t,e,r)=>{let n=e[e.length-1]==="=",i=(1<<r)-1,s="",o=0,a=0;for(let f=0;f<t.length;++f)for(a=a<<8|t[f],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Se=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Yr({prefix:e,name:t,encode(i){return Zl(i,n,r)},decode(i){return Yl(i,n,r,t)}});var Ql=Yr({prefix:"\0",name:"identity",encode:t=>hc(t),decode:t=>fc(t)});var Xs={};qe(Xs,{base2:()=>Xl});var Xl=Se({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Js={};qe(Js,{base8:()=>Jl});var Jl=Se({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var eo={};qe(eo,{base10:()=>ep});var ep=ir({prefix:"9",name:"base10",alphabet:"0123456789"});var to={};qe(to,{base16:()=>tp,base16upper:()=>rp});var tp=Se({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rp=Se({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ro={};qe(ro,{base32:()=>mt,base32hex:()=>op,base32hexpad:()=>cp,base32hexpadupper:()=>up,base32hexupper:()=>ap,base32pad:()=>ip,base32padupper:()=>sp,base32upper:()=>np,base32z:()=>fp});var mt=Se({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),np=Se({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ip=Se({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sp=Se({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),op=Se({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ap=Se({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cp=Se({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),up=Se({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fp=Se({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var no={};qe(no,{base36:()=>hp,base36upper:()=>lp});var hp=ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),lp=ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var io={};qe(io,{base58btc:()=>_e,base58flickr:()=>pp});var _e=ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),pp=ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var so={};qe(so,{base64:()=>Zr,base64pad:()=>dp,base64url:()=>gp,base64urlpad:()=>yp});var Zr=Se({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dp=Se({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),gp=Se({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yp=Se({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var oo={};qe(oo,{base256emoji:()=>wp});var dc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),mp=dc.reduce((t,e,r)=>(t[r]=e,t),[]),bp=dc.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function vp(t){return t.reduce((e,r)=>(e+=mp[r],e),"")}function xp(t){let e=[];for(let r of t){let n=bp[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}var wp=Yr({prefix:"\u{1F680}",name:"base256emoji",encode:vp,decode:xp});var fo={};qe(fo,{sha256:()=>Me,sha512:()=>Kp});var Ep=mc,gc=128,Sp=127,Dp=~Sp,Cp=Math.pow(2,31);function mc(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Cp;)e[r++]=t&255|gc,t/=128;for(;t&Dp;)e[r++]=t&255|gc,t>>>=7;return e[r]=t|0,mc.bytes=r-n+1,e}var Ip=ao,Ap=128,yc=127;function ao(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw ao.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&yc)<<i:(o&yc)*Math.pow(2,i),i+=7}while(o>=Ap);return ao.bytes=s-n,r}var _p=Math.pow(2,7),Tp=Math.pow(2,14),Bp=Math.pow(2,21),Pp=Math.pow(2,28),Rp=Math.pow(2,35),Lp=Math.pow(2,42),Mp=Math.pow(2,49),kp=Math.pow(2,56),Np=Math.pow(2,63),Op=function(t){return t<_p?1:t<Tp?2:t<Bp?3:t<Pp?4:t<Rp?5:t<Lp?6:t<Mp?7:t<kp?8:t<Np?9:10},Fp={encode:Ep,decode:Ip,encodingLength:Op},Up=Fp,Fn=Up;var Un=t=>[Fn.decode(t),Fn.decode.bytes],Qr=(t,e,r=0)=>(Fn.encode(t,e,r),e),Xr=t=>Fn.encodingLength(t);var Ct=(t,e)=>{let r=e.byteLength,n=Xr(t),i=n+Xr(r),s=new Uint8Array(i+r);return Qr(t,s,0),Qr(r,s,n),s.set(e,i),new Jr(t,r,e,s)},wr=t=>{let e=Wt(t),[r,n]=Un(e),[i,s]=Un(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Jr(r,i,o,e)},bc=(t,e)=>t===e?!0:t.code===e.code&&t.size===e.size&&uc(t.bytes,e.bytes),Jr=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};var uo=({name:t,code:e,encode:r})=>new co(t,e,r),co=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Ct(this.code,r):r.then(n=>Ct(this.code,n))}else throw Error("Unknown type, must be binary type")}};var xc=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Me=uo({name:"sha2-256",code:18,encode:xc("SHA-256")}),Kp=uo({name:"sha2-512",code:19,encode:xc("SHA-512")});var ho={};qe(ho,{identity:()=>sr});var wc=0,Vp="identity",Ec=Wt,zp=t=>Ct(wc,Ec(t)),sr={code:wc,name:Vp,encode:Ec,digest:zp};var px=new TextEncoder,dx=new TextDecoder;var le=class{constructor(e,r,n,i){this.code=r,this.version=e,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:_i,byteLength:_i,code:Ai,version:Ai,multihash:Ai,bytes:Ai,_baseCache:_i,asCID:_i})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==Kn)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==jp)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return le.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=Ct(e,r);return le.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&bc(this.multihash,e.multihash)}toString(e){let{bytes:r,version:n,_baseCache:i}=this;switch(n){case 0:return Wp(r,i,e||_e.encoder);default:return $p(r,i,e||mt.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Zp(/^0\.0/,Qp),!!(e&&(e[Dc]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof le)return e;if(e!=null&&e.asCID===e){let{version:r,code:n,multihash:i,bytes:s}=e;return new le(r,n,i,s||Sc(r,n,i.bytes))}else if(e!=null&&e[Dc]===!0){let{version:r,multihash:n,code:i}=e,s=wr(n);return le.create(r,i,s)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==Kn)throw new Error(`Version 0 CID must use dag-pb (code: ${Kn}) block encoding`);return new le(e,r,n,n.bytes)}case 1:{let i=Sc(e,r,n.bytes);return new le(e,r,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return le.create(0,Kn,e)}static createV1(e,r){return le.create(1,e,r)}static decode(e){let[r,n]=le.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=le.inspectBytes(e),n=r.size-r.multihashSize,i=Wt(e.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=i.subarray(r.multihashSize-r.digestSize),o=new Jr(r.multihashCode,r.digestSize,s,i);return[r.version===0?le.createV0(o):le.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,l]=Un(e.subarray(r));return r+=l,h},i=n(),s=Kn;if(i===18?(i=0,r=0):i===1&&(s=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=r,a=n(),f=n(),u=r+f,c=u-o;return{version:i,codec:s,multihashCode:a,digestSize:f,multihashSize:c,size:u}}static parse(e,r){let[n,i]=Hp(e,r),s=le.decode(i);return s._baseCache.set(n,e),s}},Hp=(t,e)=>{switch(t[0]){case"Q":{let r=e||_e;return[_e.prefix,r.decode(`${_e.prefix}${t}`)]}case _e.prefix:{let r=e||_e;return[_e.prefix,r.decode(t)]}case mt.prefix:{let r=e||mt;return[mt.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},Wp=(t,e,r)=>{let{prefix:n}=r;if(n!==_e.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=e.get(n);if(i==null){let s=r.encode(t).slice(1);return e.set(n,s),s}else return i},$p=(t,e,r)=>{let{prefix:n}=r,i=e.get(n);if(i==null){let s=r.encode(t);return e.set(n,s),s}else return i},Kn=112,jp=18,Sc=(t,e,r)=>{let n=Xr(t),i=n+Xr(e),s=new Uint8Array(i+r.byteLength);return Qr(t,s,0),Qr(e,s,n),s.set(r,i),s},Dc=Symbol.for("@ipld/js-cid/CID"),Ai={writable:!1,configurable:!1,enumerable:!0},_i={writable:!1,enumerable:!1,configurable:!1},Yp="0.0.0-dev",Zp=(t,e)=>{if(t.test(Yp))console.warn(e);else throw new Error(e)},Qp=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var en={...Qs,...Xs,...Js,...eo,...to,...ro,...no,...io,...so,...oo},Ex={...fo,...ho};function Ic(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var Cc=Ic("utf8","u",t=>{let e=new TextDecoder("utf8");return"u"+e.decode(t)},t=>new TextEncoder().encode(t.substring(1))),lo=Ic("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=We(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Xp={utf8:Cc,"utf-8":Cc,hex:en.base16,latin1:lo,ascii:lo,binary:lo,...en},Ti=Xp;function oe(t,e="utf8"){let r=Ti[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function De(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}var _c=Symbol.for("@achingbrain/uint8arraylist");function Ac(t,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let r=0;for(let n of t){let i=r+n.byteLength;if(e<i)return{buf:n,index:e-r};r=i}throw new RangeError("index is out of bounds")}function po(t){return Boolean(t?.[_c])}var X=class{constructor(...e){Object.defineProperty(this,_c,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let r=0;for(let n of e)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(po(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...e){this.prependAll(e)}prependAll(e){let r=0;for(let n of e.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(po(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(e){let r=Ac(this.bufs,e);return r.buf[r.index]}set(e,r){let n=Ac(this.bufs,e);n.buf[n.index]=r}write(e,r=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(r+n,e[n]);else if(po(e))for(let n=0;n<e.length;n++)this.set(r+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0))for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}slice(e,r){let{bufs:n,length:i}=this._subList(e,r);return he(n,i)}subarray(e,r){let{bufs:n,length:i}=this._subList(e,r);return n.length===1?n[0]:he(n,i)}sublist(e,r){let{bufs:n,length:i}=this._subList(e,r),s=new X;return s.length=i,s.bufs=n,s}_subList(e,r){if(e=e??0,r=r??this.length,e<0&&(e=this.length+e),r<0&&(r=this.length+r),e<0||r>this.length)throw new RangeError("index is out of bounds");if(e===r)return{bufs:[],length:0};if(e===0&&r===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],i=0;for(let s=0;s<this.bufs.length;s++){let o=this.bufs[s],a=i,f=a+o.byteLength;if(i=f,e>=f)continue;let u=e>=a&&e<f,c=r>a&&r<=f;if(u&&c){if(e===a&&r===f){n.push(o);break}let h=e-a;n.push(o.subarray(h,h+(r-e)));break}if(u){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(c){if(r===f){n.push(o);break}n.push(o.subarray(0,r-a));break}n.push(o)}return{bufs:n,length:r-e}}getInt8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(e,r){let n=We(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,e)}getInt16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(e,r,n){let i=Ht(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,r,n),this.write(i,e)}getInt32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(e,r,n){let i=Ht(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,r,n),this.write(i,e)}getBigInt64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(e,r,n){let i=Ht(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,r,n),this.write(i,e)}getUint8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(e,r){let n=We(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,e)}getUint16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(e,r,n){let i=Ht(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,r,n),this.write(i,e)}getUint32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(e,r,n){let i=Ht(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,r,n),this.write(i,e)}getBigUint64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(e,r,n){let i=Ht(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,r,n),this.write(i,e)}getFloat32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(e,r,n){let i=Ht(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,r,n),this.write(i,e)}getFloat64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(e,r,n){let i=Ht(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,r,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof X)||e.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!De(this.bufs[r],e.bufs[r]))return!1;return!0}static fromUint8Arrays(e,r){let n=new X;return n.bufs=e,r==null&&(r=e.reduce((i,s)=>i+s.byteLength,0)),n.length=r,n}};function tn(t){return t instanceof Uint8Array?{get(e){return t[e]},set(e,r){t[e]=r}}:{get(e){return t.get(e)},set(e,r){t.set(e,r)}}}var Tc=4294967296,Te=class{constructor(e=0,r=0){this.hi=e,this.lo=r}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!==0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){let e=-(this.lo&1),r=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Te(n,r)}zzEncode(){let e=this.hi>>31,r=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Te(r,n)}toBytes(e,r=0){let n=tn(e);for(;this.hi>0;)n.set(r++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(r++,this.lo&127|128),this.lo=this.lo>>>7;n.set(r++,this.lo)}static fromBigInt(e){if(e===0n)return new Te;let r=e<0;r&&(e=-e);let n=Number(e>>32n)|0,i=Number(e-(BigInt(n)<<32n))|0;return r&&(n=~n>>>0,i=~i>>>0,++i>Tc&&(i=0,++n>Tc&&(n=0))),new Te(n,i)}static fromNumber(e){if(e===0)return new Te;let r=e<0;r&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return r&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Te(i,n)}static fromBytes(e,r=0){let n=tn(e),i=new Te,s=0;if(e.length-r>4){for(;s<4;++s)if(i.lo=(i.lo|(n.get(r)&127)<<s*7)>>>0,n.get(r++)<128)return i;if(i.lo=(i.lo|(n.get(r)&127)<<28)>>>0,i.hi=(i.hi|(n.get(r)&127)>>4)>>>0,n.get(r++)<128)return i;s=0}else for(;s<4;++s){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(i.lo=(i.lo|(n.get(r)&127)<<s*7)>>>0,n.get(r++)<128)return i}if(e.length-r>4){for(;s<5;++s)if(i.hi=(i.hi|(n.get(r)&127)<<s*7+3)>>>0,n.get(r++)<128)return i}else if(r<e.byteLength)for(;s<5;++s){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(i.hi=(i.hi|(n.get(r)&127)<<s*7+3)>>>0,n.get(r++)<128)return i}throw RangeError("invalid varint encoding")}};var Jp=Math.pow(2,7),ed=Math.pow(2,14),td=Math.pow(2,21),rd=Math.pow(2,28),nd=Math.pow(2,35),id=Math.pow(2,42),sd=Math.pow(2,49),od=Math.pow(2,56),ad=Math.pow(2,63),F={encodingLength(t){return t<Jp?1:t<ed?2:t<td?3:t<rd?4:t<nd?5:t<id?6:t<sd?7:t<od?8:t<ad?9:10},encode(t,e,r=0){if(Number.MAX_SAFE_INTEGER!=null&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=We(F.encodingLength(t))),Te.fromNumber(t).toBytes(e,r),e},decode(t,e=0){return Te.fromBytes(t,e).toNumber(!0)}},Vn={encodingLength(t){return t<0?10:F.encodingLength(t)},encode(t,e,r){return e==null&&(e=We(Vn.encodingLength(t))),t<0?(Te.fromNumber(t).toBytes(e,r),e):F.encode(t,e,r)},decode(t,e=0){return Te.fromBytes(t,e).toNumber(!1)}},Bi={encodingLength(t){return F.encodingLength(t>=0?t*2:t*-2-1)},encode(t,e,r){return t=t>=0?t*2:t*-2-1,F.encode(t,e,r)},decode(t,e=0){let r=F.decode(t,e);return(r&1)!==0?(r+1)/-2:r/2}};function rn(t){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Pi(t,e){let r=rn(F.encodingLength(t.byteLength));return F.encode(t.byteLength,r),e.decode(new X(r,t),0)}function Ri(t,e){let r=e.encode(t),n=F.encodingLength(F.decode(r));return r instanceof Uint8Array?new X(r.subarray(n)):r.sublist(n)}var z;(function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"})(z||(z={}));function j(t,e,r,n,i){return{name:t,type:e,encode:r,decode:n,encodingLength:i}}var cd=function(){return 1},ud=function(e){return Uint8Array.from([e?1:0])},fd=function(e,r){return e.get(r)>0},hd=j("bool",z.VARINT,ud,fd,cd);var ld=function(e){let r=e.byteLength;return F.encodingLength(r)+r},pd=function(e){return new X(F.encode(e.byteLength),e)},dd=function(e,r){let n=F.decode(e,r);return r+=F.encodingLength(n),e.subarray(r,r+n)},Li=j("bytes",z.LENGTH_DELIMITED,pd,dd,ld);var Bc=function(){return 8},gd=function(e){let r=new X(new Uint8Array(Bc(e)));return r.setFloat64(0,e,!0),r},yd=function(e,r){return e.getFloat64(r,!0)},md=j("double",z.BIT64,gd,yd,Bc);function go(t){function e(s){if(t[s.toString()]==null)throw new Error("Invalid enum value");return typeof s=="number"?s:t[s]}let r=function(o){return F.encodingLength(e(o))},n=function(o){let a=e(o),f=rn(F.encodingLength(a));return F.encode(a,f),f},i=function(o,a){let u=F.decode(o,a).toString();if(t[u]==null)throw new Error("Invalid enum value");return t[u]};return j("enum",z.VARINT,n,i,r)}var Pc=function(){return 4},bd=function(e){let r=new X(new Uint8Array(Pc(e)));return r.setInt32(0,e,!0),r},vd=function(e,r){return e.getInt32(r,!0)},xd=j("fixed32",z.BIT32,bd,vd,Pc);var Rc=function(e){return 8},wd=function(e){let r=new X(new Uint8Array(Rc(e)));return r.setBigInt64(0,e,!0),r},Ed=function(e,r){return e.getBigInt64(r,!0)},Sd=j("fixed64",z.BIT64,wd,Ed,Rc);var Lc=function(){return 4},Dd=function(e){let r=new X(new Uint8Array(Lc(1)));return r.setFloat32(0,e,!0),r},Cd=function(e,r){return e.getFloat32(r,!0)},Id=j("float",z.BIT32,Dd,Cd,Lc);var Mc=function(e){return e<0?10:Vn.encodingLength(e)},Ad=function(e){let r=new Uint8Array(Mc(e));return Vn.encode(e,r)},_d=function(e,r){return Vn.decode(e,r)|0},Td=j("int32",z.VARINT,Ad,_d,Mc);var kc=0x7fn,or={encodingLength(t){let e=0;for(;t>=0x80n;e++)t>>=7n;return e+1},encode(t,e,r=0){e==null&&(e=We(or.encodingLength(t)));let n=tn(e);for(;kc<t;)n.set(r++,Number(t&kc)|128),t>>=7n;return n.set(r,Number(t)),e},decode(t,e=0){return Te.fromBytes(t,e).toBigInt(!0)}},zn={encodingLength(t){return t<0n?10:or.encodingLength(t)},encode(t,e,r){return e==null&&(e=We(zn.encodingLength(t))),t<0n?(Te.fromBigInt(t).toBytes(e,r),e):or.encode(t,e,r)},decode(t,e=0){return Te.fromBytes(t,e).toBigInt(!1)}},qn={encodingLength(t){return or.encodingLength(t>=0?t*2n:t*-2n-1n)},encode(t,e,r){return e==null&&(e=We(qn.encodingLength(t))),Te.fromBigInt(t).zzEncode().toBytes(e,r),e},decode(t,e=0){return Te.fromBytes(t,e).zzDecode().toBigInt(!1)}};var Nc=function(e){return e<0n?10:zn.encodingLength(e)},Bd=function(e){let r=new Uint8Array(Nc(e));return zn.encode(e,r)},Pd=function(e,r){return zn.decode(e,r)|0n},Rd=j("int64",z.VARINT,Bd,Pd,Nc);function Mi(t){let e=function(s){let o=0;for(let a of Object.values(t))o+=a.codec.encodingLength(s[a.name]);return F.encodingLength(o)+o},r=function(s){let o=new X;function a(u,c,h){if(u==null){if(h.optional===!0)return;throw new Error(`Non optional field "${h.name}" was ${u===null?"null":"undefined"}`)}let l=c<<3|h.codec.type,d=rn(F.encodingLength(l));F.encode(l,d);let p=h.codec.encode(u);o.append(d),o.append(p)}for(let[u,c]of Object.entries(t)){let h=parseInt(u);if(c.repeats===!0){if(!Array.isArray(s[c.name]))throw new Error(`Repeating field "${c.name}" was not an array`);for(let l of s[c.name])a(l,h,c)}else a(s[c.name],h,c)}let f=F.encode(o.length);return new X(f,o)},n=function(s,o){let a=F.decode(s,o);o+=F.encodingLength(a);let f=o+a,u={};for(;o<f;){let c=F.decode(s,o);o+=F.encodingLength(c);let h=c&7,l=c>>3,d=t[l],p=0;if(h===z.VARINT)if(d!=null){let g=d.codec.decode(s,o);p=d.codec.encodingLength(g)}else{let g=F.decode(s,o);p=F.encodingLength(g)}else if(h===z.BIT64)p=8;else if(h===z.LENGTH_DELIMITED){let g=F.decode(s,o);p=g+F.encodingLength(g)}else if(h===z.BIT32)p=4;else{if(h===z.START_GROUP)throw new Error("Unsupported wire type START_GROUP");if(h===z.END_GROUP)throw new Error("Unsupported wire type END_GROUP")}if(d!=null){let g=d.codec.decode(s,o);d.repeats===!0?(u[d.name]==null&&(u[d.name]=[]),u[d.name].push(g)):u[d.name]=g}o+=p}for(let c of Object.values(t))c.repeats===!0&&u[c.name]==null&&(u[c.name]=[]);return u};return j("message",z.LENGTH_DELIMITED,r,n,e)}var Oc=function(){return 4},Ld=function(e){let r=new X(new Uint8Array(Oc(e)));return r.setInt32(0,e,!0),r},Md=function(e,r){return e.getInt32(r,!0)},kd=j("sfixed32",z.BIT32,Ld,Md,Oc);var Fc=function(){return 8},Nd=function(e){let r=new X(new Uint8Array(Fc(e)));return r.setBigInt64(0,e,!0),r},Od=function(e,r){return e.getBigInt64(r,!0)},Fd=j("sfixed64",z.BIT64,Nd,Od,Fc);var Ud=function(e){return Bi.encodingLength(e)},Kd=function(e){return Bi.encode(e)},Vd=function(e,r){return Bi.decode(e,r)},zd=j("sint32",z.VARINT,Kd,Vd,Ud);var qd=function(e){return qn.encodingLength(e)},Gd=function(e){return qn.encode(e)},Hd=function(e,r){return qn.decode(e,r)},Wd=j("sint64",z.VARINT,Gd,Hd,qd);function W(t,e="utf8"){let r=Ti[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var $d=function(e){let r=oe(e).byteLength;return F.encodingLength(r)+r},jd=function(e){let r=oe(e);return new X(F.encode(r.byteLength),r)},Yd=function(e,r){let n=F.decode(e,r);return r+=F.encodingLength(n),W(e.subarray(r,r+n))},Zd=j("string",z.LENGTH_DELIMITED,jd,Yd,$d);var Qd=function(e){return F.encodingLength(e)},Xd=function(e){return F.encode(e)},Jd=function(e,r){return F.decode(e,r)},eg=j("uint32",z.VARINT,Xd,Jd,Qd);var tg=function(e){return or.encodingLength(e)},rg=function(e){return or.encode(e)},ng=function(e,r){return or.decode(e,r)},ig=j("uint64",z.VARINT,rg,ng,tg);var Ce;(function(t){t.RSA="RSA",t.Ed25519="Ed25519",t.Secp256k1="Secp256k1"})(Ce||(Ce={}));var yo;(function(t){t[t.RSA=0]="RSA",t[t.Ed25519=1]="Ed25519",t[t.Secp256k1=2]="Secp256k1"})(yo||(yo={}));(function(t){t.codec=()=>go(yo)})(Ce||(Ce={}));var It;(function(t){t.codec=()=>Mi({1:{name:"Type",codec:Ce.codec()},2:{name:"Data",codec:Li}}),t.encode=e=>Ri(e,t.codec()),t.decode=e=>Pi(e,t.codec())})(It||(It={}));var At;(function(t){t.codec=()=>Mi({1:{name:"Type",codec:Ce.codec()},2:{name:"Data",codec:Li}}),t.encode=e=>Ri(e,t.codec()),t.decode=e=>Pi(e,t.codec())})(At||(At={}));var u3=U($n(),1),f3=U(Ju(),1),E1=U(ae(),1),nh=U(Ae(),1);var Tm=U(Ae(),1);var tt={get(t=globalThis){let e=t.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var Bm=U(Ae(),1);var sS=U(Be(),1),oS=U(Zi(),1),tf=U(ae(),1);function xt(t,e){let r=Uint8Array.from(t.abs().toByteArray());if(r=r[0]===0?r.slice(1):r,e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=he([new Uint8Array(e-r.length),r])}return W(r,"base64url")}function at(t){let e=rf(t);return new tf.default.jsbn.BigInteger(W(e,"base16"),16)}function rf(t,e){let r=oe(t,"base64urlpad");if(e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=he([new Uint8Array(e-r.length),r])}return r}var Pm={"P-256":256,"P-384":384,"P-521":521},Rm=Object.keys(Pm),yS=Rm.join(" / ");function Uo(t){let e=t?.algorithm??"AES-GCM",r=t?.keyLength??16,n=t?.nonceLength??12,i=t?.digest??"SHA-256",s=t?.saltLength??16,o=t?.iterations??32767,a=tt.get();r*=8;async function f(h,l){let d=a.getRandomValues(new Uint8Array(s)),p=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:p};typeof l=="string"&&(l=oe(l));let m={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},v=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),E=await a.subtle.deriveKey(m,v,{name:e,length:r},!0,["encrypt"]),I=await a.subtle.encrypt(g,E,h);return he([d,g.iv,new Uint8Array(I)])}async function u(h,l){let d=h.slice(0,s),p=h.slice(s,s+n),g=h.slice(s+n),m={name:e,iv:p};typeof l=="string"&&(l=oe(l));let v={name:"PBKDF2",salt:d,iterations:o,hash:{name:i}},E=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),I=await a.subtle.deriveKey(v,E,{name:e,length:r},!0,["decrypt"]),T=await a.subtle.decrypt(m,I,g);return new Uint8Array(T)}return{encrypt:f,decrypt:u}}var Xo={};qe(Xo,{RsaPrivateKey:()=>pn,RsaPublicKey:()=>ti,fromJwk:()=>t1,generateKeyPair:()=>r1,unmarshalRsaPrivateKey:()=>Jm,unmarshalRsaPublicKey:()=>e1});var Qo=U(Ae(),1);var $S=U(uf(),1),ei=U(ae(),1);var Mm=U(on(),1);var re=BigInt(0),fe=BigInt(1),Pe=BigInt(2),Xn=BigInt(3),km=BigInt(8),Go=Pe**BigInt(256),de={a:re,b:BigInt(7),P:Go-Pe**BigInt(32)-BigInt(977),n:Go-BigInt("432420386565659656852420866394968145599"),h:fe,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")};function ff(t){let{a:e,b:r}=de,n=R(t*t),i=R(n*t);return R(i+e*t+r)}var es=de.a===re,ie=class{constructor(e,r,n){this.x=e,this.y=r,this.z=n}static fromAffine(e){if(!(e instanceof ne))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new ie(e.x,e.y,fe)}static toAffineBatch(e){let r=Um(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(r[i]))}static normalizeZ(e){return ie.toAffineBatch(e).map(ie.fromAffine)}equals(e){if(!(e instanceof ie))throw new TypeError("JacobianPoint expected");let{x:r,y:n,z:i}=this,{x:s,y:o,z:a}=e,f=R(i**Pe),u=R(a**Pe),c=R(r*u),h=R(s*f),l=R(R(n*a)*u),d=R(R(o*i)*f);return c===h&&l===d}negate(){return new ie(this.x,R(-this.y),this.z)}double(){let{x:e,y:r,z:n}=this,i=R(e**Pe),s=R(r**Pe),o=R(s**Pe),a=R(Pe*(R((e+s)**Pe)-i-o)),f=R(Xn*i),u=R(f**Pe),c=R(u-Pe*a),h=R(f*(a-c)-km*o),l=R(Pe*r*n);return new ie(c,h,l)}add(e){if(!(e instanceof ie))throw new TypeError("JacobianPoint expected");let{x:r,y:n,z:i}=this,{x:s,y:o,z:a}=e;if(s===re||o===re)return this;if(r===re||n===re)return e;let f=R(i**Pe),u=R(a**Pe),c=R(r*u),h=R(s*f),l=R(R(n*a)*u),d=R(R(o*i)*f),p=R(h-c),g=R(d-l);if(p===re)return g===re?this.double():ie.ZERO;let m=R(p**Pe),v=R(p*m),E=R(c*m),I=R(g**Pe-v-Pe*E),T=R(g*(E-I)-l*v),x=R(i*a*p);return new ie(I,T,x)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let r=ie.ZERO;if(typeof e=="bigint"&&e===re)return r;let n=pf(e);if(n===fe)return this;if(!es){let h=r,l=this;for(;n>re;)n&fe&&(h=h.add(l)),l=l.double(),n>>=fe;return h}let{k1neg:i,k1:s,k2neg:o,k2:a}=gf(n),f=r,u=r,c=this;for(;s>re||a>re;)s&fe&&(f=f.add(c)),a&fe&&(u=u.add(c)),c=c.double(),s>>=fe,a>>=fe;return i&&(f=f.negate()),o&&(u=u.negate()),u=new ie(R(u.x*de.beta),u.y,u.z),f.add(u)}precomputeWindow(e){let r=es?128/e+1:256/e+1,n=[],i=this,s=i;for(let o=0;o<r;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,r){!r&&this.equals(ie.BASE)&&(r=ne.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=r&&Ho.get(r);i||(i=this.precomputeWindow(n),r&&n!==1&&(i=ie.normalizeZ(i),Ho.set(r,i)));let s=ie.ZERO,o=ie.ZERO,a=1+(es?128/n:256/n),f=2**(n-1),u=BigInt(2**n-1),c=2**n,h=BigInt(n);for(let l=0;l<a;l++){let d=l*f,p=Number(e&u);if(e>>=h,p>f&&(p-=c,e+=fe),p===0){let g=i[d];l%2&&(g=g.negate()),o=o.add(g)}else{let g=i[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}}return{p:s,f:o}}multiply(e,r){let n=pf(e),i,s;if(es){let{k1neg:o,k1:a,k2neg:f,k2:u}=gf(n),{p:c,f:h}=this.wNAF(a,r),{p:l,f:d}=this.wNAF(u,r);o&&(c=c.negate()),f&&(l=l.negate()),l=new ie(R(l.x*de.beta),l.y,l.z),i=c.add(l),s=h.add(d)}else{let{p:o,f:a}=this.wNAF(n,r);i=o,s=a}return ie.normalizeZ([i,s])[0]}toAffine(e=hn(this.z)){let{x:r,y:n,z:i}=this,s=e,o=R(s*s),a=R(o*s),f=R(r*o),u=R(n*a);if(R(i*s)!==fe)throw new Error("invZ was invalid");return new ne(f,u)}};ie.BASE=new ie(de.Gx,de.Gy,fe);ie.ZERO=new ie(re,fe,re);var Ho=new WeakMap,ne=class{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,Ho.delete(this)}static fromCompressedHex(e){let r=e.length===32,n=kt(r?e:e.subarray(1));if(!qo(n))throw new Error("Point is not on curve");let i=ff(n),s=Fm(i),o=(s&fe)===fe;r?o&&(s=R(-s)):(e[0]&1)===1!==o&&(s=R(-s));let a=new ne(n,s);return a.assertValidity(),a}static fromUncompressedHex(e){let r=kt(e.subarray(1,33)),n=kt(e.subarray(33,65)),i=new ne(r,n);return i.assertValidity(),i}static fromHex(e){let r=Pr(e),n=r.length,i=r[0];if(n===32||n===33&&(i===2||i===3))return this.fromCompressedHex(r);if(n===65&&i===4)return this.fromUncompressedHex(r);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return ne.BASE.multiply(Tr(e))}static fromSignature(e,r,n){e=Pr(e);let i=yf(e),{r:s,s:o}=mf(r);if(n!==0&&n!==1)throw new Error("Cannot recover signature: invalid recovery bit");let a=n&1?"03":"02",f=ne.fromHex(a+Br(s)),{n:u}=de,c=hn(s,u),h=R(-i*c,u),l=R(o*c,u),d=ne.BASE.multiplyAndAddUnsafe(f,h,l);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(e=!1){return hr(this.toHex(e))}toHex(e=!1){let r=Br(this.x);return e?`${this.y&fe?"03":"02"}${r}`:`04${r}${Br(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:r,y:n}=this;if(!qo(r)||!qo(n))throw new Error(e);let i=R(n*n),s=ff(r);if(R(i-s)!==re)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new ne(this.x,R(-this.y))}double(){return ie.fromAffine(this).double().toAffine()}add(e){return ie.fromAffine(this).add(ie.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return ie.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,r,n){let i=ie.fromAffine(this),s=r===re||r===fe||this!==ne.BASE?i.multiplyUnsafe(r):i.multiply(r),o=ie.fromAffine(e).multiplyUnsafe(n),a=s.add(o);return a.equals(ie.ZERO)?void 0:a.toAffine()}};ne.BASE=new ne(de.Gx,de.Gy);ne.ZERO=new ne(re,re);function hf(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function lf(t){if(t.length<2||t[0]!==2)throw new Error(`Invalid signature integer tag: ${fn(t)}`);let e=t[1],r=t.subarray(2,e+2);if(!e||r.length!==e)throw new Error("Invalid signature integer: wrong length");if(r[0]===0&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:kt(r),left:t.subarray(e+2)}}function Nm(t){if(t.length<2||t[0]!=48)throw new Error(`Invalid signature tag: ${fn(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:r}=lf(t.subarray(2)),{data:n,left:i}=lf(r);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${fn(i)}`);return{r:e,s:n}}var Mt=class{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromCompact(e){let r=ns(e),n="Signature.fromCompact";if(typeof e!="string"&&!r)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=r?fn(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Mt(is(i.slice(0,64)),is(i.slice(64,128)))}static fromDER(e){let r=ns(e);if(typeof e!="string"&&!r)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=Nm(r?e:hr(e));return new Mt(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:r}=this;if(!Jn(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Jn(r))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=de.n>>fe;return this.s>e}normalizeS(){return this.hasHighS()?new Mt(this.r,de.n-this.s):this}toDERRawBytes(e=!1){return hr(this.toDERHex(e))}toDERHex(e=!1){let r=hf(Qn(this.s));if(e)return r;let n=hf(Qn(this.r)),i=Qn(n.length/2),s=Qn(r.length/2);return`30${Qn(n.length/2+r.length/2+4)}02${i}${n}02${s}${r}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return hr(this.toCompactHex())}toCompactHex(){return Br(this.r)+Br(this.s)}};function un(...t){if(!t.every(ns))throw new Error("Uint8Array list expected");if(t.length===1)return t[0];let e=t.reduce((n,i)=>n+i.length,0),r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){let s=t[n];r.set(s,i),i+=s.length}return r}function ns(t){return t instanceof Uint8Array}var Om=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function fn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let r=0;r<t.length;r++)e+=Om[t[r]];return e}function Br(t){if(t>Go)throw new Error("Expected number < 2^256");return t.toString(16).padStart(64,"0")}function zo(t){return hr(Br(t))}function Qn(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function is(t){if(typeof t!="string")throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function hr(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,i=t.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[r]=s}return e}function kt(t){return is(fn(t))}function Pr(t){return t instanceof Uint8Array?Uint8Array.from(t):hr(t)}function pf(t){if(typeof t=="number"&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if(typeof t=="bigint"&&Jn(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function R(t,e=de.P){let r=t%e;return r>=re?r:e+r}function pt(t,e){let{P:r}=de,n=t;for(;e-- >re;)n*=n,n%=r;return n}function Fm(t){let{P:e}=de,r=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),f=t*t*t%e,u=f*f*t%e,c=pt(u,Xn)*u%e,h=pt(c,Xn)*u%e,l=pt(h,Pe)*f%e,d=pt(l,n)*l%e,p=pt(d,i)*d%e,g=pt(p,o)*p%e,m=pt(g,a)*g%e,v=pt(m,o)*p%e,E=pt(v,Xn)*u%e,I=pt(E,s)*d%e,T=pt(I,r)*f%e;return pt(T,Pe)}function hn(t,e=de.P){if(t===re||e<=re)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=R(t,e),n=e,i=re,s=fe,o=fe,a=re;for(;r!==re;){let u=n/r,c=n%r,h=i-o*u,l=s-a*u;n=r,r=c,i=o,s=a,o=h,a=l}if(n!==fe)throw new Error("invert: does not exist");return R(i,e)}function Um(t,e=de.P){let r=new Array(t.length),n=t.reduce((s,o,a)=>o===re?s:(r[a]=s,R(s*o,e)),fe),i=hn(n,e);return t.reduceRight((s,o,a)=>o===re?s:(r[a]=R(s*r[a],e),R(s*o,e)),i),r}var df=(t,e)=>(t+e/Pe)/e,ts=Pe**BigInt(128);function gf(t){let{n:e}=de,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-fe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=df(s*t,e),a=df(-n*t,e),f=R(t-o*r-a*i,e),u=R(-o*n-a*s,e),c=f>ts,h=u>ts;if(c&&(f=e-f),h&&(u=e-u),f>ts||u>ts)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:c,k1:f,k2neg:h,k2:u}}function yf(t){let{n:e}=de,n=t.length*8-256,i=kt(t);return n>0&&(i=i>>BigInt(n)),i>=e&&(i-=e),i}var Wo=class{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...e){return Ye.hmacSha256(this.k,...e)}hmacSync(...e){if(typeof Ye.hmacSha256Sync!="function")throw new Error("utils.hmacSha256Sync is undefined, you need to set it");let r=Ye.hmacSha256Sync(this.k,...e);if(r instanceof Promise)throw new Error("To use sync sign(), ensure utils.hmacSha256 is sync");return r}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.incr(),this.v=this.hmacSync(this.v),this.v}};function Jn(t){return re<t&&t<de.n}function qo(t){return re<t&&t<de.P}function Km(t,e,r){let n=kt(t);if(!Jn(n))return;let{n:i}=de,s=ne.BASE.multiply(n),o=R(s.x,i);if(o===re)return;let a=R(hn(n,i)*R(e+r*o,i),i);if(a===re)return;let f=new Mt(o,a),u=(s.x===f.r?0:2)|Number(s.y&fe);return{sig:f,recovery:u}}function Tr(t){let e;if(typeof t=="bigint")e=t;else if(typeof t=="number"&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if(typeof t=="string"){if(t.length!==64)throw new Error("Expected 32 bytes of private key");e=is(t)}else if(ns(t)){if(t.length!==32)throw new Error("Expected 32 bytes of private key");e=kt(t)}else throw new TypeError("Expected valid private key");if(!Jn(e))throw new Error("Expected private key: 0 < key < n");return e}function Vm(t){return t instanceof ne?(t.assertValidity(),t):ne.fromHex(t)}function mf(t){if(t instanceof Mt)return t.assertValidity(),t;try{return Mt.fromDER(t)}catch{return Mt.fromCompact(t)}}function $o(t,e=!1){return ne.fromPrivateKey(t).toRawBytes(e)}function bf(t){let e=t.length>32?t.slice(0,32):t;return kt(e)}function zm(t){let e=bf(t),r=R(e,de.n);return vf(r<re?e:r)}function vf(t){if(typeof t!="bigint")throw new Error("Expected bigint");let e=Br(t);return hr(e)}function qm(t,e,r){if(t==null)throw new Error(`sign: expected valid message hash, not "${t}"`);let n=Pr(t),i=Tr(e),s=[vf(i),zm(n)];if(r!=null){r===!0&&(r=Ye.randomBytes(32));let f=Pr(r);if(f.length!==32)throw new Error("sign: Expected 32 bytes of extra data");s.push(f)}let o=un(...s),a=bf(n);return{seed:o,m:a,d:i}}function Gm(t,e){let{sig:r,recovery:n}=t,{canonical:i,der:s,recovered:o}=Object.assign({canonical:!0,der:!0},e);i&&r.hasHighS()&&(r=r.normalizeS(),n^=1);let a=s?r.toDERRawBytes():r.toCompactRawBytes();return o?[a,n]:a}async function xf(t,e,r={}){let{seed:n,m:i,d:s}=qm(t,e,r.extraEntropy),o,a=new Wo;for(await a.reseed(n);!(o=Km(await a.generate(),i,s));)await a.reseed();return Gm(o,r)}var Hm={strict:!0};function wf(t,e,r,n=Hm){let i;try{i=mf(t),e=Pr(e)}catch{return!1}let{r:s,s:o}=i;if(n.strict&&i.hasHighS())return!1;let a=yf(e),f;try{f=Vm(r)}catch{return!1}let{n:u}=de,c=hn(o,u),h=R(a*c,u),l=R(s*c,u),d=ne.BASE.multiplyAndAddUnsafe(f,h,l);return d?R(d.x,u)===s:!1}ne.BASE._setWindowSize(8);var ct={node:Mm,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var rs={},Ye={isValidPrivateKey(t){try{return Tr(t),!0}catch{return!1}},privateAdd:(t,e)=>{let r=Tr(t),n=Tr(e);return zo(R(r+n,de.n))},privateNegate:t=>{let e=Tr(t);return zo(de.n-e)},pointAddScalar:(t,e,r)=>{let n=ne.fromHex(t),i=Tr(e),s=ne.BASE.multiplyAndAddUnsafe(n,i,fe);if(!s)throw new Error("Tweaked point at infinity");return s.toRawBytes(r)},pointMultiply:(t,e,r)=>{let n=ne.fromHex(t),i=kt(Pr(e));return n.multiply(i).toRawBytes(r)},hashToPrivateKey:t=>{if(t=Pr(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=R(kt(t),de.n-fe)+fe;return zo(e)},randomBytes:(t=32)=>{if(ct.web)return ct.web.getRandomValues(new Uint8Array(t));if(ct.node){let{randomBytes:e}=ct.node;return Uint8Array.from(e(t))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Ye.hashToPrivateKey(Ye.randomBytes(40)),bytesToHex:fn,hexToBytes:hr,concatBytes:un,mod:R,invert:hn,sha256:async(...t)=>{if(ct.web){let e=await ct.web.subtle.digest("SHA-256",un(...t));return new Uint8Array(e)}else if(ct.node){let{createHash:e}=ct.node,r=e("sha256");return t.forEach(n=>r.update(n)),Uint8Array.from(r.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(ct.web){let r=await ct.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=un(...e),i=await ct.web.subtle.sign("HMAC",r,n);return new Uint8Array(i)}else if(ct.node){let{createHmac:r}=ct.node,n=r("sha256",t);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let r=rs[t];if(r===void 0){let n=await Ye.sha256(Uint8Array.from(t,i=>i.charCodeAt(0)));r=un(n,n),rs[t]=r}return Ye.sha256(r,...e)},taggedHashSync:(t,...e)=>{if(typeof Ye.sha256Sync!="function")throw new Error("utils.sha256Sync is undefined, you need to set it");let r=rs[t];if(r===void 0){let n=Ye.sha256Sync(Uint8Array.from(t,i=>i.charCodeAt(0)));r=un(n,n),rs[t]=r}return Ye.sha256Sync(r,...e)},precompute(t=8,e=ne.BASE){let r=e===ne.BASE?e:new ne(e.x,e.y);return r._setWindowSize(t),r.multiply(Xn),r}};var Ef=U(Ae(),1);function Zt(t){if(isNaN(t)||t<=0)throw(0,Ef.default)(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return Ye.randomBytes(t)}var Rr={};qe(Rr,{jwkToPkcs1:()=>jm,jwkToPkix:()=>Zm,pkcs1ToJwk:()=>$m,pkixToJwk:()=>Ym});var TS=U($n(),1),BS=U(Ji(),1),Qt=U(ae(),1);var jo=U(Ae(),1);function $m(t){let e=Qt.default.asn1.fromDer(W(t,"ascii")),r=Qt.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:xt(r.n),e:xt(r.e),d:xt(r.d),p:xt(r.p),q:xt(r.q),dp:xt(r.dP),dq:xt(r.dQ),qi:xt(r.qInv),alg:"RS256"}}function jm(t){if(t.n==null||t.e==null||t.d==null||t.p==null||t.q==null||t.dp==null||t.dq==null||t.qi==null)throw(0,jo.default)(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");let e=Qt.default.pki.privateKeyToAsn1({n:at(t.n),e:at(t.e),d:at(t.d),p:at(t.p),q:at(t.q),dP:at(t.dp),dQ:at(t.dq),qInv:at(t.qi)});return oe(Qt.default.asn1.toDer(e).getBytes(),"ascii")}function Ym(t){let e=Qt.default.asn1.fromDer(W(t,"ascii")),r=Qt.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:xt(r.n),e:xt(r.e)}}function Zm(t){if(t.n==null||t.e==null)throw(0,jo.default)(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");let e=Qt.default.pki.publicKeyToAsn1({n:at(t.n),e:at(t.e)});return oe(Qt.default.asn1.toDer(e).getBytes(),"ascii")}var MS=U(Ji(),1),Yo=U(ae(),1);function Sf(t,e){return e.map(r=>at(t[r]))}function Df(t){return Yo.default.pki.setRsaPrivateKey(...Sf(t,["n","e","d","p","q","dp","dq","qi"]))}function Cf(t){return Yo.default.pki.setRsaPublicKey(...Sf(t,["n","e"]))}var If=U(Ae(),1);async function Af(t){let e=await tt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await Bf(e);return{privateKey:r[0],publicKey:r[1]}}async function Zo(t){let r=[await tt.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Qm(t)],n=await Bf({privateKey:r[0],publicKey:r[1]});return{privateKey:n[0],publicKey:n[1]}}async function _f(t,e){let r=await tt.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await tt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function Tf(t,e,r){let n=await tt.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await tt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,r)}async function Bf(t){if(t.privateKey==null||t.publicKey==null)throw(0,If.default)(new Error("Private and public key are required"),"ERR_INVALID_PARAMETERS");return await Promise.all([tt.get().subtle.exportKey("jwk",t.privateKey),tt.get().subtle.exportKey("jwk",t.publicKey)])}async function Qm(t){return await tt.get().subtle.importKey("jwk",{kty:t.kty,n:t.n,e:t.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Pf(t,e,r,n){let i=e?Cf(t):Df(t),s=W(Uint8Array.from(r),"ascii"),o=n(s,i);return oe(o,"ascii")}function Rf(t,e){return Pf(t,!0,e,(r,n)=>n.encrypt(r))}function Lf(t,e){return Pf(t,!1,e,(r,n)=>n.decrypt(r))}async function ln(t,e){let n=await Uo().encrypt(t,e);return Zr.encode(n)}var ti=class{constructor(e){this._key=e}async verify(e,r){return await Tf(this._key,r,e)}marshal(){return Rr.jwkToPkix(this._key)}get bytes(){return It.encode({Type:Ce.RSA,Data:this.marshal()}).subarray()}encrypt(e){return Rf(this._key,e)}equals(e){return De(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Me.digest(this.bytes);return e}},pn=class{constructor(e,r){this._key=e,this._publicKey=r}genSecret(){return Zt(16)}async sign(e){return await _f(this._key,e)}get public(){if(this._publicKey==null)throw(0,Qo.default)(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new ti(this._publicKey)}decrypt(e){return Lf(this._key,e)}marshal(){return Rr.jwkToPkcs1(this._key)}get bytes(){return At.encode({Type:Ce.RSA,Data:this.marshal()}).subarray()}equals(e){return De(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Me.digest(this.bytes);return e}async id(){let e=await this.public.hash();return W(e,"base58btc")}async export(e,r="pkcs-8"){if(r==="pkcs-8"){let n=new ei.default.util.ByteBuffer(this.marshal()),i=ei.default.asn1.fromDer(n),s=ei.default.pki.privateKeyFromAsn1(i),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return ei.default.pki.encryptRsaPrivateKey(s,e,o)}else{if(r==="libp2p-key")return await ln(this.bytes,e);throw(0,Qo.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}};async function Jm(t){let e=Rr.pkcs1ToJwk(t),r=await Zo(e);return new pn(r.privateKey,r.publicKey)}function e1(t){let e=Rr.pkixToJwk(t);return new ti(e)}async function t1(t){let e=await Zo(t);return new pn(e.privateKey,e.publicKey)}async function r1(t){let e=await Af(t);return new pn(e.privateKey,e.publicKey)}var aa={};qe(aa,{Ed25519PrivateKey:()=>Mr,Ed25519PublicKey:()=>oi,generateKeyPair:()=>m1,generateKeyPairFromSeed:()=>Yf,unmarshalEd25519PrivateKey:()=>g1,unmarshalEd25519PublicKey:()=>y1});var oa=U(Ae(),1);var Of=U(on(),1);var Ne=BigInt(0),Q=BigInt(1),Ze=BigInt(2),Ff=BigInt(255),Mf=Ze**BigInt(252)+BigInt("27742317777372353535851937790883648493"),be={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Ze**Ff-BigInt(19),l:Mf,n:Mf,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")};var Uf=Ze**BigInt(256),ri=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),YS=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),n1=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),i1=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),s1=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),o1=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Z=class{constructor(e,r,n,i){this.x=e,this.y=r,this.z=n,this.t=i}static fromAffine(e){if(!(e instanceof Ee))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Ee.ZERO)?Z.ZERO:new Z(e.x,e.y,Q,D(e.x*e.y))}static toAffineBatch(e){let r=u1(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(r[i]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){kf(e);let{x:r,y:n,z:i}=this,{x:s,y:o,z:a}=e,f=D(r*a),u=D(s*i),c=D(n*a),h=D(o*i);return f===u&&c===h}negate(){return new Z(D(-this.x),this.y,this.z,D(-this.t))}double(){let{x:e,y:r,z:n}=this,{a:i}=be,s=D(e**Ze),o=D(r**Ze),a=D(Ze*D(n**Ze)),f=D(i*s),u=D(D((e+r)**Ze)-s-o),c=f+o,h=c-a,l=f-o,d=D(u*h),p=D(c*l),g=D(u*l),m=D(h*c);return new Z(d,p,m,g)}add(e){kf(e);let{x:r,y:n,z:i,t:s}=this,{x:o,y:a,z:f,t:u}=e,c=D((n-r)*(a+o)),h=D((n+r)*(a-o)),l=D(h-c);if(l===Ne)return this.double();let d=D(i*Ze*u),p=D(s*Ze*f),g=p+d,m=h+c,v=p-d,E=D(g*l),I=D(m*v),T=D(g*v),x=D(l*m);return new Z(E,I,x,T)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let r=1+256/e,n=[],i=this,s=i;for(let o=0;o<r;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,r){!r&&this.equals(Z.BASE)&&(r=Ee.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=r&&ra.get(r);i||(i=this.precomputeWindow(n),r&&n!==1&&(i=Z.normalizeZ(i),ra.set(r,i)));let s=Z.ZERO,o=Z.ZERO,a=1+256/n,f=2**(n-1),u=BigInt(2**n-1),c=2**n,h=BigInt(n);for(let l=0;l<a;l++){let d=l*f,p=Number(e&u);if(e>>=h,p>f&&(p-=c,e+=Q),p===0){let g=i[d];l%2&&(g=g.negate()),o=o.add(g)}else{let g=i[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}}return Z.normalizeZ([s,o])[0]}multiply(e,r){return this.wNAF(ss(e,be.l),r)}multiplyUnsafe(e){let r=ss(e,be.l,!1),n=Z.BASE,i=Z.ZERO;if(r===Ne)return i;if(this.equals(i)||r===Q)return this;if(this.equals(n))return this.wNAF(r);let s=i,o=this;for(;r>Ne;)r&Q&&(s=s.add(o)),o=o.double(),r>>=Q;return s}isSmallOrder(){return this.multiplyUnsafe(be.h).equals(Z.ZERO)}isTorsionFree(){return this.multiplyUnsafe(be.l).equals(Z.ZERO)}toAffine(e=os(this.z)){let{x:r,y:n,z:i}=this,s=D(r*e),o=D(n*e);if(D(i*e)!==Q)throw new Error("invZ was invalid");return new Ee(s,o)}fromRistrettoBytes(){ea()}toRistrettoBytes(){ea()}fromRistrettoHash(){ea()}};Z.BASE=new Z(be.Gx,be.Gy,Q,D(be.Gx*be.Gy));Z.ZERO=new Z(Ne,Q,Q,Ne);function kf(t){if(!(t instanceof Z))throw new TypeError("ExtendedPoint expected")}function Jo(t){if(!(t instanceof rt))throw new TypeError("RistrettoPoint expected")}function ea(){throw new Error("Legacy method: switch to RistrettoPoint")}var rt=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:r}=be,n=D(ri*e*e),i=D((n+Q)*s1),s=BigInt(-1),o=D((s-r*n)*D(n+r)),{isValid:a,value:f}=ia(i,o),u=D(f*e);pr(u)||(u=D(-u)),a||(f=u),a||(s=n);let c=D(s*(n-Q)*o1-o),h=f*f,l=D((f+f)*o),d=D(c*n1),p=D(Q-h),g=D(Q+h);return new Z(D(l*g),D(p*d),D(d*g),D(l*p))}static hashToCurve(e){e=dr(e,64);let r=ta(e.slice(0,32)),n=this.calcElligatorRistrettoMap(r),i=ta(e.slice(32,64)),s=this.calcElligatorRistrettoMap(i);return new rt(n.add(s))}static fromHex(e){e=dr(e,32);let{a:r,d:n}=be,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=ta(e);if(!h1(ni(s),e)||pr(s))throw new Error(i);let o=D(s*s),a=D(Q+r*o),f=D(Q-r*o),u=D(a*a),c=D(f*f),h=D(r*n*u-c),{isValid:l,value:d}=Nf(D(h*c)),p=D(d*f),g=D(d*p*h),m=D((s+s)*p);pr(m)&&(m=D(-m));let v=D(a*g),E=D(m*v);if(!l||pr(E)||v===Ne)throw new Error(i);return new rt(new Z(m,v,Q,E))}toRawBytes(){let{x:e,y:r,z:n,t:i}=this.ep,s=D(D(n+r)*D(n-r)),o=D(e*r),{value:a}=Nf(D(s*o**Ze)),f=D(a*s),u=D(a*o),c=D(f*u*i),h;if(pr(i*c)){let d=D(r*ri),p=D(e*ri);e=d,r=p,h=D(f*i1)}else h=u;pr(e*c)&&(r=D(-r));let l=D((n-r)*h);return pr(l)&&(l=D(-l)),ni(l)}toHex(){return ii(this.toRawBytes())}toString(){return this.toHex()}equals(e){Jo(e);let r=this.ep,n=e.ep,i=D(r.x*n.y)===D(r.y*n.x),s=D(r.y*n.y)===D(r.x*n.x);return i||s}add(e){return Jo(e),new rt(this.ep.add(e.ep))}subtract(e){return Jo(e),new rt(this.ep.subtract(e.ep))}multiply(e){return new rt(this.ep.multiply(e))}multiplyUnsafe(e){return new rt(this.ep.multiplyUnsafe(e))}};rt.BASE=new rt(Z.BASE);rt.ZERO=new rt(Z.ZERO);var ra=new WeakMap,Ee=class{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,ra.delete(this)}static fromHex(e,r=!0){let{d:n,P:i}=be;e=dr(e,32);let s=e.slice();s[31]=e[31]&-129;let o=dn(s);if(r&&o>=i)throw new Error("Expected 0 < hex < P");if(!r&&o>=Uf)throw new Error("Expected 0 < hex < 2**256");let a=D(o*o),f=D(a-Q),u=D(n*a+Q),{isValid:c,value:h}=ia(f,u);if(!c)throw new Error("Point.fromHex: invalid y coordinate");let l=(h&Q)===Q;return(e[31]&128)!==0!==l&&(h=D(-h)),new Ee(h,o)}static async fromPrivateKey(e){return(await as(e)).point}toRawBytes(){let e=ni(this.y);return e[31]|=this.x&Q?128:0,e}toHex(){return ii(this.toRawBytes())}toX25519(){let{y:e}=this,r=D((Q+e)*os(Q-e));return ni(r)}isTorsionFree(){return Z.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Ee(D(-this.x),this.y)}add(e){return Z.fromAffine(this).add(Z.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Z.fromAffine(this).multiply(e,this).toAffine()}};Ee.BASE=new Ee(be.Gx,be.Gy);Ee.ZERO=new Ee(Ne,Q);var Lr=class{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromHex(e){let r=dr(e,64),n=Ee.fromHex(r.slice(0,32),!1),i=dn(r.slice(32,64));return new Lr(n,i)}assertValidity(){let{r:e,s:r}=this;if(!(e instanceof Ee))throw new Error("Expected Point instance");return ss(r,be.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(ni(this.s),32),e}toHex(){return ii(this.toRawBytes())}};function a1(...t){if(!t.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((n,i)=>n+i.length,0),r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){let s=t[n];r.set(s,i),i+=s.length}return r}var c1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ii(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=c1[t[r]];return e}function Kf(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,i=t.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[r]=s}return e}function Vf(t){let r=t.toString(16).padStart(64,"0");return Kf(r)}function ni(t){return Vf(t).reverse()}function pr(t){return(D(t)&Q)===Q}function dn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+ii(Uint8Array.from(t).reverse()))}function ta(t){return D(dn(t)&Ze**Ff-Q)}function D(t,e=be.P){let r=t%e;return r>=Ne?r:e+r}function os(t,e=be.P){if(t===Ne||e<=Ne)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=D(t,e),n=e,i=Ne,s=Q,o=Q,a=Ne;for(;r!==Ne;){let u=n/r,c=n%r,h=i-o*u,l=s-a*u;n=r,r=c,i=o,s=a,o=h,a=l}if(n!==Q)throw new Error("invert: does not exist");return D(i,e)}function u1(t,e=be.P){let r=new Array(t.length),n=t.reduce((s,o,a)=>o===Ne?s:(r[a]=s,D(s*o,e)),Q),i=os(n,e);return t.reduceRight((s,o,a)=>o===Ne?s:(r[a]=D(s*r[a],e),D(s*o,e)),i),r}function Nt(t,e){let{P:r}=be,n=t;for(;e-- >Ne;)n*=n,n%=r;return n}function f1(t){let{P:e}=be,r=BigInt(5),n=BigInt(10),i=BigInt(20),s=BigInt(40),o=BigInt(80),f=t*t%e*t%e,u=Nt(f,Ze)*f%e,c=Nt(u,Q)*t%e,h=Nt(c,r)*c%e,l=Nt(h,n)*h%e,d=Nt(l,i)*l%e,p=Nt(d,s)*d%e,g=Nt(p,o)*p%e,m=Nt(g,o)*p%e,v=Nt(m,n)*h%e;return{pow_p_5_8:Nt(v,Ze)*t%e,b2:f}}function ia(t,e){let r=D(e*e*e),n=D(r*r*e),i=f1(t*n).pow_p_5_8,s=D(t*r*i),o=D(e*s*s),a=s,f=D(s*ri),u=o===t,c=o===D(-t),h=o===D(-t*ri);return u&&(s=a),(c||h)&&(s=f),pr(s)&&(s=D(-s)),{isValid:u||c,value:s}}function Nf(t){return ia(Q,t)}async function na(...t){let e=await si.sha512(a1(...t)),r=dn(e);return D(r,be.l)}function h1(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function dr(t,e){let r=t instanceof Uint8Array?Uint8Array.from(t):Kf(t);if(typeof e=="number"&&r.length!==e)throw new Error(`Expected ${e} bytes`);return r}function ss(t,e,r=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(r){if(Ne<t)return t}else if(Ne<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function l1(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function as(t){if(t=typeof t=="bigint"||typeof t=="number"?Vf(ss(t,Uf)):dr(t),t.length!==32)throw new Error("Expected 32 bytes");let e=await si.sha512(t),r=l1(e.slice(0,32)),n=e.slice(32,64),i=D(dn(r),be.l),s=Ee.BASE.multiply(i),o=s.toRawBytes();return{head:r,prefix:n,scalar:i,point:s,pointBytes:o}}async function sa(t){return(await as(t)).pointBytes}async function zf(t,e){t=dr(t);let{prefix:r,scalar:n,pointBytes:i}=await as(e),s=await na(r,t),o=Ee.BASE.multiply(s),a=await na(o.toRawBytes(),i,t),f=D(s+a*n,be.l);return new Lr(o,f).toRawBytes()}async function qf(t,e,r){e=dr(e),r instanceof Ee||(r=Ee.fromHex(r,!1));let{r:n,s:i}=t instanceof Lr?t.assertValidity():Lr.fromHex(t),s=Z.BASE.multiplyUnsafe(i),o=await na(n.toRawBytes(),r.toRawBytes(),e),a=Z.fromAffine(r).multiplyUnsafe(o);return Z.fromAffine(n).add(a).subtract(s).multiplyUnsafe(be.h).equals(Z.ZERO)}Ee.BASE._setWindowSize(8);var lr={node:Of.default,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},si={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:ii,getExtendedPublicKey:as,mod:D,invert:os,hashToPrivateScalar:t=>{if(t=dr(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=D(dn(t),be.l);if(e===Ne||e===Q)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>{if(lr.web)return lr.web.getRandomValues(new Uint8Array(t));if(lr.node){let{randomBytes:e}=lr.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>si.randomBytes(32),sha512:async t=>{if(lr.web){let e=await lr.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}else{if(lr.node)return Uint8Array.from(lr.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=Ee.BASE){let r=e.equals(Ee.BASE)?e:new Ee(e.x,e.y);return r._setWindowSize(t),r.multiply(Ze),r}};var gn=32,Xt=64,cs=32;async function Gf(){let t=si.randomPrivateKey(),e=await sa(t);return{privateKey:jf(t,e),publicKey:e}}async function Hf(t){if(t.length!==cs)throw new TypeError('"seed" must be 32 bytes in length.');if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=t,r=await sa(e);return{privateKey:jf(e,r),publicKey:r}}async function Wf(t,e){let r=t.slice(0,cs);return await zf(e,r)}async function $f(t,e,r){return await qf(e,r,t)}function jf(t,e){let r=new Uint8Array(Xt);for(let n=0;n<cs;n++)r[n]=t[n],r[cs+n]=e[n];return r}var oi=class{constructor(e){this._key=yn(e,gn)}async verify(e,r){return await $f(this._key,r,e)}marshal(){return this._key}get bytes(){return It.encode({Type:Ce.Ed25519,Data:this.marshal()}).subarray()}equals(e){return De(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Me.digest(this.bytes);return e}},Mr=class{constructor(e,r){this._key=yn(e,Xt),this._publicKey=yn(r,gn)}async sign(e){return await Wf(this._key,e)}get public(){return new oi(this._publicKey)}marshal(){return this._key}get bytes(){return At.encode({Type:Ce.Ed25519,Data:this.marshal()}).subarray()}equals(e){return De(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Me.digest(this.bytes);return e}async id(){let e=await sr.digest(this.public.bytes);return _e.encode(e.bytes).substring(1)}async export(e,r="libp2p-key"){if(r==="libp2p-key")return await ln(this.bytes,e);throw(0,oa.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}};function g1(t){if(t.length>Xt){t=yn(t,Xt+gn);let n=t.slice(0,Xt),i=t.slice(Xt,t.length);return new Mr(n,i)}t=yn(t,Xt);let e=t.slice(0,Xt),r=t.slice(gn);return new Mr(e,r)}function y1(t){return t=yn(t,gn),new oi(t)}async function m1(){let{privateKey:t,publicKey:e}=await Gf();return new Mr(t,e)}async function Yf(t){let{privateKey:e,publicKey:r}=await Hf(t);return new Mr(e,r)}function yn(t,e){if(t=Uint8Array.from(t??[]),t.length!==e)throw(0,oa.default)(new Error(`Key must be a Uint8Array of length ${e}, got ${t.length}`),"ERR_INVALID_KEY_TYPE");return t}var ua={};qe(ua,{Secp256k1PrivateKey:()=>ci,Secp256k1PublicKey:()=>ai,generateKeyPair:()=>w1,unmarshalSecp256k1PrivateKey:()=>v1,unmarshalSecp256k1PublicKey:()=>x1});var rh=U(Ae(),1);var mn=U(Ae(),1);function Zf(){return Ye.randomPrivateKey()}async function Qf(t,e){let{digest:r}=await Me.digest(e);try{return await xf(r,t)}catch(n){throw(0,mn.default)(n,"ERR_INVALID_INPUT")}}async function Xf(t,e,r){try{let{digest:n}=await Me.digest(r);return wf(e,n,t)}catch(n){throw(0,mn.default)(n,"ERR_INVALID_INPUT")}}function Jf(t){return ne.fromHex(t).toRawBytes(!0)}function eh(t){try{$o(t,!0)}catch(e){throw(0,mn.default)(e,"ERR_INVALID_PRIVATE_KEY")}}function ca(t){try{ne.fromHex(t)}catch(e){throw(0,mn.default)(e,"ERR_INVALID_PUBLIC_KEY")}}function th(t){try{return $o(t,!0)}catch(e){throw(0,mn.default)(e,"ERR_INVALID_PRIVATE_KEY")}}var ai=class{constructor(e){ca(e),this._key=e}async verify(e,r){return await Xf(this._key,r,e)}marshal(){return Jf(this._key)}get bytes(){return It.encode({Type:Ce.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return De(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Me.digest(this.bytes);return e}},ci=class{constructor(e,r){this._key=e,this._publicKey=r??th(e),eh(this._key),ca(this._publicKey)}async sign(e){return await Qf(this._key,e)}get public(){return new ai(this._publicKey)}marshal(){return this._key}get bytes(){return At.encode({Type:Ce.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return De(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Me.digest(this.bytes);return e}async id(){let e=await this.public.hash();return W(e,"base58btc")}async export(e,r="libp2p-key"){if(r==="libp2p-key")return await ln(this.bytes,e);throw(0,rh.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}};function v1(t){return new ci(t)}function x1(t){return new ai(t)}async function w1(){let t=await Zf();return new ci(t)}var kr={rsa:Xo,ed25519:aa,secp256k1:ua};function ih(t){let e=Object.keys(kr).join(" / ");return(0,nh.default)(new Error(`invalid or unsupported key type ${t}. Must be ${e}`),"ERR_UNSUPPORTED_KEY_TYPE")}function ui(t){let e=It.decode(t),r=e.Data;switch(e.Type){case Ce.RSA:return kr.rsa.unmarshalRsaPublicKey(r);case Ce.Ed25519:return kr.ed25519.unmarshalEd25519PublicKey(r);case Ce.Secp256k1:return kr.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw ih(e.Type)}}async function us(t){let e=At.decode(t),r=e.Data;switch(e.Type){case Ce.RSA:return await kr.rsa.unmarshalRsaPrivateKey(r);case Ce.Ed25519:return kr.ed25519.unmarshalEd25519PrivateKey(r);case Ce.Secp256k1:return kr.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw ih(e.Type)}}var ds=U(fi(),1);var dh={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var mh=Symbol.for("@achingbrain/uint8arraylist");function gh(t,e,r){if(e==null||e<0||e>=r)throw new RangeError("index is out of bounds");let n=0;for(let i of t){let s=n+i.byteLength;if(e<s)return{buf:i,index:e-n};n=s}throw new RangeError("index is out of bounds")}function yh(t){return Boolean(t?.[mh])}var ve=class{constructor(...e){Object.defineProperty(this,mh,{value:!0}),this.bufs=[],this.length=0,this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let r=0;for(let n of e)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(yh(n))r+=n.length,this.bufs=this.bufs.concat(n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(e){let r=gh(this.bufs,e,this.length);return r.buf[r.index]}set(e,r){let n=gh(this.bufs,e,this.length);n.buf[n.index]=r}write(e,r=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(r+n,e[n]);else if(yh(e))for(let n=0;n<e.length;n++)this.set(r+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0))for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}slice(e,r){let{bufs:n,length:i}=this._subList(e,r);return he(n,i)}subarray(e,r){let{bufs:n}=this._subList(e,r),i=new ve;return i.appendAll(n),i}_subList(e,r){if(e==null&&r==null)return{bufs:this.bufs,length:this.length};if(e=e??0,r=r??(this.length>0?this.length:0),e<0&&(e=this.length+e),r<0&&(r=this.length+r),e<0||r>this.length)throw new RangeError("index out of bounds");if(e===r)return{bufs:[],length:0};let n=[],i=0;for(let s of this.bufs){let o=i,a=o+s.byteLength,f=e>=o&&e<a,u=r>o&&r<=a,c=e<o&&r>=a;i=a;let h,l;if(f&&(h=e-o,l=s.byteLength),u&&(l=r-o,h==null&&(h=0)),c&&(h=0,l=s.byteLength),h!=null&&l!=null&&n.push(s.subarray(h,l)),u)break}return{bufs:n,length:r-e}}getInt8(e){let r=this.slice(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(e,r){let n=new Uint8Array(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,e)}getInt16(e,r){let n=this.slice(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(e,r,n){let i=new Uint8Array(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,r,n),this.write(i,e)}getInt32(e,r){let n=this.slice(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(e,r,n){let i=new Uint8Array(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,r,n),this.write(i,e)}getBigInt64(e,r){let n=this.slice(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(e,r,n){let i=new Uint8Array(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,r,n),this.write(i,e)}getUint8(e){let r=this.slice(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(e,r){let n=new Uint8Array(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,e)}getUint16(e,r){let n=this.slice(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(e,r,n){let i=new Uint8Array(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,r,n),this.write(i,e)}getUint32(e,r){let n=this.slice(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(e,r,n){let i=new Uint8Array(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,r,n),this.write(i,e)}getBigUint64(e,r){let n=this.slice(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(e,r,n){let i=new Uint8Array(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,r,n),this.write(i,e)}getFloat32(e,r){let n=this.slice(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(e,r,n){let i=new Uint8Array(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,r,n),this.write(i,e)}getFloat64(e,r){let n=this.slice(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(e,r,n){let i=new Uint8Array(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,r,n),this.write(i,e)}};function Ot(t){return t instanceof Uint8Array?{get(e){return t[e]},set(e,r){t[e]=r}}:{get(e){return t.get(e)},set(e,r){t.set(e,r)}}}var bh=4294967296,Ve=class{constructor(e=0,r=0){this.hi=e,this.lo=r}toBigInt(e){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!==0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}zzDecode(){let e=-(this.lo&1),r=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Ve(n,r)}zzEncode(){let e=this.hi>>31,r=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Ve(r,n)}toBytes(e,r=0){let n=Ot(e);for(;this.hi>0;)n.set(r++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(r++,this.lo&127|128),this.lo=this.lo>>>7;n.set(r++,this.lo)}static fromBigInt(e){if(e===0n)return new Ve;let r=e<0;r&&(e=-e);let n=Number(e>>32n)|0,i=Number(e-(BigInt(n)<<32n))|0;return r&&(n=~n>>>0,i=~i>>>0,++i>bh&&(i=0,++n>bh&&(n=0))),new Ve(n,i)}static fromNumber(e){if(e===0)return new Ve;let r=e<0;r&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return r&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Ve(i,n)}static fromBytes(e,r){let n=Ot(e),i=new Ve,s=0;if(e.length-r>4){for(;s<4;++s)if(i.lo=(i.lo|(n.get(r)&127)<<s*7)>>>0,n.get(r++)<128)return i;if(i.lo=(i.lo|(n.get(r)&127)<<28)>>>0,i.hi=(i.hi|(n.get(r)&127)>>4)>>>0,n.get(r++)<128)return i;s=0}else{for(;s<3;++s){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(i.lo=(i.lo|(n.get(r)&127)<<s*7)>>>0,n.get(r++)<128)return i}return i.lo=(i.lo|(n.get(r++)&127)<<s*7)>>>0,i}if(e.length-r>4){for(;s<5;++s)if(i.hi=(i.hi|(n.get(r)&127)<<s*7+3)>>>0,n.get(r++)<128)return i}else for(;s<5;++s){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(i.hi=(i.hi|(n.get(r)&127)<<s*7+3)>>>0,n.get(r++)<128)return i}throw Error("invalid varint encoding")}};var vh=128,O1=127,F1=~O1,U1=Math.pow(2,31),K1=Math.pow(2,7),V1=Math.pow(2,14),z1=Math.pow(2,21),q1=Math.pow(2,28),G1=Math.pow(2,35),H1=Math.pow(2,42),W1=Math.pow(2,49),$1=Math.pow(2,56),j1=Math.pow(2,63),V={encodingLength(t){return t<K1?1:t<V1?2:t<z1?3:t<q1?4:t<G1?5:t<H1?6:t<W1?7:t<$1?8:t<j1?9:10},encode(t,e){let r=0,n=Ot(e);for(;t>=U1;)n.set(r++,t&255|vh),t/=128;for(;(t&F1)>0;)n.set(r++,t&255|vh),t>>>=7;n.set(r,t|0)},decode(t,e=0){let r=Ot(t),n=4294967295;if(n=(r.get(e)&127)>>>0,r.get(e++)<128||(n=(n|(r.get(e)&127)<<7)>>>0,r.get(e++)<128)||(n=(n|(r.get(e)&127)<<14)>>>0,r.get(e++)<128)||(n=(n|(r.get(e)&127)<<21)>>>0,r.get(e++)<128)||(n=(n|(r.get(e)&15)<<28)>>>0,r.get(e++)<128))return n;if((e+=5)>t.length)throw RangeError(`index out of range: ${e} > ${t.length}`);return n}},fs={encodingLength(t){return t<0?10:V.encodingLength(t)},encode(t,e){if(t<0){let r=0,n=Ot(e),i=Ve.fromNumber(t);for(;i.hi>0;)n.set(r++,i.lo&127|128),i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)n.set(r++,i.lo&127|128),i.lo=i.lo>>>7;n.set(r++,i.lo);return}V.encode(t,e)},decode(t,e=0){return V.decode(t,e)|0}},hs={encodingLength(t){return t=(t<<1^t>>31)>>>0,V.encodingLength(t)},encode(t,e,r=0){return t=(t<<1^t>>31)>>>0,V.encode(t,e)},decode(t,e=0){let r=V.decode(t,e);return r>>>1^-(r&1)|0}};function bn(t,e){let r=new Uint8Array(V.encodingLength(t.length));return V.encode(t.length,r),e.decode(new ve(r,t),0)}function vn(t,e){let r=e.encode(t),n=V.encodingLength(V.decode(r));return r.slice(n)}var H;(function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"})(H||(H={}));function ee(t,e,r,n,i){return{name:t,type:e,encode:r,decode:n,encodingLength:i}}var Y1=function(){return 1},Z1=function(e){return Uint8Array.from([e?1:0])},Q1=function(e,r){return e.get(r)>0},X1=ee("bool",H.VARINT,Z1,Q1,Y1);var J1=function(e){let r=e.byteLength;return V.encodingLength(r)+r},e2=function(e){let r=new Uint8Array(V.encodingLength(e.byteLength));return V.encode(e.byteLength,r),new ve(r,e)},t2=function(e,r){let n=V.decode(e,r);return r+=V.encodingLength(n),e.slice(r,r+n)},Jt=ee("bytes",H.LENGTH_DELIMITED,e2,t2,J1);var xh=function(){return 8},r2=function(e){let r=new ve(new Uint8Array(xh(e)));return r.setFloat64(0,e,!0),r},n2=function(e,r){return e.getFloat64(r,!0)},i2=ee("double",H.BIT64,r2,n2,xh);var wh=function(){return 4},s2=function(e){let r=new ve(new Uint8Array(wh(e)));return r.setInt32(0,e,!0),r},o2=function(e,r){return e.getInt32(r,!0)},a2=ee("fixed32",H.BIT32,s2,o2,wh);var Eh=function(e){return 8},c2=function(e){let r=new ve(new Uint8Array(Eh(e)));return r.setBigInt64(0,e,!0),r},u2=function(e,r){return e.getBigInt64(r,!0)},f2=ee("fixed64",H.BIT64,c2,u2,Eh);var Sh=function(){return 4},h2=function(e){let r=new ve(new Uint8Array(Sh(1)));return r.setFloat32(0,e,!0),r},l2=function(e,r){return e.getFloat32(r,!0)},p2=ee("float",H.BIT32,h2,l2,Sh);var Dh=function(e){return fs.encodingLength(e)},d2=function(e){let r=new Uint8Array(Dh(e));return fs.encode(e,r),r},g2=function(e,r){return fs.decode(e,r)},y2=ee("int32",H.VARINT,d2,g2,Dh);var Ch=0x7fn,gr={encodingLength(t){let e=0;for(;t>=0x80n;e++)t>>=7n;return e+1},encode(t,e){let r=Ot(e),n=0;for(;Ch<t;)r.set(n++,Number(t&Ch)|128),t>>=7n;r.set(n,Number(t))},decode(t,e=0){return Ve.fromBytes(t,e).toBigInt(!0)}},ls={encodingLength(t){return t<0n?10:gr.encodingLength(t)},encode(t,e,r=0){if(t<0n){Ve.fromBigInt(t).toBytes(e,r);return}return gr.encode(t,e)},decode(t,e=0){return Ve.fromBytes(t,e).toBigInt(!1)}},ps={encodingLength(t){return gr.encodingLength(t>=0?t*2n:t*-2n-1n)},encode(t,e,r=0){Ve.fromBigInt(t).zzEncode().toBytes(e,r)},decode(t,e=0){return Ve.fromBytes(t,e).zzDecode().toBigInt(!1)}};var Ih=function(e){return ls.encodingLength(e)},m2=function(e){let r=new Uint8Array(Ih(e));return ls.encode(e,r),r},b2=function(e,r){return ls.decode(e,r)|0n},v2=ee("int64",H.VARINT,m2,b2,Ih);function xn(t){let e=function(s){let o=0;for(let a of Object.values(t))o+=a.codec.encodingLength(s[a.name]);return V.encodingLength(o)+o},r=function(s){let o=new ve;function a(u,c,h){if(u==null){if(h.optional===!0)return;throw new Error(`Non optional field "${h.name}" was ${u===null?"null":"undefined"}`)}let l=c<<3|h.codec.type,d=new Uint8Array(V.encodingLength(l));V.encode(l,d);let p=h.codec.encode(u);o.append(d),o.append(p)}for(let[u,c]of Object.entries(t)){let h=parseInt(u);if(c.repeats===!0){if(!Array.isArray(s[c.name]))throw new Error(`Repeating field "${c.name}" was not an array`);for(let l of s[c.name])a(l,h,c)}else a(s[c.name],h,c)}let f=new Uint8Array(V.encodingLength(o.length));return V.encode(o.length,f),new ve(f,o)},n=function(s,o){let a=V.decode(s,o);o+=V.encodingLength(a);let f=o+a,u={};for(;o<f;){let c=V.decode(s,o);o+=V.encodingLength(c);let h=c&7,l=c>>3,d=t[l],p=0;if(h===H.VARINT)if(d!=null){let g=d.codec.decode(s,o);p=d.codec.encodingLength(g)}else{let g=V.decode(s,o);p=V.encodingLength(g)}else if(h===H.BIT64)p=8;else if(h===H.LENGTH_DELIMITED){let g=V.decode(s,o);p=g+V.encodingLength(g)}else if(h===H.BIT32)p=4;else{if(h===H.START_GROUP)throw new Error("Unsupported wire type START_GROUP");if(h===H.END_GROUP)throw new Error("Unsupported wire type END_GROUP")}if(d!=null){let g=d.codec.decode(s,o);d.repeats===!0?(u[d.name]==null&&(u[d.name]=[]),u[d.name].push(g)):u[d.name]=g}o+=p}for(let c of Object.values(t))c.repeats===!0&&u[c.name]==null&&(u[c.name]=[]);return u};return ee("message",H.LENGTH_DELIMITED,r,n,e)}var Ah=function(){return 4},x2=function(e){let r=new ve(new Uint8Array(Ah(e)));return r.setInt32(0,e,!0),r},w2=function(e,r){return e.getInt32(r,!0)},E2=ee("sfixed32",H.BIT32,x2,w2,Ah);var _h=function(){return 8},S2=function(e){let r=new ve(new Uint8Array(_h(e)));return r.setBigInt64(0,e,!0),r},D2=function(e,r){return e.getBigInt64(r,!0)},C2=ee("sfixed64",H.BIT64,S2,D2,_h);var Th=function(e){return hs.encodingLength(e)},I2=function(e){let r=new Uint8Array(Th(e));return hs.encode(e,r),r},A2=function(e,r){return hs.decode(e,r)},_2=ee("sint32",H.VARINT,I2,A2,Th);var Bh=function(e){return ps.encodingLength(e)},T2=function(e){let r=new Uint8Array(Bh(e));return ps.encode(e,r),r},B2=function(e,r){return ps.decode(e,r)},P2=ee("sint64",H.VARINT,T2,B2,Bh);var R2=function(e){let r=oe(e).byteLength;return V.encodingLength(r)+r},L2=function(e){let r=oe(e),n=new Uint8Array(V.encodingLength(r.byteLength));return V.encode(r.length,n),new ve(n,r)},M2=function(e,r){let n=V.decode(e,r);return r+=V.encodingLength(n),W(e.slice(r,r+n))},k2=ee("string",H.LENGTH_DELIMITED,L2,M2,R2);var Ph=function(e){return V.encodingLength(e)},N2=function(e){let r=new Uint8Array(Ph(e));return V.encode(e,r),r},O2=function(e,r){return V.decode(e,r)},F2=ee("uint32",H.VARINT,N2,O2,Ph);var U2=function(e){return gr.encodingLength(e)},K2=function(e){let r=new Uint8Array(gr.encodingLength(e));return gr.encode(e,r),r},V2=function(e,r){return gr.decode(e,r)},la=ee("uint64",H.VARINT,K2,V2,U2);var hi;(function(t){t.codec=()=>xn({1:{name:"publicKey",codec:Jt},2:{name:"payloadType",codec:Jt},3:{name:"payload",codec:Jt},5:{name:"signature",codec:Jt}}),t.encode=e=>vn(e,t.codec()),t.decode=e=>bn(e,t.codec())})(hi||(hi={}));var z2=U(Ae(),1);var Rh=Symbol.for("@libp2p/peer-id");var Lh=Object.values(en).map(t=>t.decoder).reduce((t,e)=>t.or(e),en.identity.decoder),Mh=114,pa=36,da=37,li=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[Rh](){return!0}toString(){return this.string==null&&(this.string=_e.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return le.createV1(Mh,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return De(this.multihash.bytes,e);if(typeof e=="string")return er(e).equals(this);if(e?.multihash?.bytes!=null)return De(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}},wn=class extends li{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},En=class extends li{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},Sn=class extends li{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function er(t,e){if(e=e??Lh,t.charAt(0)==="1"||t.charAt(0)==="Q"){let r=wr(_e.decode(`z${t}`));return t.startsWith("12D")?new En({multihash:r}):t.startsWith("16U")?new Sn({multihash:r}):new wn({multihash:r})}return Ft(Lh.decode(t))}function Ft(t){try{let e=wr(t);if(e.code===sr.code){if(e.digest.length===pa)return new En({multihash:e});if(e.digest.length===da)return new Sn({multihash:e})}if(e.code===Me.code)return new wn({multihash:e})}catch{return q2(le.decode(t))}throw new Error("Supplied PeerID CID is invalid")}function q2(t){if(t==null||t.multihash==null||t.version==null||t.version===1&&t.code!==Mh)throw new Error("Supplied PeerID CID is invalid");let e=t.multihash;if(e.code===Me.code)return new wn({multihash:t.multihash});if(e.code===sr.code){if(e.digest.length===pa)return new En({multihash:t.multihash});if(e.digest.length===da)return new Sn({multihash:t.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function kh(t,e){return t.length===pa?new En({multihash:Ct(sr.code,t),privateKey:e}):t.length===da?new Sn({multihash:Ct(sr.code,t),privateKey:e}):new wn({multihash:await Me.digest(t),publicKey:t,privateKey:e})}var G2,dt=class{constructor(e){let{peerId:r,payloadType:n,payload:i,signature:s}=e;this.peerId=r,this.payloadType=n,this.payload=i,this.signature=s}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=hi.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload,signature:this.signature})),this.marshaled}equals(e){return De(this.marshal(),e.marshal())}async validate(e){let r=Oh(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return await ui(this.peerId.publicKey).verify(r,this.signature)}};G2=dt;dt.createFromProtobuf=async t=>{let e=hi.decode(t),r=await kh(e.publicKey);return new dt({peerId:r,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};dt.seal=async(t,e)=>{let r=t.domain,n=t.codec,i=t.marshal(),s=Oh(r,n,i);if(e.privateKey==null)throw new Error("Missing private key");let a=await(await us(e.privateKey)).sign(s);return new dt({peerId:e,payloadType:n,payload:i,signature:a})};dt.openAndCertify=async(t,e)=>{let r=await dt.createFromProtobuf(t);if(!await r.validate(e))throw(0,Nh.default)(new Error("envelope signature is not valid for the given domain"),dh.ERR_SIGNATURE_NOT_VALID);return r};var Oh=(t,e,r)=>{let n=oe(t),i=ds.default.encode(n.byteLength),s=ds.default.encode(e.length),o=ds.default.encode(r.length);return he([new Uint8Array(i),n,new Uint8Array(s),e,new Uint8Array(o),r])};var Fh="[a-fA-F\\d:]",yr=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${Fh})|(?<=${Fh})(?=\\s|$))`:"",wt="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",ke="[a-fA-F\\d]{1,4}",gs=`
(?:
(?:${ke}:){7}(?:${ke}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${ke}:){6}(?:${wt}|:${ke}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${ke}:){5}(?::${wt}|(?::${ke}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${ke}:){4}(?:(?::${ke}){0,1}:${wt}|(?::${ke}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${ke}:){3}(?:(?::${ke}){0,2}:${wt}|(?::${ke}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${ke}:){2}(?:(?::${ke}){0,3}:${wt}|(?::${ke}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${ke}:){1}(?:(?::${ke}){0,4}:${wt}|(?::${ke}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${ke}){0,5}:${wt}|(?::${ke}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),H2=new RegExp(`(?:^${wt}$)|(?:^${gs}$)`),W2=new RegExp(`^${wt}$`),$2=new RegExp(`^${gs}$`),ga=t=>t&&t.exact?H2:new RegExp(`(?:${yr(t)}${wt}${yr(t)})|(?:${yr(t)}${gs}${yr(t)})`,"g");ga.v4=t=>t&&t.exact?W2:new RegExp(`${yr(t)}${wt}${yr(t)}`,"g");ga.v6=t=>t&&t.exact?$2:new RegExp(`${yr(t)}${gs}${yr(t)}`,"g");var ys=ga;function ms(t){return ys({exact:!0}).test(t)}function Uh(t){return ys.v6({exact:!0}).test(t)}function Kh(t){return ys.v4({exact:!0}).test(t)}var Vh=Kh,j2=Uh,ya=function(t){let e=0,r;if(Vh(t))r=new Uint8Array(e+4),t.split(/\./g).forEach(n=>{r[e++]=parseInt(n,10)&255});else if(j2(t)){let n=t.split(":",8),i;for(i=0;i<n.length;i++){let s=Vh(n[i]),o;s&&(o=ya(n[i]),n[i]=W(o.slice(0,2),"base16")),o!=null&&++i<8&&n.splice(i,0,W(o.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(i=0;i<n.length&&n[i]!=="";i++);let s=[i,1];for(i=9-n.length;i>0;i--)s.push("0");n.splice.apply(n,s)}for(r=new Uint8Array(e+16),i=0;i<n.length;i++){let s=parseInt(n[i],16);r[e++]=s>>8&255,r[e++]=s&255}}if(r==null)throw Error("Invalid ip address: "+t);return r},zh=function(t,e,r){e=~~e,r=r??t.length-e;let n=[],i="",s=new DataView(t.buffer);if(r===4){for(let o=0;o<r;o++)n.push(t[e+o]);i=n.join(".")}else if(r===16){for(let o=0;o<r;o+=2)n.push(s.getUint16(e+o).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var pi={},ma={},Z2=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Z2.forEach(t=>{let e=Q2(...t);ma[e.code]=e,pi[e.name]=e});function Q2(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}function ge(t){if(typeof t=="number"){if(ma[t]!=null)return ma[t];throw new Error(`no protocol with code: ${t}`)}else if(typeof t=="string"){if(pi[t]!=null)return pi[t];throw new Error(`no protocol with name: ${t}`)}throw new Error(`invalid protocol id type: ${typeof t}`)}var Nr=U(fi(),1);function Hh(t,e){switch(ge(t).code){case 4:case 41:return X2(e);case 6:case 273:case 33:case 132:return $h(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return eb(e);case 421:return rb(e);case 444:return Gh(e);case 445:return Gh(e);default:return W(e,"base16")}}function Wh(t,e){switch(ge(t).code){case 4:return qh(e);case 41:return qh(e);case 6:case 273:case 33:case 132:return ba(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return J2(e);case 421:return tb(e);case 444:return nb(e);case 445:return ib(e);default:return oe(e,"base16")}}function qh(t){if(!ms(t))throw new Error("invalid ip address");return ya(t)}function X2(t){let e=zh(t,0,t.length);if(e==null||!ms(e))throw new Error("invalid ip address");return e}function ba(t){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,t),new Uint8Array(e)}function $h(t){return new DataView(t.buffer).getUint16(t.byteOffset)}function J2(t){let e=oe(t),r=Uint8Array.from(Nr.default.encode(e.length));return he([r,e],r.length+e.length)}function eb(t){let e=Nr.default.decode(t);if(t=t.slice(Nr.default.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return W(t)}function tb(t){let e;t[0]==="Q"||t[0]==="1"?e=wr(_e.decode(`z${t}`)).bytes:e=le.parse(t).multihash.bytes;let r=Uint8Array.from(Nr.default.encode(e.length));return he([r,e],r.length+e.length)}function rb(t){let e=Nr.default.decode(t),r=t.slice(Nr.default.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return W(r,"base58btc")}function nb(t){let e=t.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let r=mt.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=ba(n);return he([r,i],r.length+i.length)}function ib(t){let e=t.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let r=mt.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=ba(n);return he([r,i],r.length+i.length)}function Gh(t){let e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=W(e,"base32"),i=$h(r);return`${n}:${i}`}var Dn=U(fi(),1);function sb(t){let e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){let i=r[n],s=ge(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Yh("invalid address: "+t);if(s.path===!0){e.push([i,Ea(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function ob(t){let e=[];return t.map(r=>{let n=xs(r);return e.push(n.name),r.length>1&&r[1]!=null&&e.push(r[1]),null}),Ea(e.join("/"))}function ab(t){return t.map(e=>{Array.isArray(e)||(e=[e]);let r=xs(e);return e.length>1?[r.code,Wh(r.code,e[1])]:[r.code]})}function va(t){return t.map(e=>{let r=xs(e);return e[1]!=null?[r.code,Hh(r.code,e[1])]:[r.code]})}function xa(t){return vs(he(t.map(e=>{let r=xs(e),n=Uint8Array.from(Dn.default.encode(r.code));return e.length>1&&e[1]!=null&&(n=he([n,e[1]])),n})))}function wa(t,e){return t.size>0?t.size/8:t.size===0?0:Dn.default.decode(e)+Dn.default.decode.bytes}function di(t){let e=[],r=0;for(;r<t.length;){let n=Dn.default.decode(t,r),i=Dn.default.decode.bytes,s=ge(n),o=wa(s,t.slice(r+i));if(o===0){e.push([n]),r+=i;continue}let a=t.slice(r+i,r+i+o);if(r+=o+i,r>t.length)throw Yh("Invalid address Uint8Array: "+W(t,"base16"));e.push([n,a])}return e}function bs(t){let e=di(t),r=va(e);return ob(r)}function cb(t){t=Ea(t);let e=sb(t),r=ab(e);return xa(r)}function jh(t){return cb(t)}function vs(t){let e=ub(t);if(e!=null)throw e;return Uint8Array.from(t)}function ub(t){try{di(t)}catch(e){return e}}function Ea(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Yh(t){return new Error("Error parsing address: "+t)}function xs(t){return ge(t[0])}var Sa=U(fi(),1);var Xh=U(Ae(),1);var hb=Symbol.for("nodejs.util.inspect.custom"),lb=[ge("ip4").code,ge("ip6").code],ws=[ge("dns").code,ge("dns4").code,ge("dns6").code,ge("dnsaddr").code],Zh=[ge("p2p").code,ge("ipfs").code],pb=[ge("tcp").code,ge("udp").code],Jh=new Map,Qh=Symbol.for("@multiformats/js-multiaddr/multiaddr"),nt=class{constructor(e){if(e==null&&(e=""),Object.defineProperty(this,Qh,{value:!0}),e instanceof Uint8Array)this.bytes=vs(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=jh(e)}else if(nt.isMultiaddr(e))this.bytes=vs(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return bs(this.bytes)}toJSON(){return this.toString()}toOptions(){let e=this.protoCodes(),r=this.toString().split("/").slice(1),n,i;if(r.length>2)ws.includes(e[0])&&Zh.includes(e[1])?(n=ge("tcp").name,i=443):(n=ge(r[2]).name,i=parseInt(r[3]));else if(ws.includes(e[0]))n=ge("tcp").name,i=443;else throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e[0]===41||e[0]===55?6:4,host:r[1],transport:n,port:i}}protos(){return this.protoCodes().map(e=>Object.assign({},ge(e)))}protoCodes(){let e=[],r=this.bytes,n=0;for(;n<r.length;){let i=Sa.default.decode(r,n),s=Sa.default.decode.bytes,o=ge(i);n+=wa(o,r.slice(n+s))+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return di(this.bytes)}stringTuples(){let e=di(this.bytes);return va(e)}encapsulate(e){return e=new nt(e),new nt(this.toString()+e.toString())}decapsulate(e){let r=e.toString(),n=this.toString(),i=n.lastIndexOf(r);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new nt(n.slice(0,i))}decapsulateCode(e){let r=this.tuples();for(let n=r.length-1;n>=0;n--)if(r[n][0]===e)return new nt(xa(r.slice(0,n)));return this}getPeerId(){try{let r=this.stringTuples().filter(n=>n[0]===pi.ipfs.code).pop();if(r?.[1]!=null){let n=r[1];return n[0]==="Q"||n[0]==="1"?W(_e.decode(`z${n}`),"base58btc"):W(le.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(r=>ge(r[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return De(this.bytes,e.bytes)}async resolve(e){let r=this.protos().find(s=>s.resolvable);if(r==null)return[this];let n=Jh.get(r.name);if(n==null)throw(0,Xh.default)(new Error(`no available resolver for ${r.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(s=>new nt(s))}nodeAddress(){let e=this.protoCodes(),r=this.protoNames(),n=this.toString().split("/").slice(1),i=ge(n[2]).code,s=parseInt(n[3]);if(ws.includes(e[0])&&Zh.includes(e[1])&&(i=ge("tcp").code,s=443),n.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');if(!lb.includes(e[0])&&!ws.includes(e[0]))throw new Error(`no protocol with name: "'${r[0]}'". Must have a valid family name: "{ip4, ip6, dns, dns4, dns6, dnsaddr}".`);if(!pb.includes(i))throw new Error(`no protocol with name: "'${r[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:e[0]===41||e[0]===55?6:4,address:n[1],port:s}}isThinWaistAddress(e){let r=(e??this).protos();return!(r.length!==2||r[0].code!==4&&r[0].code!==41||r[1].code!==6&&r[1].code!==273)}static fromNodeAddress(e,r){if(e==null)throw new Error("requires node address object");if(r==null)throw new Error("requires transport protocol");let n;switch(e.family){case 4:n="ip4";break;case 6:n="ip6";break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new nt("/"+[n,e.address,r,e.port].join("/"))}static isName(e){return nt.isMultiaddr(e)?e.protos().some(r=>r.resolvable):!1}static isMultiaddr(e){return Boolean(e?.[Qh])}[hb](){return"<Multiaddr "+W(this.bytes,"base16")+" - "+bs(this.bytes)+">"}inspect(){return"<Multiaddr "+W(this.bytes,"base16")+" - "+bs(this.bytes)+">"}};nt.resolvers=Jh;function e0(t,e){let r=(n,i)=>n.toString().localeCompare(i.toString());return t.length===e.length&&e.sort(r)&&t.sort(r).every((n,i)=>e[i].equals(n))}var gi;(function(t){let e;(function(r){r.codec=()=>xn({1:{name:"multiaddr",codec:Jt}}),r.encode=n=>vn(n,r.codec()),r.decode=n=>bn(n,r.codec())})(e=t.AddressInfo||(t.AddressInfo={})),t.codec=()=>xn({1:{name:"peerId",codec:Jt},2:{name:"seq",codec:la},3:{name:"addresses",codec:t.AddressInfo.codec(),repeats:!0}}),t.encode=r=>vn(r,t.codec()),t.decode=r=>bn(r,t.codec())})(gi||(gi={}));var t0="libp2p-peer-record",r0=Uint8Array.from([3,1]);var Et=class{constructor(e){this.domain=Et.DOMAIN,this.codec=Et.CODEC;let{peerId:r,multiaddrs:n,seqNumber:i}=e;this.peerId=r,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=gi.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Et)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!e0(this.multiaddrs,e.multiaddrs))}};Et.createFromProtobuf=t=>{let e=gi.decode(t),r=Ft(e.peerId),n=(e.addresses??[]).map(s=>new nt(s.multiaddr)),i=e.seq;return new Et({peerId:r,multiaddrs:n,seqNumber:i})};Et.DOMAIN=t0;Et.CODEC=r0;var Ut=U(a0(),1);Ut.default.formatters.b=t=>t==null?"undefined":_e.baseEncode(t);Ut.default.formatters.t=t=>t==null?"undefined":mt.baseEncode(t);Ut.default.formatters.m=t=>t==null?"undefined":Zr.baseEncode(t);Ut.default.formatters.p=t=>t==null?"undefined":t.toString();Ut.default.formatters.c=t=>t==null?"undefined":t.toString();Ut.default.formatters.k=t=>t==null?"undefined":t.toString();function Ds(t){return Object.assign((0,Ut.default)(t),{error:(0,Ut.default)(`${t}:error`),trace:(0,Ut.default)(`${t}:trace`)})}var Da=Symbol.for("@libp2p/topology");var c0=()=>{},Ca=class{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??c0,this.onDisconnect=e.onDisconnect??c0}get[Symbol.toStringTag](){return Da.toString()}get[Da](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function u0(t){return new Ca(t)}var Fr=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},tr,Cs=class extends EventTarget{constructor(){super(...arguments),tr.set(this,new Map)}listenerCount(e){let r=Fr(this,tr,"f").get(e);return r==null?0:r.length}addEventListener(e,r,n){super.addEventListener(e,r,n);let i=Fr(this,tr,"f").get(e);i==null&&(i=[],Fr(this,tr,"f").set(e,i)),i.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,r,n){super.removeEventListener(e.toString(),r??null,n);let i=Fr(this,tr,"f").get(e);i!=null&&(i=i.filter(({callback:s})=>s!==r),Fr(this,tr,"f").set(e,i))}dispatchEvent(e){let r=super.dispatchEvent(e),n=Fr(this,tr,"f").get(e.type);return n==null||(n=n.filter(({once:i})=>!i),Fr(this,tr,"f").set(e.type,n)),r}};tr=new WeakMap;var Ia=class extends Event{constructor(e,r){super(e,r),this.detail=r?.detail}},Ur=globalThis.CustomEvent??Ia;var Is=class{constructor(e,r,n){this.gossip=e,this.msgs=new Map,this.history=[],this.msgIdToStrFn=n;for(let i=0;i<r;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,r,n=!1){let{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:r,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:r.topic}),!0)}observeDuplicate(e,r){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(r)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,r){let n=this.msgs.get(e);if(!n)return null;let i=(n.iwantCounts.get(r)??0)+1;return n.iwantCounts.set(r,i),{msg:n.message,count:i}}getGossipIDs(e){let r=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{let s=this.msgs.get(i.msgIdStr);if(s&&s.validated&&e.has(i.topic)){let o=r.get(i.topic);o||(o=[],r.set(i.topic,o)),o.push(i.msgId)}});return r}validate(e){let r=this.msgs.get(e);if(!r)return null;let{message:n,originatingPeers:i}=r;return r.validated=!0,r.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(r=>{this.msgs.delete(r.msgIdStr)}),this.history.pop(),this.history.unshift([])}remove(e){let r=this.msgs.get(e);return r?(this.msgs.delete(e),r):null}};var ul=U(cl(),1),{RPC:Tn}=ul.default;var Ka="/floodsub/1.0.0",Va="/meshsub/1.0.0",Ps="/meshsub/1.1.0";var fl="ERR_TOPIC_VALIDATOR_REJECT",hl="ERR_TOPIC_VALIDATOR_IGNORE";function zt(t=[],e){return{subscriptions:[],messages:t,control:e?{graft:e.graft||[],prune:e.prune||[],ihave:e.ihave||[],iwant:e.iwant||[]}:void 0}}function qt(t){if(t.length<=1)return t;let e=()=>Math.floor(Math.random()*Math.floor(t.length));for(let r=0;r<t.length;r++){let n=e(),i=t[r];t[r]=t[n],t[n]=i}return t}function ll(t){return W(t,"base64")}var zr="StrictSign",Bn="StrictNoSign";var pl;(function(t){t.StrictSign="StrictSign",t.StrictNoSign="StrictNoSign"})(pl||(pl={}));var rr;(function(t){t[t.Signing=0]="Signing",t[t.Author=1]="Author",t[t.Anonymous=2]="Anonymous"})(rr||(rr={}));var Gt;(function(t){t.Accept="accept",t.Ignore="ignore",t.Reject="reject"})(Gt||(Gt={}));var Qe;(function(t){t.Error="error",t.Ignore="ignore",t.Reject="reject",t.Blacklisted="blacklisted"})(Qe||(Qe={}));var Ge;(function(t){t.InvalidSignature="invalid_signature",t.InvalidSeqno="invalid_seqno",t.InvalidPeerId="invalid_peerid",t.SignaturePresent="signature_present",t.SeqnoPresent="seqno_present",t.FromPresent="from_present",t.TransformFailed="transform_failed"})(Ge||(Ge={}));var yt;(function(t){t.duplicate="duplicate",t.invalid="invalid",t.valid="valid"})(yt||(yt={}));function za(t){switch(t){case Gt.Ignore:return Qe.Ignore;case Gt.Reject:return Qe.Reject}}async function qa(t,e){switch(t){case zr:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let r=await us(e.privateKey);return{type:rr.Signing,author:e,key:e.publicKey,privateKey:r}}case Bn:return{type:rr.Anonymous};default:throw new Error(`Unknown signature policy "${t}"`)}}var ce="ERR_INVALID_PEER_SCORE_PARAMS";var ue=U(Ae(),1),Nb={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},Ob={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function dl(t={}){return{...Nb,...t,topics:t.topics?Object.entries(t.topics).reduce((e,[r,n])=>(e[r]=Fb(n),e),{}):{}}}function Fb(t={}){return{...Ob,...t}}function gl(t){for(let[e,r]of Object.entries(t.topics))try{Ub(r)}catch(n){throw(0,ue.default)(new Error(`invalid score parameters for topic ${e}: ${n.message}`),ce)}if(t.topicScoreCap<0)throw(0,ue.default)(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),ce);if(t.appSpecificScore===null||t.appSpecificScore===void 0)throw(0,ue.default)(new Error("missing application specific score function"),ce);if(t.IPColocationFactorWeight>0)throw(0,ue.default)(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),ce);if(t.IPColocationFactorWeight!==0&&t.IPColocationFactorThreshold<1)throw(0,ue.default)(new Error("invalid IPColocationFactorThreshold; must be at least 1"),ce);if(t.behaviourPenaltyWeight>0)throw(0,ue.default)(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),ce);if(t.behaviourPenaltyWeight!==0&&(t.behaviourPenaltyDecay<=0||t.behaviourPenaltyDecay>=1))throw(0,ue.default)(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),ce);if(t.decayInterval<1e3)throw(0,ue.default)(new Error("invalid DecayInterval; must be at least 1s"),ce);if(t.decayToZero<=0||t.decayToZero>=1)throw(0,ue.default)(new Error("invalid DecayToZero; must be between 0 and 1"),ce)}function Ub(t){if(t.topicWeight<0)throw(0,ue.default)(new Error("invalid topic weight; must be >= 0"),ce);if(t.timeInMeshQuantum===0)throw(0,ue.default)(new Error("invalid TimeInMeshQuantum; must be non zero"),ce);if(t.timeInMeshWeight<0)throw(0,ue.default)(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),ce);if(t.timeInMeshWeight!==0&&t.timeInMeshQuantum<=0)throw(0,ue.default)(new Error("invalid TimeInMeshQuantum; must be positive"),ce);if(t.timeInMeshWeight!==0&&t.timeInMeshCap<=0)throw(0,ue.default)(new Error("invalid TimeInMeshCap; must be positive"),ce);if(t.firstMessageDeliveriesWeight<0)throw(0,ue.default)(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),ce);if(t.firstMessageDeliveriesWeight!==0&&(t.firstMessageDeliveriesDecay<=0||t.firstMessageDeliveriesDecay>=1))throw(0,ue.default)(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),ce);if(t.firstMessageDeliveriesWeight!==0&&t.firstMessageDeliveriesCap<=0)throw(0,ue.default)(new Error("invalid FirstMessageDeliveriesCap; must be positive"),ce);if(t.meshMessageDeliveriesWeight>0)throw(0,ue.default)(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),ce);if(t.meshMessageDeliveriesWeight!==0&&(t.meshMessageDeliveriesDecay<=0||t.meshMessageDeliveriesDecay>=1))throw(0,ue.default)(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),ce);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesCap<=0)throw(0,ue.default)(new Error("invalid MeshMessageDeliveriesCap; must be positive"),ce);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesThreshold<=0)throw(0,ue.default)(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),ce);if(t.meshMessageDeliveriesWindow<0)throw(0,ue.default)(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),ce);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesActivation<1e3)throw(0,ue.default)(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),ce);if(t.meshFailurePenaltyWeight>0)throw(0,ue.default)(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),ce);if(t.meshFailurePenaltyWeight!==0&&(t.meshFailurePenaltyDecay<=0||t.meshFailurePenaltyDecay>=1))throw(0,ue.default)(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),ce);if(t.invalidMessageDeliveriesWeight>0)throw(0,ue.default)(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),ce);if(t.invalidMessageDeliveriesDecay<=0||t.invalidMessageDeliveriesDecay>=1)throw(0,ue.default)(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),ce)}var Kb=U(Ae(),1),Vb={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function yl(t={}){return{...Vb,...t}}function ml(t,e,r,n){let i=0;if(Object.entries(e.topics).forEach(([o,a])=>{let f=r.topics[o];if(f===void 0)return;let u=0;if(a.inMesh){let d=a.meshTime/f.timeInMeshQuantum;d>f.timeInMeshCap&&(d=f.timeInMeshCap),u+=d*f.timeInMeshWeight}let c=a.firstMessageDeliveries;if(c>f.firstMessageDeliveriesCap&&(c=f.firstMessageDeliveriesCap),u+=c*f.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<f.meshMessageDeliveriesThreshold){let d=f.meshMessageDeliveriesThreshold-a.meshMessageDeliveries;u+=d*d*f.meshMessageDeliveriesWeight}u+=a.meshFailurePenalty*f.meshFailurePenaltyWeight,u+=a.invalidMessageDeliveries*a.invalidMessageDeliveries*f.invalidMessageDeliveriesWeight,i+=u*f.topicWeight}),r.topicScoreCap>0&&i>r.topicScoreCap&&(i=r.topicScoreCap),i+=r.appSpecificScore(t)*r.appSpecificWeight,e.ips.forEach(o=>{if(r.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),f=a?a.size:0;if(f>r.IPColocationFactorThreshold){let u=f-r.IPColocationFactorThreshold;i+=u*u*r.IPColocationFactorWeight}}),e.behaviourPenalty>r.behaviourPenaltyThreshold){let o=e.behaviourPenalty-r.behaviourPenaltyThreshold;i+=o*o*r.behaviourPenaltyWeight}return i}var xl=U(vl(),1),Xe;(function(t){t[t.unknown=0]="unknown",t[t.valid=1]="valid",t[t.invalid=2]="invalid",t[t.ignored=3]="ignored"})(Xe||(Xe={}));var Rs=class{constructor(){this.records=new Map,this.queue=new xl.default}ensureRecord(e){let r=this.records.get(e);if(r)return r;r={status:Xe.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,r);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),r}gc(){let e=Date.now(),r=this.queue.peekFront();for(;r&&r.expire<e;)this.records.delete(r.msgId),this.queue.shift(),r=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};var ot=U(Ae(),1);function qr(t){return t!=null&&typeof t.start=="function"&&typeof t.stop=="function"}function st(t){return t!=null&&typeof t.init=="function"}var Pn=class{constructor(e={}){this.started=!1,e.peerId!=null&&this.setPeerId(e.peerId),e.addressManager!=null&&this.setAddressManager(e.addressManager),e.peerStore!=null&&this.setPeerStore(e.peerStore),e.upgrader!=null&&this.setUpgrader(e.upgrader),e.metrics!=null&&this.setMetrics(e.metrics),e.registrar!=null&&this.setRegistrar(e.registrar),e.connectionManager!=null&&this.setConnectionManager(e.connectionManager),e.transportManager!=null&&this.setTransportManager(e.transportManager),e.connectionGater!=null&&this.setConnectionGater(e.connectionGater),e.contentRouting!=null&&this.setContentRouting(e.contentRouting),e.peerRouting!=null&&this.setPeerRouting(e.peerRouting),e.datastore!=null&&this.setDatastore(e.datastore),e.connectionProtector!=null&&this.setConnectionProtector(e.connectionProtector),e.dht!=null&&this.setDHT(e.dht),e.pubsub!=null&&this.setPubSub(e.pubsub)}isStarted(){return this.started}async beforeStart(){await Promise.all(Object.values(this).filter(e=>qr(e)).map(async e=>{e.beforeStart!=null&&await e.beforeStart()}))}async start(){await Promise.all(Object.values(this).filter(e=>qr(e)).map(async e=>{await e.start()})),this.started=!0}async afterStart(){await Promise.all(Object.values(this).filter(e=>qr(e)).map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async beforeStop(){await Promise.all(Object.values(this).filter(e=>qr(e)).map(async e=>{e.beforeStop!=null&&await e.beforeStop()}))}async stop(){await Promise.all(Object.values(this).filter(e=>qr(e)).map(async e=>{await e.stop()})),this.started=!1}async afterStop(){await Promise.all(Object.values(this).filter(e=>qr(e)).map(async e=>{e.afterStop!=null&&await e.afterStop()}))}setPeerId(e){return this.peerId=e,e}getPeerId(){if(this.peerId==null)throw(0,ot.default)(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this.peerId}setMetrics(e){return this.metrics=e,st(e)&&e.init(this),e}getMetrics(){return this.metrics}setAddressManager(e){return this.addressManager=e,st(e)&&e.init(this),e}getAddressManager(){if(this.addressManager==null)throw(0,ot.default)(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this.addressManager}setPeerStore(e){return this.peerStore=e,st(e)&&e.init(this),e}getPeerStore(){if(this.peerStore==null)throw(0,ot.default)(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this.peerStore}setUpgrader(e){return this.upgrader=e,st(e)&&e.init(this),e}getUpgrader(){if(this.upgrader==null)throw(0,ot.default)(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this.upgrader}setRegistrar(e){return this.registrar=e,st(e)&&e.init(this),e}getRegistrar(){if(this.registrar==null)throw(0,ot.default)(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this.registrar}setConnectionManager(e){return this.connectionManager=e,st(e)&&e.init(this),e}getConnectionManager(){if(this.connectionManager==null)throw(0,ot.default)(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this.connectionManager}setTransportManager(e){return this.transportManager=e,st(e)&&e.init(this),e}getTransportManager(){if(this.transportManager==null)throw(0,ot.default)(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this.transportManager}setConnectionGater(e){return this.connectionGater=e,st(e)&&e.init(this),e}getConnectionGater(){if(this.connectionGater==null)throw(0,ot.default)(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this.connectionGater}setContentRouting(e){return this.contentRouting=e,st(e)&&e.init(this),e}getContentRouting(){if(this.contentRouting==null)throw(0,ot.default)(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this.contentRouting}setPeerRouting(e){return this.peerRouting=e,st(e)&&e.init(this),e}getPeerRouting(){if(this.peerRouting==null)throw(0,ot.default)(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this.peerRouting}setDatastore(e){return this.datastore=e,st(e)&&e.init(this),e}getDatastore(){if(this.datastore==null)throw(0,ot.default)(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this.datastore}setConnectionProtector(e){return this.connectionProtector=e,st(e)&&e.init(this),e}getConnectionProtector(){return this.connectionProtector}setDHT(e){return this.dht=e,st(e)&&e.init(this),e}getDHT(){if(this.dht==null)throw(0,ot.default)(new Error("dht not set"),"ERR_SERVICE_MISSING");return this.dht}setPubSub(e){return this.pubsub=e,st(e)&&e.init(this),e}getPubSub(){if(this.pubsub==null)throw(0,ot.default)(new Error("pubsub not set"),"ERR_SERVICE_MISSING");return this.pubsub}};var Rn=Ds("libp2p:gossipsub:score"),Ls=class{constructor(e,r,n){this.params=e,this.metrics=r,this.peerStats=new Map,this.peerIPs=new Map,this.scoreCache=new Map,this.deliveryRecords=new Rs,this.components=new Pn,gl(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??ml}init(e){this.components=e}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){Rn("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),Rn("started")}stop(){if(!this._backgroundInterval){Rn("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),Rn("stopped")}background(){this.refreshScores(),this.updateIPs(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,r])=>[e,r]))}refreshScores(){let e=Date.now(),r=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPs(i,n.ips),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{let a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<r&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<r&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<r&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<r&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<r&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let r=this.peerStats.get(e);if(!r)return 0;let n=Date.now(),i=this.scoreCache.get(e);if(i&&i.cacheUntil>n)return i.score;this.metrics?.scoreFnRuns.inc();let s=this.computeScore(e,r,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,r,n){let i=this.peerStats.get(e);i&&(i.behaviourPenalty+=r,this.metrics?.onScorePenalty(n))}addPeer(e){let r={connected:!0,expire:0,topics:{},ips:[],behaviourPenalty:0};this.peerStats.set(e,r);let n=this.getIPs(e);this.setIPs(e,n,r.ips),r.ips=n}removePeer(e){let r=this.peerStats.get(e);if(!!r){if(this.score(e)>0){this.removeIPs(e,r.ips),this.peerStats.delete(e);return}Object.entries(r.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;let s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),r.connected=!1,r.expire=Date.now()+this.params.retainScore}}graft(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);i&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);if(i){let s=this.params.topics[r].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,r,n){this.markFirstMessageDelivery(e,n);let i=this.deliveryRecords.ensureRecord(r),s=Date.now();if(i.status!==Xe.unknown){Rn("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-i.firstSeen,Xe[i.status]);return}i.status=Xe.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,r){this.markInvalidMessageDelivery(e,r)}rejectMessage(e,r,n,i){switch(i){case Qe.Error:this.markInvalidMessageDelivery(e,n);return;case Qe.Blacklisted:return}let s=this.deliveryRecords.ensureRecord(r);if(s.status!==Xe.unknown){Rn("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,Xe[s.status]);return}if(i===Qe.Ignore){s.status=Xe.ignored,s.peers.clear();return}s.status=Xe.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,r,n){let i=this.deliveryRecords.ensureRecord(r);if(!i.peers.has(e))switch(i.status){case Xe.unknown:i.peers.add(e);break;case Xe.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case Xe.invalid:this.markInvalidMessageDelivery(e,n);break;case Xe.ignored:break}}markInvalidMessageDelivery(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);i&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);if(i){let s=this.params.topics[r].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[r].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,r,n){let i=this.peerStats.get(e);if(i){let s=n!==void 0?Date.now():0,o=this.getPtopicStats(i,r);if(o&&o.inMesh){let a=this.params.topics[r];if(n!==void 0){let u=s-n,c=u>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(r,u,c),c)return}let f=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(f,o.meshMessageDeliveries+1)}}}getIPs(e){return this.components.getConnectionManager().getConnections(er(e)).map(r=>r.remoteAddr.toOptions().host)}setIPs(e,r,n){e:for(let i of r){for(let o of n)if(i===o)continue e;let s=this.peerIPs.get(i);s||(s=new Set,this.peerIPs.set(i,s)),s.add(e)}e:for(let i of n){for(let o of r)if(i===o)continue e;let s=this.peerIPs.get(i);!s||(s.delete(e),s.size||this.peerIPs.delete(i))}}removeIPs(e,r){r.forEach(n=>{let i=this.peerIPs.get(n);!i||(i.delete(e),i.size||this.peerIPs.delete(n))})}updateIPs(){this.peerStats.forEach((e,r)=>{let n=this.getIPs(r);this.setIPs(r,n,e.ips),e.ips=n})}getPtopicStats(e,r){let n=e.topics[r];return n!==void 0?n:this.params.topics[r]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[r]=n,n):null}};var Ms=class{constructor(e,r,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=r,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,r){let n=Math.floor(Math.random()*r.length),i=r[n],s=this.msgIdToStrFn(i),o=this.promises.get(s);o||(o=new Map,this.promises.set(s,o));let a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){let e=Date.now(),r=new Map,n=0;return this.promises.forEach((i,s)=>{i.forEach((o,a)=>{o<e&&(r.set(a,(r.get(a)??0)+1),i.delete(a),n++)}),i.size||this.promises.delete(s)}),this.metrics?.iwantPromiseBroken.inc(n),r}deliverMessage(e){this.trackMessage(e);let r=this.promises.get(e);r&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,r){switch(this.trackMessage(e),r){case Qe.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire;for(let[r,n]of this.requestMsByMsg.entries())if(n<e)this.requestMsByMsg.delete(r);else break}trackMessage(e){if(this.metrics){let r=this.requestMsByMsg.get(e);r!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-r)/1e3),this.requestMsByMsg.delete(e))}}};var Ln=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,r){this.entries.set(e,{value:r,validUntilMs:Date.now()+this.validityMs})}prune(){let e=Date.now();for(let[r,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(r);else break}has(e){return this.entries.has(e)}get(e){let r=this.entries.get(e);return r&&r.validUntilMs>=Date.now()?r.value:void 0}clear(){this.entries.clear()}};var wl;(function(t){t.forward="forward",t.publish="publish"})(wl||(wl={}));var nr;(function(t){t.Fanout="fanout",t.Random="random",t.Subscribed="subscribed",t.Outbound="outbound",t.NotEnough="not_enough",t.Opportunistic="opportunistic"})(nr||(nr={}));var Gr;(function(t){t.Dc="disconnected",t.BadScore="bad_score",t.Prune="prune",t.Unsub="unsubscribed",t.Excess="excess"})(Gr||(Gr={}));var kn;(function(t){t.GraftBackoff="graft_backoff",t.BrokenPromise="broken_promise",t.MessageDeficit="message_deficit",t.IPColocation="IP_colocation"})(kn||(kn={}));var Nn;(function(t){t.LowScore="low_score",t.MaxIhave="max_ihave",t.MaxIasked="max_iasked"})(Nn||(Nn={}));var Mn;(function(t){t.graylist="graylist",t.publish="publish",t.gossip="gossip",t.mesh="mesh"})(Mn||(Mn={}));function El(t,e,r){return{protocolsEnabled:t.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:t.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:t.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:t.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:t.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:t.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:t.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:t.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:t.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:t.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:t.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:t.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:t.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:t.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:t.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:t.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:t.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:t.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:t.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:t.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:t.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:t.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:t.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:t.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:t.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:t.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:t.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:t.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:t.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:t.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:t.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:t.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:t.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:t.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:t.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:t.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:t.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:t.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:t.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:t.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),scoreFnCalls:t.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:t.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:t.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:t.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:t.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:t.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:t.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:t.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:t.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:t.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:t.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:t.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:t.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:t.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:t.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedPeers:t.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:t.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantPromiseDeliveryTime:t.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),cacheSize:t.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:t.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){let o=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:o,reason:i},s)},onRemoveFromMesh(n,i,s){let o=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:o,reason:i},s)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,i){let s=this.toTopic(n);this.asyncValidationResult.inc({topic:s,acceptance:i})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(let[s,o]of n){let a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){let s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},s*o),this.msgPublishPeers.inc({topic:a},s),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},i.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},i.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},i.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},i.fanout)},onMsgRecvPreValidation(n){let i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvResult(n,i){let s=this.toTopic(n);this.msgReceivedStatus.inc({topic:s,status:i})},onMsgRecvInvalid(n,i){let s=this.toTopic(n),o=i.reason===Qe.Error?i.error:i.reason;this.msgReceivedInvalid.inc({topic:s,error:o},1)},onDuplicateMsgDelivery(n,i,s){if(this.duplicateMsgDeliveryDelay.observe(i/1e3),s){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){let s=n.control.ihave?.length??0,o=n.control.iwant?.length??0,a=n.control.graft?.length??0,f=n.control.prune?.length??0;s>0&&this.rpcSentIHave.inc(s),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),f>0&&this.rpcSentPrune.inc(f),(s>0||o>0||a>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,f=0;for(let u of n)u>=i.graylistThreshold&&s++,u>=i.publishThreshold&&o++,u>=i.gossipThreshold&&a++,u>=0&&f++;this.peersByScoreThreshold.set({threshold:Mn.graylist},s),this.peersByScoreThreshold.set({threshold:Mn.publish},o),this.peersByScoreThreshold.set({threshold:Mn.gossip},a),this.peersByScoreThreshold.set({threshold:Mn.mesh},f),this.score.set(n)},registerScoreWeights(n){for(let[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){let s=new Map;n.forEach((o,a)=>{let f=this.topicStrToLabel.get(a)??"unknown",u=s.get(f);u||(u=new Set,s.set(f,u)),o.forEach(c=>u?.add(c))});for(let[o,a]of s){let f=[];a.forEach(u=>{f.push(i.get(u)??0)}),this.scorePerMesh.set({topic:o},f)}}}}var KC=U(zi(),1),qb=U(ae(),1);var Hb=U(Ae(),1);var $b=U(To(),1),jb=U(Be(),1),Yb=U(Ae(),1);var Sl=oe("libp2p-pubsub:");async function Dl(t,e,r){switch(t.type){case rr.Signing:{let n={from:t.author.toBytes(),data:r,seqno:Zt(8),topic:e,signature:void 0,key:void 0},i=he([Sl,Tn.Message.encode(n).finish()]);return n.signature=await t.privateKey.sign(i),n.key=t.key,n}case rr.Author:return{from:t.author.toBytes(),data:r,seqno:Zt(8),topic:e,signature:void 0,key:void 0};case rr.Anonymous:return{from:void 0,data:r,seqno:void 0,topic:e,signature:void 0,key:void 0}}}async function Cl(t,e){switch(t){case Bn:return e.signature!=null?{valid:!1,error:Ge.SignaturePresent}:e.seqno!=null?{valid:!1,error:Ge.SeqnoPresent}:e.key!=null?{valid:!1,error:Ge.FromPresent}:{valid:!0,fromPeerId:null};case zr:{if(e.seqno==null)return{valid:!1,error:Ge.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Ge.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Ge.InvalidSignature};if(e.from==null)return{valid:!1,error:Ge.InvalidPeerId};let r;try{r=Ft(e.from)}catch{return{valid:!1,error:Ge.InvalidPeerId}}let n;if(e.key){if(n=ui(e.key),r.publicKey!==void 0&&!De(n.bytes,r.publicKey))return{valid:!1,error:Ge.InvalidPeerId}}else{if(r.publicKey==null)return{valid:!1,error:Ge.InvalidPeerId};n=ui(r.publicKey)}let i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=he([Sl,Tn.Message.encode(i).finish()]);return await n.verify(s,e.signature)?{valid:!0,fromPeerId:r}:{valid:!1,error:Ge.InvalidSignature}}}}var Zb=U(Ae(),1);var Il=(t,e)=>{let r=oe(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(t.length+r.length);return n.set(t,0),n.set(r,t.length),n};function Al(t){if(t.sequenceNumber==null)throw Error("missing seqno field");return Il(t.from.toBytes(),t.sequenceNumber)}async function _l(t){return await Me.encode(t.data)}function Qb(t,e,r,n,i){let s=0,o=new Map;if(Object.entries(e.topics).forEach(([l,d])=>{let p=i.get(l)??"unknown",g=r.topics[l];if(g===void 0)return;let m=o.get(p);m||(m={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(p,m));let v=0,E=0,I=0,T=0,x=0;d.inMesh&&(v+=Math.max(d.meshTime/g.timeInMeshQuantum,g.timeInMeshCap)*g.timeInMeshWeight);let C=d.firstMessageDeliveries;if(C>g.firstMessageDeliveriesCap&&(C=g.firstMessageDeliveriesCap),E+=C*g.firstMessageDeliveriesWeight,d.meshMessageDeliveriesActive&&d.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){let q=g.meshMessageDeliveriesThreshold-d.meshMessageDeliveries;I+=q*q*g.meshMessageDeliveriesWeight}T+=d.meshFailurePenalty*g.meshFailurePenaltyWeight,x+=d.invalidMessageDeliveries*d.invalidMessageDeliveries*g.invalidMessageDeliveriesWeight,s+=(v+E+I+T+x)*g.topicWeight,m.p1w+=v,m.p2w+=E,m.p3w+=I,m.p3bw+=T,m.p4w+=x}),r.topicScoreCap>0&&s>r.topicScoreCap){s=r.topicScoreCap;let l=r.topicScoreCap/s;for(let d of o.values())d.p1w*=l,d.p2w*=l,d.p3w*=l,d.p3bw*=l,d.p4w*=l}let a=0,f=0,u=0;return a+=r.appSpecificScore(t)*r.appSpecificWeight,e.ips.forEach(l=>{if(r.IPColocationFactorWhitelist.has(l))return;let d=n.get(l),p=d?d.size:0;if(p>r.IPColocationFactorThreshold){let g=p-r.IPColocationFactorThreshold;f+=g*g*r.IPColocationFactorWeight}}),u+=e.behaviourPenalty*e.behaviourPenalty*r.behaviourPenaltyWeight,s+=a+f+u,{byTopic:o,p5w:a,p6w:f,p7w:u,score:s}}function Tl(t,e,r,n,i){let s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of t){let a=e.get(o);if(a){let f=Qb(o,a,r,n,i);for(let[u,c]of f.byTopic){let h=s.byTopic.get(u);h||(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(u,h)),h.p1w.push(c.p1w),h.p2w.push(c.p2w),h.p3w.push(c.p3w),h.p3bw.push(c.p3bw),h.p4w.push(c.p4w)}s.p5w.push(f.p5w),s.p6w.push(f.p6w),s.p7w.push(f.p7w),s.score.push(f.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}function ks(t,e,r=()=>!0){let n=new Set;if(e<=0)return n;for(let i of t){if(n.size>=e)break;r(i)&&(n.add(i),t.delete(i))}return n}function Bl(t,e){return ks(t,e,()=>!0)}var xi=class extends Error{constructor(e,r){super(e??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function Pl(t){if(t!=null){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")}function Ga(t,e,r){let n=r??{},i=Pl(t);async function*s(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let f;try{if(e.aborted){let{abortMessage:c,abortCode:h}=n;throw new xi(c,h)}let u=new Promise((c,h)=>{o=()=>{let{abortMessage:l,abortCode:d}=n;h(new xi(l,d))}});f=await Promise.race([u,i.next()]),o=null}catch(u){e.removeEventListener("abort",a);let c=u.type==="aborted"&&e.aborted;if(c&&n.onAbort!=null&&await n.onAbort(t),typeof i.return=="function")try{let h=i.return();h instanceof Promise&&h.catch(l=>{n.onReturnError!=null&&n.onReturnError(l)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(c&&n.returnOnAbort===!0)return;throw u}if(f.done===!0)break;yield f.value}e.removeEventListener("abort",a)}return s()}function Rl(t){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}var Ns=t=>{let e=F.encodingLength(t),r=Rl(e);return F.encode(t,r),Ns.bytes=e,r};Ns.bytes=0;function Os(t){t=t??{};let e=t.lengthEncoder??Ns;return async function*(n){for await(let i of n){let s=e(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}}}Os.single=(t,e)=>{e=e??{};let r=e.lengthEncoder??Ns;return new X(r(t.byteLength),t)};var wi=U(Ae(),1),Xb=8,Jb=1024*1024*4,Hr;(function(t){t[t.LENGTH=0]="LENGTH",t[t.DATA=1]="DATA"})(Hr||(Hr={}));var Ha=t=>{let e=F.decode(t);return Ha.bytes=F.encodingLength(e),e};Ha.bytes=0;function Ei(t){return async function*(r){let n=new X,i=Hr.LENGTH,s=-1,o=t?.lengthDecoder??Ha,a=t?.maxLengthLength??Xb,f=t?.maxDataLength??Jb;for await(let u of r)for(n.append(u);n.byteLength>0;){if(i===Hr.LENGTH)try{if(s=o(n),s<0)throw(0,wi.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>f)throw(0,wi.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let c=o.bytes;n.consume(c),t?.onLength!=null&&t.onLength(s),i=Hr.DATA}catch(c){if(c instanceof RangeError){if(n.byteLength>a)throw(0,wi.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw c}if(i===Hr.DATA){if(n.byteLength<s)break;let c=n.sublist(0,s);n.consume(s),t?.onData!=null&&t.onData(c),yield c,i=Hr.LENGTH}}if(n.byteLength>0)throw(0,wi.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}Ei.fromReader=(t,e)=>{let r=1,n=async function*(){for(;;)try{let{done:s,value:o}=await t.next(r);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{r=1}}();return Ei({...e??{},onLength:s=>{r=s}})(n)};var Fs=class{constructor(e,r){this.rawStream=e,this.pushable=xr(),this.closeController=new AbortController,jr(Ga(this.pushable,this.closeController.signal,{returnOnAbort:!0}),Os(),this.rawStream).catch(r)}get protocol(){return this.rawStream.stat.protocol}push(e){this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}},Us=class{constructor(e){this.rawStream=e,this.closeController=new AbortController,this.source=Ga(jr(this.rawStream,Ei()),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}};var Av=Ps,ft;(function(t){t[t.started=0]="started",t[t.stopped=1]="stopped"})(ft||(ft={}));var Ks=class extends Cs{constructor(e={}){super(),this.multicodecs=[Ps,Va],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=xr({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.components=new Pn,this.directPeerInitial=null,this.status={code:ft.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{let n=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{if(n?.(),this.status.code===ft.started){clearTimeout(this.status.heartbeatTimeout);let i=(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})};let r={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...e,scoreParams:dl(e.scoreParams),scoreThresholds:yl(e.scoreThresholds)};if(this.globalSignaturePolicy=r.globalSignaturePolicy??zr,r.fallbackToFloodsub&&this.multicodecs.push(Ka),this.log=Ds(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map(n=>n.id.toString())),this.seenCache=new Ln({validityMs:r.seenTTL}),this.publishedMessageIds=new Ln({validityMs:r.seenTTL}),e.msgIdFn)this.msgIdFn=e.msgIdFn;else switch(this.globalSignaturePolicy){case zr:this.msgIdFn=Al;break;case Bn:this.msgIdFn=_l;break}if(e.fastMsgIdFn&&(this.fastMsgIdFn=e.fastMsgIdFn,this.fastMsgIdCache=new Ln({validityMs:r.seenTTL})),this.msgIdToStrFn=e.msgIdToStrFn??ll,this.mcache=e.messageCache||new Is(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),e.dataTransform&&(this.dataTransform=e.dataTransform),e.metricsRegister){if(!e.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let n=Math.max(...Object.values(r.scoreParams.topics).map(s=>s.meshMessageDeliveriesWindow),1e3),i=El(e.metricsRegister,e.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:n/1e3});i.mcacheSize.addCollect(()=>this.onScrapeMetrics(i));for(let s of this.multicodecs)i.protocolsEnabled.set({protocol:s},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new Ms(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new Ls(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=e.maxInboundStreams,this.maxOutboundStreams=e.maxOutboundStreams}getPeers(){return[...this.peers.keys()].map(e=>er(e))}isStarted(){return this.status.code===ft.started}async init(e){this.components=e,this.score.init(e);try{this.components.getConnectionManager().addEventListener("peer:disconnect",this.onConnectionClosed.bind(this))}catch(r){this.log.error("not able to listen for peer:disconnect event",r)}}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await qa(this.globalSignaturePolicy,this.components.getPeerId()),this.outboundInflightQueue=xr({objectMode:!0}),jr(this.outboundInflightQueue,async s=>{for await(let{peerId:o,connection:a}of s)await this.createOutboundStream(o,a)}).catch(s=>this.log.error("outbound inflight queue error",s)),await Promise.all(this.opts.directPeers.map(async s=>{await this.components.getPeerStore().addressBook.add(s.id,s.addrs)}));let e=this.components.getRegistrar();await Promise.all(this.multicodecs.map(s=>e.handle(s,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let r=u0({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(s=>e.register(s,r))),i=setTimeout(this.runHeartbeat,100);this.status={code:ft.started,registrarTopologyIds:n,heartbeatTimeout:i,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async s=>await this.connect(s)))}).catch(s=>{this.log(s)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==ft.started)return;try{this.components.getConnectionManager().removeEventListener("peer:disconnect",this.onConnectionClosed)}catch(n){this.log.error("not able to unregister peer:disconnect event listener",n)}let{registrarTopologyIds:e}=this.status;this.status={code:ft.stopped};let r=this.components.getRegistrar();e.forEach(n=>r.unregister(n)),this.outboundInflightQueue.end();for(let n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(let n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:r}){if(!this.isStarted())return;let n=r.remotePeer;this.addPeer(n,r.stat.direction),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:r})}onPeerConnected(e,r){!this.isStarted()||(this.addPeer(e,r.stat.direction),this.outboundInflightQueue.push({peerId:e,connection:r}))}onConnectionClosed(e){let r=e.detail;this.log("connection ended by connection manager %p",r.remotePeer),this.onPeerDisconnected(r.remotePeer)}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,r){if(!this.isStarted())return;let n=e.toString();if(!!this.peers.has(n)&&!this.streamsOutbound.has(n))try{let i=new Fs(await r.newStream(this.multicodecs),o=>this.log.error("outbound pipe error",o));this.log("create outbound stream %p",e),this.streamsOutbound.set(n,i);let s=i.protocol;s===Ka&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(i){this.log.error("createOutboundStream error",i)}}async createInboundStream(e,r){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let i=this.streamsInbound.get(n);i!==void 0&&(this.log("replacing existing inbound steam %s",n),i.close()),this.log("create inbound stream %s",n);let s=new Us(r);this.streamsInbound.set(n,s),this.pipePeerReadStream(e,s.source).catch(o=>this.log(o))}addPeer(e,r){let n=e.toString();this.peers.has(n)||(this.log("new peer %p",e),this.peers.add(n),this.score.addPeer(n),this.outbound.has(n)||this.outbound.set(n,r==="outbound"))}removePeer(e){let r=e.toString();if(!this.peers.has(r))return;this.log("delete peer %p",e),this.peers.delete(r);let n=this.streamsOutbound.get(r),i=this.streamsInbound.get(r);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),i?.close(),this.streamsOutbound.delete(r),this.streamsInbound.delete(r);for(let s of this.topics.values())s.delete(r);for(let[s,o]of this.mesh)o.delete(r)===!0&&this.metrics?.onRemoveFromMesh(s,Gr.Dc,1);for(let s of this.fanout.values())s.delete(r);this.floodsubPeers.delete(r),this.gossip.delete(r),this.control.delete(r),this.outbound.delete(r),this.score.removePeer(r),this.acceptFromWhitelist.delete(r)}get started(){return this.status.code===ft.started}getMeshPeers(e){let r=this.mesh.get(e);return r?Array.from(r):[]}getSubscribers(e){let r=this.topics.get(e);return(r?Array.from(r):[]).map(n=>er(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,r){try{await jr(r,async n=>{for await(let i of n)try{let s=i.subarray(),o=Tn.decode(s);this.metrics?.onRpcRecv(o,s.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,o):this.handleReceivedRpc(e,o).catch(a=>this.log(a))}catch(s){this.log(s)}})}catch(n){this.log.error(n),this.onPeerDisconnected(e)}}async handleReceivedRpc(e,r){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}if(this.log("rpc from %p",e),r.subscriptions&&r.subscriptions.length>0&&(r.subscriptions.forEach(n=>{this.handleReceivedSubscription(e,n)}),this.dispatchEvent(new Ur("subscription-change",{detail:{peerId:e,subscriptions:r.subscriptions.filter(n=>n.topic!==null).map(n=>({topic:n.topic??"",subscribe:Boolean(n.subscribe)}))}}))),r.messages)for(let n of r.messages){let i=this.handleReceivedMessage(e,n).catch(s=>this.log(s));this.opts.awaitRpcMessageHandler&&await i}r.control&&await this.handleControlMessage(e.toString(),r.control)}handleReceivedSubscription(e,r){if(r.topic==null)return;this.log("subscription update from %p topic %s",e,r.topic);let n=this.topics.get(r.topic);n==null&&(n=new Set,this.topics.set(r.topic,n)),r.subscribe?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,r){this.metrics?.onMsgRecvPreValidation(r.topic);let n=await this.validateReceivedMessage(e,r);switch(this.metrics?.onMsgRecvResult(r.topic,n.code),n.code){case yt.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,r.topic),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case yt.invalid:if(n.msgIdStr){let i=n.msgIdStr;this.score.rejectMessage(e.toString(),i,r.topic,n.reason),this.gossipTracer.rejectMessage(i,n.reason)}else this.score.rejectInvalidMessage(e.toString(),r.topic);this.metrics?.onMsgRecvInvalid(r.topic,n);return;case yt.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,r,!this.opts.asyncValidation),this.subscriptions.has(r.topic)&&(!this.components.getPeerId().equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new Ur("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new Ur("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,r,e.toString())}}async validateReceivedMessage(e,r){let n=this.fastMsgIdFn?.(r),i=n?this.fastMsgIdCache?.get(n):void 0;if(i)return{code:yt.duplicate,msgIdStr:i};let s=await Cl(this.globalSignaturePolicy,r);if(!s.valid)return{code:yt.invalid,reason:Qe.Error,error:s.error};let o;try{let l=r.data??new Uint8Array(0);o=this.dataTransform?this.dataTransform.inboundTransform(r.topic,l):l}catch(l){return this.log("Invalid message, transform failed",l),{code:yt.invalid,reason:Qe.Error,error:Ge.TransformFailed}}let a={from:r.from==null?void 0:Ft(r.from),data:o,sequenceNumber:r.seqno==null?void 0:BigInt(`0x${W(r.seqno,"base16")}`),topic:r.topic},f=await this.msgIdFn(a),u=this.msgIdToStrFn(f),c={msgId:f,msgIdStr:u};if(n&&this.fastMsgIdCache?.put(n,u),this.seenCache.has(u))return{code:yt.duplicate,msgIdStr:u};this.seenCache.put(u);let h=this.topicValidators.get(r.topic);if(h!=null){let l;try{l=await h(a.topic,a,e)}catch(d){let p=d.code;p===hl&&(l=Gt.Ignore),p===fl?l=Gt.Reject:l=Gt.Ignore}if(l!==Gt.Accept)return{code:yt.invalid,reason:za(l),msgIdStr:u}}return{code:yt.valid,messageId:c,msg:a}}getScore(e){return this.score.score(e)}sendSubscriptions(e,r,n){this.sendRpc(e,{subscriptions:r.map(i=>({topic:i,subscribe:n})),messages:[]})}async handleControlMessage(e,r){if(r===void 0)return;let n=r.ihave?this.handleIHave(e,r.ihave):[],i=r.iwant?this.handleIWant(e,r.iwant):[],s=r.graft?await this.handleGraft(e,r.graft):[];r.prune&&await this.handlePrune(e,r.prune),!(!n.length&&!i.length&&!s.length)&&this.sendRpc(e,zt(i,{iwant:n,prune:s}))}acceptFrom(e){if(this.direct.has(e))return!0;let r=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=r)return n.messagesAccepted+=1,!0;let i=this.score.score(e);return i>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:r+1e3}):this.acceptFromWhitelist.delete(e),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,r){if(!r.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:Nn.LowScore}),[];let i=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,i),i>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:Nn.MaxIhave}),[];let s=this.iasked.get(e)??0;if(s>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:Nn.MaxIasked}),[];let o=new Map;if(r.forEach(({topicID:u,messageIDs:c})=>{if(!u||!c||!this.mesh.has(u))return;let h=0;c.forEach(l=>{let d=this.msgIdToStrFn(l);this.seenCache.has(d)||(o.set(d,l),h++)}),this.metrics?.onIhaveRcv(u,c.length,h)}),!o.size)return[];let a=o.size;a+s>5e3&&(a=5e3-s),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let f=Array.from(o.values());return qt(f),f=f.slice(0,a),this.iasked.set(e,s+a),this.gossipTracer.addPromise(e,f),[{messageIDs:f}]}handleIWant(e,r){if(!r.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let i=new Map,s=new Map,o=0;return r.forEach(({messageIDs:a})=>{a&&a.forEach(f=>{let u=this.msgIdToStrFn(f),c=this.mcache.getWithIWantCount(u,e);if(c==null){o++;return}if(s.set(c.msg.topic,1+(s.get(c.msg.topic)??0)),c.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,f);return}i.set(u,c.msg)})}),this.metrics?.onIwantRcv(s,o),i.size?(this.log("IWANT: Sending %d messages to %s",i.size,e),Array.from(i.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,r){let n=[],i=this.score.score(e),s=Date.now(),o=this.opts.doPX;return r.forEach(({topicID:a})=>{if(!a)return;let f=this.mesh.get(a);if(!f){o=!1;return}if(f.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}let u=this.backoff.get(a)?.get(e);if(typeof u=="number"&&s<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,kn.GraftBackoff),o=!1;let c=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;s<c&&this.score.addPenalty(e,1,kn.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(i<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,i,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(f.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),f.add(e),this.metrics?.onAddToMesh(a,nr.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,r){let n=this.score.score(e);for(let{topicID:i,backoff:s,peers:o}of r){if(i==null)continue;let a=this.mesh.get(i);if(!a)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,i),this.score.prune(e,i),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(i,Gr.Unsub,1)),typeof s=="number"&&s>0?this.doAddBackoff(e,i,s*1e3):this.addBackoff(e,i),o&&o.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,i);continue}await this.pxConnect(o)}}}addBackoff(e,r){this.doAddBackoff(e,r,this.opts.pruneBackoff)}doAddBackoff(e,r,n){let i=this.backoff.get(r);i||(i=new Map,this.backoff.set(r,i));let s=Date.now()+n;(i.get(e)??0)<s&&i.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,r)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",r,e),this.score.addPenalty(r,e,kn.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((r,n)=>{r.forEach((i,s)=>{i<e&&r.delete(s)}),r.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(r=>{this.streamsOutbound.has(r)||e.push(r)}),await Promise.all(e.map(async r=>await this.connect(r)))}async pxConnect(e){e.length>this.opts.prunePeers&&(qt(e),e=e.slice(0,this.opts.prunePeers));let r=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let i=Ft(n.peerID).toString();if(!this.peers.has(i)){if(!n.signedPeerRecord){r.push(i);return}try{let s=await dt.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),o=s.peerId;if(!s.peerId.equals(i)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",o,i);return}if(!await this.components.getPeerStore().addressBook.consumePeerRecord(s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}r.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),r.length&&await Promise.all(r.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let r=er(e),n=await this.components.getConnectionManager().openConnection(r);for(let i of this.multicodecs)for(let s of this.components.getRegistrar().getTopologies(i))s.onConnect(r,n)}subscribe(e){if(this.status.code!==ft.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let r of this.peers.keys())this.sendSubscriptions(r,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==ft.started)throw new Error("Pubsub is not started");let r=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,r),r)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e).catch(n=>{this.log(n)})}join(e){if(this.status.code!==ft.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let r=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(i=>{!this.direct.has(i)&&this.score.score(i)>=0&&r.add(i)}),this.metrics?.onAddToMesh(e,nr.Fanout,r.size)),r.size<this.opts.D){let i=r.size;this.getRandomGossipPeers(e,this.opts.D,o=>!r.has(o)&&!this.direct.has(o)&&this.score.score(o)>=0).forEach(o=>{r.add(o)}),this.metrics?.onAddToMesh(e,nr.Random,r.size-i)}this.mesh.set(e,r),r.forEach(i=>{this.log("JOIN: Add mesh link to %s in %s",i,e),this.sendGraft(i,e)})}async leave(e){if(this.status.code!==ft.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let r=this.mesh.get(e);r&&(await Promise.all(Array.from(r).map(async n=>(this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)))),this.mesh.delete(e))}selectPeersToForward(e,r,n){let i=new Set,s=this.topics.get(e);s&&(this.direct.forEach(a=>{s.has(a)&&r!==a&&!n?.has(a)&&i.add(a)}),this.floodsubPeers.forEach(a=>{s.has(a)&&r!==a&&!n?.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&i.add(a)}));let o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{r!==a&&!n?.has(a)&&i.add(a)}),i}selectPeersToPublish(e){let r=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(e);if(i)if(this.opts.floodPublish)i.forEach(s=>{this.direct.has(s)?(r.add(s),n.direct++):this.score.score(s)>=this.opts.scoreThresholds.publishThreshold&&(r.add(s),n.floodsub++)});else{this.direct.forEach(o=>{i.has(o)&&(r.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{i.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(r.add(o),n.floodsub++)});let s=this.mesh.get(e);if(s&&s.size>0)s.forEach(o=>{r.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{r.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,f=>this.score.score(f)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(f=>{r.add(f),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:r,tosendCount:n}}forwardMessage(e,r,n,i){n&&this.score.deliverMessage(n,e,r.topic);let s=this.selectPeersToForward(r.topic,n,i),o=zt([r]);s.forEach(a=>{this.sendRpc(a,o)}),this.metrics?.onForwardMsg(r.topic,s.size)}async publish(e,r){let n=this.dataTransform?this.dataTransform.outboundTransform(e,r):r;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let i=await Dl(this.publishConfig,e,n),s={from:i.from?Ft(i.from):void 0,data:r,sequenceNumber:i.seqno==null?void 0:BigInt(`0x${W(i.seqno,"base16")}`),topic:e,signature:i.signature??void 0,key:i.key??void 0},o=await this.msgIdFn(s),a=this.msgIdToStrFn(o);if(this.seenCache.has(a))throw Error("PublishError.Duplicate");let{tosend:f,tosendCount:u}=this.selectPeersToPublish(i.topic),c=this.opts.emitSelf===!0&&this.subscriptions.has(e);if(f.size===0&&!this.opts.allowPublishToZeroPeers&&!c)throw Error("PublishError.InsufficientPeers");this.seenCache.put(a),this.mcache.put({msgId:o,msgIdStr:a},i,!0),this.publishedMessageIds.put(a);let h=zt([i]);for(let l of f)this.sendRpc(l,h)||f.delete(l);return this.metrics?.onPublishMsg(e,u,f.size,i.data!=null?i.data.length:0),c&&(f.add(this.components.getPeerId().toString()),super.dispatchEvent(new Ur("gossipsub:message",{detail:{propagationSource:this.components.getPeerId(),msgId:a,msg:s}})),super.dispatchEvent(new Ur("message",{detail:s}))),{recipients:Array.from(f.values()).map(l=>er(l))}}reportMessageValidationResult(e,r,n){if(n===Gt.Accept){let i=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(i!==null),i!=null){let{message:s,originatingPeers:o}=i;this.score.deliverMessage(r.toString(),e,s.topic),this.forwardMessage(e,i.message,r.toString(),o),this.metrics?.onReportValidation(s.topic,n)}}else{let i=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(i!==null),i){let s=za(n),{message:o,originatingPeers:a}=i;this.score.rejectMessage(r.toString(),e,o.topic,s);for(let f of a)this.score.rejectMessage(f,e,o.topic,s);this.metrics?.onReportValidation(o.topic,n)}}}sendGraft(e,r){let i=zt([],{graft:[{topicID:r}]});this.sendRpc(e,i)}async sendPrune(e,r){let n=[await this.makePrune(e,r,this.opts.doPX)],i=zt([],{prune:n});this.sendRpc(e,i)}sendRpc(e,r){let n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let i=this.control.get(e);i&&(this.piggybackControl(e,r,i),this.control.delete(e));let s=this.gossip.get(e);s&&(this.piggybackGossip(e,r,s),this.gossip.delete(e));let o=Tn.encode(r).finish();return n.push(o),this.metrics?.onRpcSent(r,o.length),!0}piggybackControl(e,r,n){let i=(n.graft||[]).filter(({topicID:o})=>(o&&this.mesh.get(o)||new Set).has(e)),s=(n.prune||[]).filter(({topicID:o})=>!(o&&this.mesh.get(o)||new Set).has(e));!i.length&&!s.length||(r.control?(r.control.graft=r.control.graft&&r.control.graft.concat(i),r.control.prune=r.control.prune&&r.control.prune.concat(s)):r.control={graft:i,prune:s,ihave:[],iwant:[]})}piggybackGossip(e,r,n){r.control||(r.control={ihave:[],iwant:[],graft:[],prune:[]}),r.control.ihave=n}async sendGraftPrune(e,r,n){let i=this.opts.doPX;for(let[s,o]of e){let a=o.map(h=>({topicID:h})),f=[],u=r.get(s);u&&(f=await Promise.all(u.map(async h=>await this.makePrune(s,h,i&&!(n.get(s)??!1)))),r.delete(s));let c=zt([],{graft:a,prune:f});this.sendRpc(s,c)}for(let[s,o]of r){let a=await Promise.all(o.map(async u=>await this.makePrune(s,u,i&&!(n.get(s)??!1)))),f=zt([],{prune:a});this.sendRpc(s,f)}}emitGossip(e){let r=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,i]of e)this.doEmitGossip(n,i,r.get(n)??[])}doEmitGossip(e,r,n){if(!n.length||(qt(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!r.size))return;let i=this.opts.Dlazy,s=.25*r.size,o=r;s>i&&(i=s),i>o.size?i=o.size:o=qt(Array.from(o)).slice(0,i),o.forEach(a=>{let f=n;n.length>5e3&&(f=qt(f.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:f})})}flush(){for(let[e,r]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,zt([],{ihave:r}));for(let[e,r]of this.control.entries())this.control.delete(e),this.sendRpc(e,zt([],{graft:r.graft,prune:r.prune}))}pushGossip(e,r){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(r))}async makePrune(e,r,n){if(this.score.prune(e,r),this.streamsOutbound.get(e).protocol===Va)return{topicID:r,peers:[]};let i=this.opts.pruneBackoff/1e3;if(!n)return{topicID:r,peers:[],backoff:i};let s=this.getRandomGossipPeers(r,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(s).map(async a=>{let f=er(a);return{peerID:f.toBytes(),signedPeerRecord:await this.components.getPeerStore().addressBook.getRawEnvelope(f)}}));return{topicID:r,peers:o,backoff:i}}async heartbeat(){let{D:e,Dlo:r,Dhi:n,Dscore:i,Dout:s,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,f=p=>{let g=a.get(p);return g===void 0&&(g=this.score.score(p),a.set(p,g)),g},u=new Map,c=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let l=new Map;this.mesh.forEach((p,g)=>{let m=this.topics.get(g),v=new Set,E=new Set;if(l.set(g,E),m){let x=qt(Array.from(m)),C=this.backoff.get(g);for(let P of x){let N=this.streamsOutbound.get(P);if(N&&this.multicodecs.includes(N.protocol)&&!p.has(P)&&!this.direct.has(P)){let q=f(P);(!C||!C.has(P))&&q>=0&&v.add(P),q>=this.opts.scoreThresholds.gossipThreshold&&E.add(P)}}}let I=(x,C)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",x,g),this.addBackoff(x,g),p.delete(x),f(x)>=this.opts.scoreThresholds.gossipThreshold&&E.add(x),this.metrics?.onRemoveFromMesh(g,C,1);let P=c.get(x);P?P.push(g):c.set(x,[g])},T=(x,C)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",x,g),this.score.graft(x,g),p.add(x),E.delete(x),this.metrics?.onAddToMesh(g,C,1);let P=u.get(x);P?P.push(g):u.set(x,[g])};if(p.forEach(x=>{let C=f(x);C<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",x,C,g),I(x,Gr.BadScore),h.set(x,!0))}),p.size<r){let x=e-p.size;Bl(v,x).forEach(P=>{T(P,nr.NotEnough)})}if(p.size>n){let x=Array.from(p);x.sort((P,N)=>f(N)-f(P)),x=x.slice(0,i).concat(qt(x.slice(i)));let C=0;if(x.slice(0,e).forEach(P=>{this.outbound.get(P)&&C++}),C<s){let P=q=>{let xe=x[q];for(let Oe=q;Oe>0;Oe--)x[Oe]=x[Oe-1];x[0]=xe};if(C>0){let q=C;for(let xe=1;xe<e&&q>0;xe++)this.outbound.get(x[xe])&&(P(xe),q--)}let N=e-C;for(let q=e;q<x.length&&N>0;q++)this.outbound.get(x[q])&&(P(q),N--)}x.slice(e).forEach(P=>{I(P,Gr.Excess)})}if(p.size>=r){let x=0;if(p.forEach(C=>{this.outbound.get(C)&&x++}),x<s){let C=s-x;ks(v,C,N=>this.outbound.get(N)===!0).forEach(N=>{T(N,nr.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&p.size>1){let x=Array.from(p).sort((N,q)=>f(N)-f(q)),C=Math.floor(p.size/2),P=f(x[C]);if(P<this.opts.scoreThresholds.opportunisticGraftThreshold){let N=this.opts.opportunisticGraftPeers,q=ks(v,N,xe=>f(xe)>P);for(let xe of q)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",xe,g),T(xe,nr.Opportunistic)}}});let d=Date.now();this.fanoutLastpub.forEach((p,g)=>{p+o<d&&(this.fanout.delete(g),this.fanoutLastpub.delete(g))}),this.fanout.forEach((p,g)=>{let m=this.topics.get(g);p.forEach(T=>{(!m.has(T)||f(T)<this.opts.scoreThresholds.publishThreshold)&&p.delete(T)});let v=this.topics.get(g),E=[],I=new Set;if(l.set(g,I),v){let T=qt(Array.from(v));for(let x of T){let C=this.streamsOutbound.get(x);if(C&&this.multicodecs.includes(C.protocol)&&!p.has(x)&&!this.direct.has(x)){let P=f(x);P>=this.opts.scoreThresholds.publishThreshold&&E.push(x),P>=this.opts.scoreThresholds.gossipThreshold&&I.add(x)}}}if(p.size<e){let T=e-p.size;E.slice(0,T).forEach(x=>{p.add(x),I?.delete(x)})}}),this.emitGossip(l),await this.sendGraftPrune(u,c,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new Ur("gossipsub:heartbeat"))}getRandomGossipPeers(e,r,n=()=>!0){let i=this.topics.get(e);if(!i)return new Set;let s=[];return i.forEach(o=>{let a=this.streamsOutbound.get(o);!a||this.multicodecs.includes(a.protocol)&&n(o)&&s.push(o)}),s=qt(s),r>0&&s.length>r&&(s=s.slice(0,r)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let r=0;for(let o of this.backoff.values())r+=o.size;e.cacheSize.set({cache:"backoff"},r);for(let[o,a]of this.topics)e.topicPeersCount.set({topicStr:o},a.size);for(let[o,a]of this.mesh)e.meshPeerCounts.set({topicStr:o},a.size);let n=[],i=new Map;e.behaviourPenalty.reset();for(let o of this.peers.keys()){let a=this.score.score(o);n.push(a),i.set(o,a),e.behaviourPenalty.observe(this.score.peerStats.get(o)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);let s=Tl(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}};Ks.multicodec=Ps;return Ul(_v);})();
/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
return ChainsafeLibp2PGossipsub}));
